import{f as Ye,j as r,g as $r,r as s,R as Ie,h as Kt,i as Lt,k as xt,e as $t,T as z,B as I,I as ke,A as _r,l as Pr,w as ht,m as Eo,n as Qt,o as ct,F as _t,p as Pt,q as jn,C as kn,U as zn,t as sr,S as Mo,v as Rn,P as Jt,x as $n,y as Hr,z as Le,D as _n,E as Vr,a as Wr,G as Tt,H as Do,J as jo,K as ir,c as ar,L as ko,M as Ro,N as To,O as Bo,Q as Ao,V as Fo,W as Oo,X as dn,Y as Ft,Z as lr,_ as cr,$ as dr,a0 as un}from"./index-Eph4teK0.js";import{S as Lo}from"./SearchModal-Dc21TxIP.js";import{L as wn}from"./ListItemButton-8UkpUSEz.js";import{I as ur}from"./Input-3kVBmxgd.js";import{C as No}from"./Checkbox-B5x_HBZK.js";import"./Tabs-B6-83TUs.js";import"./ListItemAvatar-DuoKR7OX.js";const Un=Ye(r.jsx("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"})),zo=Ye(r.jsx("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2m6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1z"})),Gr=Ye(r.jsx("path",{d:"M21 6h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1m-4 6V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1"})),Ur=Ye(r.jsx("path",{d:"M3 9v6h4l5 5V4L7 9zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02M14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77"})),$o=$r.injectEndpoints({endpoints:e=>({createCategory:e.mutation({query:({hubId:t,name:n})=>({url:`/api/v1/hubs/${t}/categories`,method:"POST",body:{name:n}}),invalidatesTags:["Category"]}),getCategories:e.query({query:t=>({url:`/api/v1/hubs/${t}/entities`}),keepUnusedDataFor:0,serializeQueryArgs:({queryArgs:t})=>t,merge:(t,n)=>n,forceRefetch({currentArg:t,previousArg:n}){return t!==n}}),updateCategoryPosition:e.mutation({query:({hubId:t,categoryId:n,data:o})=>({url:`/api/v1/hubs/${t}/categories/${n}`,method:"PUT",body:o}),invalidatesTags:["Category"]}),deleteCategory:e.mutation({query:({hubId:t,categoryId:n})=>({url:`/api/v1/hubs/${t}/categories/${n}`,method:"DELETE"}),invalidatesTags:["Category"]})})}),{useCreateCategoryMutation:_o,useGetCategoriesQuery:Po,useUpdateCategoryPositionMutation:Ho,useDeleteCategoryMutation:Vo}=$o;var Se=(e=>(e[e.VOICE=0]="VOICE",e[e.TEXT=1]="TEXT",e))(Se||{});const Wo=$r.injectEndpoints({endpoints:e=>({createChannel:e.mutation({query:({hubId:t,data:n})=>({url:`/api/v1/hubs/${t}/channels`,method:"POST",body:{...n,category_id:n.categoryId}}),invalidatesTags:["Channel"]}),updateChannel:e.mutation({query:({channelId:t,data:n})=>{const o={...n};return"categoryId"in o&&(o.category_id=o.categoryId,delete o.categoryId),{url:`/api/v1/channels/${t}`,method:"PUT",body:o}},invalidatesTags:["Channel"]}),deleteChannel:e.mutation({query:({channelId:t})=>({url:`/api/v1/channels/${t}`,method:"DELETE"}),invalidatesTags:["Channel"]}),getMessages:e.query({query:({channelId:t,params:n})=>({url:`/api/v1/channels/${t}/messages`,params:n}),keepUnusedDataFor:0,serializeQueryArgs:({queryArgs:t})=>{var n,o,i,a;return(n=t.params)!=null&&n.search?`${t.channelId}_search_${t.params.search}`:(o=t.params)!=null&&o.around?`${t.channelId}_around_${t.params.around}`:(i=t.params)!=null&&i.before?`${t.channelId}_before_${t.params.before}`:(a=t.params)!=null&&a.after?`${t.channelId}_after_${t.params.after}`:`${t.channelId}_initial`},merge:(t,n)=>n,forceRefetch({currentArg:t,previousArg:n}){return(t==null?void 0:t.channelId)!==(n==null?void 0:n.channelId)?!0:JSON.stringify(t)!==JSON.stringify(n)}}),searchMessages:e.query({query:({channelId:t,search:n,size:o=20})=>({url:`/api/v1/channels/${t}/messages`,params:{search:n,size:o}}),keepUnusedDataFor:60}),createMessage:e.mutation({query:({channelId:t,content:n,attachments:o=[],replyId:i})=>{const a=new FormData;return a.append("content",n),i!=null&&a.append("replyId",i.toString()),o.forEach(l=>a.append("attachments",l)),{url:`/api/v1/channels/${t}/messages`,method:"POST",body:a}},invalidatesTags:["Channel"]}),updateMessage:e.mutation({query:({channelId:t,messageId:n,content:o})=>{const i=new FormData;return i.append("content",o),{url:`/api/v1/channels/${t}/messages/${n}`,method:"PUT",body:i}},invalidatesTags:["Channel"]}),deleteMessage:e.mutation({query:({channelId:t,messageId:n,forEveryone:o})=>({url:`/api/v1/channels/${t}/messages/${n}`,method:"DELETE",params:o?{for_everyone:!0}:void 0}),invalidatesTags:["Channel"]})})}),{useCreateChannelMutation:Go,useUpdateChannelMutation:Uo,useDeleteChannelMutation:qo,useGetMessagesQuery:Xo,useSearchMessagesQuery:Yo,useCreateMessageMutation:Ko,useUpdateMessageMutation:Qo,useDeleteMessageMutation:Jo}=Wo;function Zo(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return s.useMemo(()=>o=>{t.forEach(i=>i(o))},t)}const Sn=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Wt(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function qn(e){return"nodeType"in e}function Ke(e){var t,n;return e?Wt(e)?e:qn(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function Xn(e){const{Document:t}=Ke(e);return e instanceof t}function sn(e){return Wt(e)?!1:e instanceof Ke(e).HTMLElement}function qr(e){return e instanceof Ke(e).SVGElement}function Gt(e){return e?Wt(e)?e.document:qn(e)?Xn(e)?e:sn(e)||qr(e)?e.ownerDocument:document:document:document}const It=Sn?s.useLayoutEffect:s.useEffect;function Yn(e){const t=s.useRef(e);return It(()=>{t.current=e}),s.useCallback(function(){for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return t.current==null?void 0:t.current(...o)},[])}function es(){const e=s.useRef(null),t=s.useCallback((o,i)=>{e.current=setInterval(o,i)},[]),n=s.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function nn(e,t){t===void 0&&(t=[e]);const n=s.useRef(e);return It(()=>{n.current!==e&&(n.current=e)},t),n}function an(e,t){const n=s.useRef();return s.useMemo(()=>{const o=e(n.current);return n.current=o,o},[...t])}function bn(e){const t=Yn(e),n=s.useRef(null),o=s.useCallback(i=>{i!==n.current&&(t==null||t(i,n.current)),n.current=i},[]);return[n,o]}function Pn(e){const t=s.useRef();return s.useEffect(()=>{t.current=e},[e]),t.current}let Tn={};function ln(e,t){return s.useMemo(()=>{if(t)return t;const n=Tn[e]==null?0:Tn[e]+1;return Tn[e]=n,e+"-"+n},[e,t])}function Xr(e){return function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];return o.reduce((a,l)=>{const c=Object.entries(l);for(const[f,u]of c){const x=a[f];x!=null&&(a[f]=x+e*u)}return a},{...t})}}const Ht=Xr(1),rn=Xr(-1);function ts(e){return"clientX"in e&&"clientY"in e}function Kn(e){if(!e)return!1;const{KeyboardEvent:t}=Ke(e.target);return t&&e instanceof t}function ns(e){if(!e)return!1;const{TouchEvent:t}=Ke(e.target);return t&&e instanceof t}function Hn(e){if(ns(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return ts(e)?{x:e.clientX,y:e.clientY}:null}const Vt=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[Vt.Translate.toString(e),Vt.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:o}=e;return t+" "+n+"ms "+o}}}),fr="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function rs(e){return e.matches(fr)?e:e.querySelector(fr)}const os={display:"none"};function ss(e){let{id:t,value:n}=e;return Ie.createElement("div",{id:t,style:os},n)}function is(e){let{id:t,announcement:n,ariaLiveType:o="assertive"}=e;const i={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return Ie.createElement("div",{id:t,style:i,role:"status","aria-live":o,"aria-atomic":!0},n)}function as(){const[e,t]=s.useState("");return{announce:s.useCallback(o=>{o!=null&&t(o)},[]),announcement:e}}const Yr=s.createContext(null);function ls(e){const t=s.useContext(Yr);s.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function cs(){const[e]=s.useState(()=>new Set),t=s.useCallback(o=>(e.add(o),()=>e.delete(o)),[e]);return[s.useCallback(o=>{let{type:i,event:a}=o;e.forEach(l=>{var c;return(c=l[i])==null?void 0:c.call(l,a)})},[e]),t]}const ds={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},us={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function fs(e){let{announcements:t=us,container:n,hiddenTextDescribedById:o,screenReaderInstructions:i=ds}=e;const{announce:a,announcement:l}=as(),c=ln("DndLiveRegion"),[f,u]=s.useState(!1);if(s.useEffect(()=>{u(!0)},[]),ls(s.useMemo(()=>({onDragStart(b){let{active:m}=b;a(t.onDragStart({active:m}))},onDragMove(b){let{active:m,over:E}=b;t.onDragMove&&a(t.onDragMove({active:m,over:E}))},onDragOver(b){let{active:m,over:E}=b;a(t.onDragOver({active:m,over:E}))},onDragEnd(b){let{active:m,over:E}=b;a(t.onDragEnd({active:m,over:E}))},onDragCancel(b){let{active:m,over:E}=b;a(t.onDragCancel({active:m,over:E}))}}),[a,t])),!f)return null;const x=Ie.createElement(Ie.Fragment,null,Ie.createElement(ss,{id:o,value:i.draggable}),Ie.createElement(is,{id:c,announcement:l}));return n?Kt.createPortal(x,n):x}var Ce;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(Ce||(Ce={}));function xn(){}function gr(e,t){return s.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function gs(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return s.useMemo(()=>[...t].filter(o=>o!=null),[...t])}const bt=Object.freeze({x:0,y:0});function Kr(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Qr(e,t){let{data:{value:n}}=e,{data:{value:o}}=t;return n-o}function ps(e,t){let{data:{value:n}}=e,{data:{value:o}}=t;return o-n}function pr(e){let{left:t,top:n,height:o,width:i}=e;return[{x:t,y:n},{x:t+i,y:n},{x:t,y:n+o},{x:t+i,y:n+o}]}function Jr(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function hr(e,t,n){return t===void 0&&(t=e.left),n===void 0&&(n=e.top),{x:t+e.width*.5,y:n+e.height*.5}}const br=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:o}=e;const i=hr(t,t.left,t.top),a=[];for(const l of o){const{id:c}=l,f=n.get(c);if(f){const u=Kr(hr(f),i);a.push({id:c,data:{droppableContainer:l,value:u}})}}return a.sort(Qr)},hs=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:o}=e;const i=pr(t),a=[];for(const l of o){const{id:c}=l,f=n.get(c);if(f){const u=pr(f),x=i.reduce((m,E,R)=>m+Kr(u[R],E),0),b=Number((x/4).toFixed(4));a.push({id:c,data:{droppableContainer:l,value:b}})}}return a.sort(Qr)};function bs(e,t){const n=Math.max(t.top,e.top),o=Math.max(t.left,e.left),i=Math.min(t.left+t.width,e.left+e.width),a=Math.min(t.top+t.height,e.top+e.height),l=i-o,c=a-n;if(o<i&&n<a){const f=t.width*t.height,u=e.width*e.height,x=l*c,b=x/(f+u-x);return Number(b.toFixed(4))}return 0}const xs=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:o}=e;const i=[];for(const a of o){const{id:l}=a,c=n.get(l);if(c){const f=bs(c,t);f>0&&i.push({id:l,data:{droppableContainer:a,value:f}})}}return i.sort(ps)};function ms(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function Zr(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:bt}function ys(e){return function(n){for(var o=arguments.length,i=new Array(o>1?o-1:0),a=1;a<o;a++)i[a-1]=arguments[a];return i.reduce((l,c)=>({...l,top:l.top+e*c.y,bottom:l.bottom+e*c.y,left:l.left+e*c.x,right:l.right+e*c.x}),{...n})}}const vs=ys(1);function ws(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function Ss(e,t,n){const o=ws(t);if(!o)return e;const{scaleX:i,scaleY:a,x:l,y:c}=o,f=e.left-l-(1-i)*parseFloat(n),u=e.top-c-(1-a)*parseFloat(n.slice(n.indexOf(" ")+1)),x=i?e.width/i:e.width,b=a?e.height/a:e.height;return{width:x,height:b,top:u,right:f+x,bottom:u+b,left:f}}const Cs={ignoreTransform:!1};function Ut(e,t){t===void 0&&(t=Cs);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:u,transformOrigin:x}=Ke(e).getComputedStyle(e);u&&(n=Ss(n,u,x))}const{top:o,left:i,width:a,height:l,bottom:c,right:f}=n;return{top:o,left:i,width:a,height:l,bottom:c,right:f}}function xr(e){return Ut(e,{ignoreTransform:!0})}function Is(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function Es(e,t){return t===void 0&&(t=Ke(e).getComputedStyle(e)),t.position==="fixed"}function Ms(e,t){t===void 0&&(t=Ke(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(i=>{const a=t[i];return typeof a=="string"?n.test(a):!1})}function Cn(e,t){const n=[];function o(i){if(t!=null&&n.length>=t||!i)return n;if(Xn(i)&&i.scrollingElement!=null&&!n.includes(i.scrollingElement))return n.push(i.scrollingElement),n;if(!sn(i)||qr(i)||n.includes(i))return n;const a=Ke(e).getComputedStyle(i);return i!==e&&Ms(i,a)&&n.push(i),Es(i,a)?n:o(i.parentNode)}return e?o(e):n}function eo(e){const[t]=Cn(e,1);return t??null}function Bn(e){return!Sn||!e?null:Wt(e)?e:qn(e)?Xn(e)||e===Gt(e).scrollingElement?window:sn(e)?e:null:null}function to(e){return Wt(e)?e.scrollX:e.scrollLeft}function no(e){return Wt(e)?e.scrollY:e.scrollTop}function Vn(e){return{x:to(e),y:no(e)}}var Re;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(Re||(Re={}));function ro(e){return!Sn||!e?!1:e===document.scrollingElement}function oo(e){const t={x:0,y:0},n=ro(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},o={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},i=e.scrollTop<=t.y,a=e.scrollLeft<=t.x,l=e.scrollTop>=o.y,c=e.scrollLeft>=o.x;return{isTop:i,isLeft:a,isBottom:l,isRight:c,maxScroll:o,minScroll:t}}const Ds={x:.2,y:.2};function js(e,t,n,o,i){let{top:a,left:l,right:c,bottom:f}=n;o===void 0&&(o=10),i===void 0&&(i=Ds);const{isTop:u,isBottom:x,isLeft:b,isRight:m}=oo(e),E={x:0,y:0},R={x:0,y:0},j={height:t.height*i.y,width:t.width*i.x};return!u&&a<=t.top+j.height?(E.y=Re.Backward,R.y=o*Math.abs((t.top+j.height-a)/j.height)):!x&&f>=t.bottom-j.height&&(E.y=Re.Forward,R.y=o*Math.abs((t.bottom-j.height-f)/j.height)),!m&&c>=t.right-j.width?(E.x=Re.Forward,R.x=o*Math.abs((t.right-j.width-c)/j.width)):!b&&l<=t.left+j.width&&(E.x=Re.Backward,R.x=o*Math.abs((t.left+j.width-l)/j.width)),{direction:E,speed:R}}function ks(e){if(e===document.scrollingElement){const{innerWidth:a,innerHeight:l}=window;return{top:0,left:0,right:a,bottom:l,width:a,height:l}}const{top:t,left:n,right:o,bottom:i}=e.getBoundingClientRect();return{top:t,left:n,right:o,bottom:i,width:e.clientWidth,height:e.clientHeight}}function so(e){return e.reduce((t,n)=>Ht(t,Vn(n)),bt)}function Rs(e){return e.reduce((t,n)=>t+to(n),0)}function Ts(e){return e.reduce((t,n)=>t+no(n),0)}function Bs(e,t){if(t===void 0&&(t=Ut),!e)return;const{top:n,left:o,bottom:i,right:a}=t(e);eo(e)&&(i<=0||a<=0||n>=window.innerHeight||o>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const As=[["x",["left","right"],Rs],["y",["top","bottom"],Ts]];class Qn{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const o=Cn(n),i=so(o);this.rect={...t},this.width=t.width,this.height=t.height;for(const[a,l,c]of As)for(const f of l)Object.defineProperty(this,f,{get:()=>{const u=c(o),x=i[a]-u;return this.rect[f]+x},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Zt{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var o;return(o=this.target)==null?void 0:o.removeEventListener(...n)})},this.target=t}add(t,n,o){var i;(i=this.target)==null||i.addEventListener(t,n,o),this.listeners.push([t,n,o])}}function Fs(e){const{EventTarget:t}=Ke(e);return e instanceof t?e:Gt(e)}function An(e,t){const n=Math.abs(e.x),o=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+o**2)>t:"x"in t&&"y"in t?n>t.x&&o>t.y:"x"in t?n>t.x:"y"in t?o>t.y:!1}var dt;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(dt||(dt={}));function mr(e){e.preventDefault()}function Os(e){e.stopPropagation()}var Y;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(Y||(Y={}));const io={start:[Y.Space,Y.Enter],cancel:[Y.Esc],end:[Y.Space,Y.Enter,Y.Tab]},Ls=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case Y.Right:return{...n,x:n.x+25};case Y.Left:return{...n,x:n.x-25};case Y.Down:return{...n,y:n.y+25};case Y.Up:return{...n,y:n.y-25}}};class Jn{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new Zt(Gt(n)),this.windowListeners=new Zt(Ke(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(dt.Resize,this.handleCancel),this.windowListeners.add(dt.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(dt.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,o=t.node.current;o&&Bs(o),n(bt)}handleKeyDown(t){if(Kn(t)){const{active:n,context:o,options:i}=this.props,{keyboardCodes:a=io,coordinateGetter:l=Ls,scrollBehavior:c="smooth"}=i,{code:f}=t;if(a.end.includes(f)){this.handleEnd(t);return}if(a.cancel.includes(f)){this.handleCancel(t);return}const{collisionRect:u}=o.current,x=u?{x:u.left,y:u.top}:bt;this.referenceCoordinates||(this.referenceCoordinates=x);const b=l(t,{active:n,context:o.current,currentCoordinates:x});if(b){const m=rn(b,x),E={x:0,y:0},{scrollableAncestors:R}=o.current;for(const j of R){const T=t.code,{isTop:k,isRight:D,isLeft:B,isBottom:L,maxScroll:P,minScroll:G}=oo(j),$=ks(j),H={x:Math.min(T===Y.Right?$.right-$.width/2:$.right,Math.max(T===Y.Right?$.left:$.left+$.width/2,b.x)),y:Math.min(T===Y.Down?$.bottom-$.height/2:$.bottom,Math.max(T===Y.Down?$.top:$.top+$.height/2,b.y))},ne=T===Y.Right&&!D||T===Y.Left&&!B,ae=T===Y.Down&&!L||T===Y.Up&&!k;if(ne&&H.x!==b.x){const V=j.scrollLeft+m.x,Ee=T===Y.Right&&V<=P.x||T===Y.Left&&V>=G.x;if(Ee&&!m.y){j.scrollTo({left:V,behavior:c});return}Ee?E.x=j.scrollLeft-V:E.x=T===Y.Right?j.scrollLeft-P.x:j.scrollLeft-G.x,E.x&&j.scrollBy({left:-E.x,behavior:c});break}else if(ae&&H.y!==b.y){const V=j.scrollTop+m.y,Ee=T===Y.Down&&V<=P.y||T===Y.Up&&V>=G.y;if(Ee&&!m.x){j.scrollTo({top:V,behavior:c});return}Ee?E.y=j.scrollTop-V:E.y=T===Y.Down?j.scrollTop-P.y:j.scrollTop-G.y,E.y&&j.scrollBy({top:-E.y,behavior:c});break}}this.handleMove(t,Ht(rn(b,this.referenceCoordinates),E))}}}handleMove(t,n){const{onMove:o}=this.props;t.preventDefault(),o(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Jn.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:o=io,onActivation:i}=t,{active:a}=n;const{code:l}=e.nativeEvent;if(o.start.includes(l)){const c=a.activatorNode.current;return c&&e.target!==c?!1:(e.preventDefault(),i==null||i({event:e.nativeEvent}),!0)}return!1}}];function yr(e){return!!(e&&"distance"in e)}function vr(e){return!!(e&&"delay"in e)}class Zn{constructor(t,n,o){var i;o===void 0&&(o=Fs(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:a}=t,{target:l}=a;this.props=t,this.events=n,this.document=Gt(l),this.documentListeners=new Zt(this.document),this.listeners=new Zt(o),this.windowListeners=new Zt(Ke(l)),this.initialCoordinates=(i=Hn(a))!=null?i:bt,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:o}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(dt.Resize,this.handleCancel),this.windowListeners.add(dt.DragStart,mr),this.windowListeners.add(dt.VisibilityChange,this.handleCancel),this.windowListeners.add(dt.ContextMenu,mr),this.documentListeners.add(dt.Keydown,this.handleKeydown),n){if(o!=null&&o({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(vr(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(yr(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:o,onPending:i}=this.props;i(o,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(dt.Click,Os,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(dt.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:o,initialCoordinates:i,props:a}=this,{onMove:l,options:{activationConstraint:c}}=a;if(!i)return;const f=(n=Hn(t))!=null?n:bt,u=rn(i,f);if(!o&&c){if(yr(c)){if(c.tolerance!=null&&An(u,c.tolerance))return this.handleCancel();if(An(u,c.distance))return this.handleStart()}if(vr(c)&&An(u,c.tolerance))return this.handleCancel();this.handlePending(c,u);return}t.cancelable&&t.preventDefault(),l(f)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===Y.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const Ns={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class er extends Zn{constructor(t){const{event:n}=t,o=Gt(n.target);super(t,Ns,o)}}er.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:o}=t;return!n.isPrimary||n.button!==0?!1:(o==null||o({event:n}),!0)}}];const zs={move:{name:"mousemove"},end:{name:"mouseup"}};var Wn;(function(e){e[e.RightClick=2]="RightClick"})(Wn||(Wn={}));class $s extends Zn{constructor(t){super(t,zs,Gt(t.event.target))}}$s.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:o}=t;return n.button===Wn.RightClick?!1:(o==null||o({event:n}),!0)}}];const Fn={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class _s extends Zn{constructor(t){super(t,Fn)}static setup(){return window.addEventListener(Fn.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(Fn.move.name,t)};function t(){}}}_s.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:o}=t;const{touches:i}=n;return i.length>1?!1:(o==null||o({event:n}),!0)}}];var en;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(en||(en={}));var mn;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(mn||(mn={}));function Ps(e){let{acceleration:t,activator:n=en.Pointer,canScroll:o,draggingRect:i,enabled:a,interval:l=5,order:c=mn.TreeOrder,pointerCoordinates:f,scrollableAncestors:u,scrollableAncestorRects:x,delta:b,threshold:m}=e;const E=Vs({delta:b,disabled:!a}),[R,j]=es(),T=s.useRef({x:0,y:0}),k=s.useRef({x:0,y:0}),D=s.useMemo(()=>{switch(n){case en.Pointer:return f?{top:f.y,bottom:f.y,left:f.x,right:f.x}:null;case en.DraggableRect:return i}},[n,i,f]),B=s.useRef(null),L=s.useCallback(()=>{const G=B.current;if(!G)return;const $=T.current.x*k.current.x,H=T.current.y*k.current.y;G.scrollBy($,H)},[]),P=s.useMemo(()=>c===mn.TreeOrder?[...u].reverse():u,[c,u]);s.useEffect(()=>{if(!a||!u.length||!D){j();return}for(const G of P){if((o==null?void 0:o(G))===!1)continue;const $=u.indexOf(G),H=x[$];if(!H)continue;const{direction:ne,speed:ae}=js(G,H,D,t,m);for(const V of["x","y"])E[V][ne[V]]||(ae[V]=0,ne[V]=0);if(ae.x>0||ae.y>0){j(),B.current=G,R(L,l),T.current=ae,k.current=ne;return}}T.current={x:0,y:0},k.current={x:0,y:0},j()},[t,L,o,j,a,l,JSON.stringify(D),JSON.stringify(E),R,u,P,x,JSON.stringify(m)])}const Hs={x:{[Re.Backward]:!1,[Re.Forward]:!1},y:{[Re.Backward]:!1,[Re.Forward]:!1}};function Vs(e){let{delta:t,disabled:n}=e;const o=Pn(t);return an(i=>{if(n||!o||!i)return Hs;const a={x:Math.sign(t.x-o.x),y:Math.sign(t.y-o.y)};return{x:{[Re.Backward]:i.x[Re.Backward]||a.x===-1,[Re.Forward]:i.x[Re.Forward]||a.x===1},y:{[Re.Backward]:i.y[Re.Backward]||a.y===-1,[Re.Forward]:i.y[Re.Forward]||a.y===1}}},[n,t,o])}function Ws(e,t){const n=t!=null?e.get(t):void 0,o=n?n.node.current:null;return an(i=>{var a;return t==null?null:(a=o??i)!=null?a:null},[o,t])}function Gs(e,t){return s.useMemo(()=>e.reduce((n,o)=>{const{sensor:i}=o,a=i.activators.map(l=>({eventName:l.eventName,handler:t(l.handler,o)}));return[...n,...a]},[]),[e,t])}var on;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(on||(on={}));var Gn;(function(e){e.Optimized="optimized"})(Gn||(Gn={}));const wr=new Map;function Us(e,t){let{dragging:n,dependencies:o,config:i}=t;const[a,l]=s.useState(null),{frequency:c,measure:f,strategy:u}=i,x=s.useRef(e),b=T(),m=nn(b),E=s.useCallback(function(k){k===void 0&&(k=[]),!m.current&&l(D=>D===null?k:D.concat(k.filter(B=>!D.includes(B))))},[m]),R=s.useRef(null),j=an(k=>{if(b&&!n)return wr;if(!k||k===wr||x.current!==e||a!=null){const D=new Map;for(let B of e){if(!B)continue;if(a&&a.length>0&&!a.includes(B.id)&&B.rect.current){D.set(B.id,B.rect.current);continue}const L=B.node.current,P=L?new Qn(f(L),L):null;B.rect.current=P,P&&D.set(B.id,P)}return D}return k},[e,a,n,b,f]);return s.useEffect(()=>{x.current=e},[e]),s.useEffect(()=>{b||E()},[n,b]),s.useEffect(()=>{a&&a.length>0&&l(null)},[JSON.stringify(a)]),s.useEffect(()=>{b||typeof c!="number"||R.current!==null||(R.current=setTimeout(()=>{E(),R.current=null},c))},[c,b,E,...o]),{droppableRects:j,measureDroppableContainers:E,measuringScheduled:a!=null};function T(){switch(u){case on.Always:return!1;case on.BeforeDragging:return n;default:return!n}}}function ao(e,t){return an(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function qs(e,t){return ao(e,t)}function Xs(e){let{callback:t,disabled:n}=e;const o=Yn(t),i=s.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:a}=window;return new a(o)},[o,n]);return s.useEffect(()=>()=>i==null?void 0:i.disconnect(),[i]),i}function In(e){let{callback:t,disabled:n}=e;const o=Yn(t),i=s.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:a}=window;return new a(o)},[n]);return s.useEffect(()=>()=>i==null?void 0:i.disconnect(),[i]),i}function Ys(e){return new Qn(Ut(e),e)}function Sr(e,t,n){t===void 0&&(t=Ys);const[o,i]=s.useState(null);function a(){i(f=>{if(!e)return null;if(e.isConnected===!1){var u;return(u=f??n)!=null?u:null}const x=t(e);return JSON.stringify(f)===JSON.stringify(x)?f:x})}const l=Xs({callback(f){if(e)for(const u of f){const{type:x,target:b}=u;if(x==="childList"&&b instanceof HTMLElement&&b.contains(e)){a();break}}}}),c=In({callback:a});return It(()=>{a(),e?(c==null||c.observe(e),l==null||l.observe(document.body,{childList:!0,subtree:!0})):(c==null||c.disconnect(),l==null||l.disconnect())},[e]),o}function Ks(e){const t=ao(e);return Zr(e,t)}const Cr=[];function Qs(e){const t=s.useRef(e),n=an(o=>e?o&&o!==Cr&&e&&t.current&&e.parentNode===t.current.parentNode?o:Cn(e):Cr,[e]);return s.useEffect(()=>{t.current=e},[e]),n}function Js(e){const[t,n]=s.useState(null),o=s.useRef(e),i=s.useCallback(a=>{const l=Bn(a.target);l&&n(c=>c?(c.set(l,Vn(l)),new Map(c)):null)},[]);return s.useEffect(()=>{const a=o.current;if(e!==a){l(a);const c=e.map(f=>{const u=Bn(f);return u?(u.addEventListener("scroll",i,{passive:!0}),[u,Vn(u)]):null}).filter(f=>f!=null);n(c.length?new Map(c):null),o.current=e}return()=>{l(e),l(a)};function l(c){c.forEach(f=>{const u=Bn(f);u==null||u.removeEventListener("scroll",i)})}},[i,e]),s.useMemo(()=>e.length?t?Array.from(t.values()).reduce((a,l)=>Ht(a,l),bt):so(e):bt,[e,t])}function Ir(e,t){t===void 0&&(t=[]);const n=s.useRef(null);return s.useEffect(()=>{n.current=null},t),s.useEffect(()=>{const o=e!==bt;o&&!n.current&&(n.current=e),!o&&n.current&&(n.current=null)},[e]),n.current?rn(e,n.current):bt}function Zs(e){s.useEffect(()=>{if(!Sn)return;const t=e.map(n=>{let{sensor:o}=n;return o.setup==null?void 0:o.setup()});return()=>{for(const n of t)n==null||n()}},e.map(t=>{let{sensor:n}=t;return n}))}function ei(e,t){return s.useMemo(()=>e.reduce((n,o)=>{let{eventName:i,handler:a}=o;return n[i]=l=>{a(l,t)},n},{}),[e,t])}function lo(e){return s.useMemo(()=>e?Is(e):null,[e])}const Er=[];function ti(e,t){t===void 0&&(t=Ut);const[n]=e,o=lo(n?Ke(n):null),[i,a]=s.useState(Er);function l(){a(()=>e.length?e.map(f=>ro(f)?o:new Qn(t(f),f)):Er)}const c=In({callback:l});return It(()=>{c==null||c.disconnect(),l(),e.forEach(f=>c==null?void 0:c.observe(f))},[e]),i}function ni(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return sn(t)?t:e}function ri(e){let{measure:t}=e;const[n,o]=s.useState(null),i=s.useCallback(u=>{for(const{target:x}of u)if(sn(x)){o(b=>{const m=t(x);return b?{...b,width:m.width,height:m.height}:m});break}},[t]),a=In({callback:i}),l=s.useCallback(u=>{const x=ni(u);a==null||a.disconnect(),x&&(a==null||a.observe(x)),o(x?t(x):null)},[t,a]),[c,f]=bn(l);return s.useMemo(()=>({nodeRef:c,rect:n,setRef:f}),[n,c,f])}const oi=[{sensor:er,options:{}},{sensor:Jn,options:{}}],si={current:{}},hn={draggable:{measure:xr},droppable:{measure:xr,strategy:on.WhileDragging,frequency:Gn.Optimized},dragOverlay:{measure:Ut}};class tn extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,o;return(n=(o=this.get(t))==null?void 0:o.node.current)!=null?n:void 0}}const ii={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new tn,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:xn},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:hn,measureDroppableContainers:xn,windowRect:null,measuringScheduled:!1},ai={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:xn,draggableNodes:new Map,over:null,measureDroppableContainers:xn},En=s.createContext(ai),co=s.createContext(ii);function li(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new tn}}}function ci(e,t){switch(t.type){case Ce.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case Ce.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case Ce.DragEnd:case Ce.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Ce.RegisterDroppable:{const{element:n}=t,{id:o}=n,i=new tn(e.droppable.containers);return i.set(o,n),{...e,droppable:{...e.droppable,containers:i}}}case Ce.SetDroppableDisabled:{const{id:n,key:o,disabled:i}=t,a=e.droppable.containers.get(n);if(!a||o!==a.key)return e;const l=new tn(e.droppable.containers);return l.set(n,{...a,disabled:i}),{...e,droppable:{...e.droppable,containers:l}}}case Ce.UnregisterDroppable:{const{id:n,key:o}=t,i=e.droppable.containers.get(n);if(!i||o!==i.key)return e;const a=new tn(e.droppable.containers);return a.delete(n),{...e,droppable:{...e.droppable,containers:a}}}default:return e}}function di(e){let{disabled:t}=e;const{active:n,activatorEvent:o,draggableNodes:i}=s.useContext(En),a=Pn(o),l=Pn(n==null?void 0:n.id);return s.useEffect(()=>{if(!t&&!o&&a&&l!=null){if(!Kn(a)||document.activeElement===a.target)return;const c=i.get(l);if(!c)return;const{activatorNode:f,node:u}=c;if(!f.current&&!u.current)return;requestAnimationFrame(()=>{for(const x of[f.current,u.current]){if(!x)continue;const b=rs(x);if(b){b.focus();break}}})}},[o,t,i,l,a]),null}function ui(e,t){let{transform:n,...o}=t;return e!=null&&e.length?e.reduce((i,a)=>a({transform:i,...o}),n):n}function fi(e){return s.useMemo(()=>({draggable:{...hn.draggable,...e==null?void 0:e.draggable},droppable:{...hn.droppable,...e==null?void 0:e.droppable},dragOverlay:{...hn.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function gi(e){let{activeNode:t,measure:n,initialRect:o,config:i=!0}=e;const a=s.useRef(!1),{x:l,y:c}=typeof i=="boolean"?{x:i,y:i}:i;It(()=>{if(!l&&!c||!t){a.current=!1;return}if(a.current||!o)return;const u=t==null?void 0:t.node.current;if(!u||u.isConnected===!1)return;const x=n(u),b=Zr(x,o);if(l||(b.x=0),c||(b.y=0),a.current=!0,Math.abs(b.x)>0||Math.abs(b.y)>0){const m=eo(u);m&&m.scrollBy({top:b.y,left:b.x})}},[t,l,c,o,n])}const uo=s.createContext({...bt,scaleX:1,scaleY:1});var Ot;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Ot||(Ot={}));const Mr=s.memo(function(t){var n,o,i,a;let{id:l,accessibility:c,autoScroll:f=!0,children:u,sensors:x=oi,collisionDetection:b=xs,measuring:m,modifiers:E,...R}=t;const j=s.useReducer(ci,void 0,li),[T,k]=j,[D,B]=cs(),[L,P]=s.useState(Ot.Uninitialized),G=L===Ot.Initialized,{draggable:{active:$,nodes:H,translate:ne},droppable:{containers:ae}}=T,V=$!=null?H.get($):null,Ee=s.useRef({initial:null,translated:null}),re=s.useMemo(()=>{var ce;return $!=null?{id:$,data:(ce=V==null?void 0:V.data)!=null?ce:si,rect:Ee}:null},[$,V]),Qe=s.useRef(null),[me,mt]=s.useState(null),[te,Et]=s.useState(null),U=nn(R,Object.values(R)),le=ln("DndDescribedBy",l),Me=s.useMemo(()=>ae.getEnabled(),[ae]),De=fi(m),{droppableRects:q,measureDroppableContainers:Ne,measuringScheduled:se}=Us(Me,{dragging:G,dependencies:[ne.x,ne.y],config:De.droppable}),Z=Ws(H,$),nt=s.useMemo(()=>te?Hn(te):null,[te]),rt=Bt(),ze=qs(Z,De.draggable.measure);gi({activeNode:$!=null?H.get($):null,config:rt.layoutShiftCompensation,initialRect:ze,measure:De.draggable.measure});const X=Sr(Z,De.draggable.measure,ze),Je=Sr(Z?Z.parentElement:null),Te=s.useRef({activatorEvent:null,active:null,activeNode:Z,collisionRect:null,collisions:null,droppableRects:q,draggableNodes:H,draggingNode:null,draggingNodeRect:null,droppableContainers:ae,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),ut=ae.getNodeFor((n=Te.current.over)==null?void 0:n.id),ot=ri({measure:De.dragOverlay.measure}),Ge=(o=ot.nodeRef.current)!=null?o:Z,$e=G?(i=ot.rect)!=null?i:X:null,st=!!(ot.nodeRef.current&&ot.rect),qt=Ks(st?null:X),yt=lo(Ge?Ke(Ge):null),pe=Qs(G?ut??Z:null),ft=ti(pe),Be=ui(E,{transform:{x:ne.x-qt.x,y:ne.y-qt.y,scaleX:1,scaleY:1},activatorEvent:te,active:re,activeNodeRect:X,containerNodeRect:Je,draggingNodeRect:$e,over:Te.current.over,overlayNodeRect:ot.rect,scrollableAncestors:pe,scrollableAncestorRects:ft,windowRect:yt}),_e=nt?Ht(nt,ne):null,Q=Js(pe),Pe=Ir(Q),Ue=Ir(Q,[X]),ye=Ht(Be,Pe),Ae=$e?vs($e,Be):null,Oe=re&&Ae?b({active:re,collisionRect:Ae,droppableRects:q,droppableContainers:Me,pointerCoordinates:_e}):null,Mt=Jr(Oe,"id"),[we,Ze]=s.useState(null),it=st?Be:Ht(Be,Ue),Nt=ms(it,(a=we==null?void 0:we.rect)!=null?a:null,X),at=s.useRef(null),vt=s.useCallback((ce,he)=>{let{sensor:ue,options:He}=he;if(Qe.current==null)return;const ie=H.get(Qe.current);if(!ie)return;const be=ce.nativeEvent,fe=new ue({active:Qe.current,activeNode:ie,event:be,options:He,context:Te,onAbort(ee){if(!H.get(ee))return;const{onDragAbort:qe}=U.current,We={id:ee};qe==null||qe(We),D({type:"onDragAbort",event:We})},onPending(ee,Ve,qe,We){if(!H.get(ee))return;const{onDragPending:gt}=U.current,y={id:ee,constraint:Ve,initialCoordinates:qe,offset:We};gt==null||gt(y),D({type:"onDragPending",event:y})},onStart(ee){const Ve=Qe.current;if(Ve==null)return;const qe=H.get(Ve);if(!qe)return;const{onDragStart:We}=U.current,xe={activatorEvent:be,active:{id:Ve,data:qe.data,rect:Ee}};Kt.unstable_batchedUpdates(()=>{We==null||We(xe),P(Ot.Initializing),k({type:Ce.DragStart,initialCoordinates:ee,active:Ve}),D({type:"onDragStart",event:xe}),mt(at.current),Et(be)})},onMove(ee){k({type:Ce.DragMove,coordinates:ee})},onEnd:lt(Ce.DragEnd),onCancel:lt(Ce.DragCancel)});at.current=fe;function lt(ee){return async function(){const{active:qe,collisions:We,over:xe,scrollAdjustedTranslate:gt}=Te.current;let y=null;if(qe&&gt){const{cancelDrop:C}=U.current;y={activatorEvent:be,active:qe,collisions:We,delta:gt,over:xe},ee===Ce.DragEnd&&typeof C=="function"&&await Promise.resolve(C(y))&&(ee=Ce.DragCancel)}Qe.current=null,Kt.unstable_batchedUpdates(()=>{k({type:ee}),P(Ot.Uninitialized),Ze(null),mt(null),Et(null),at.current=null;const C=ee===Ce.DragEnd?"onDragEnd":"onDragCancel";if(y){const A=U.current[C];A==null||A(y),D({type:C,event:y})}})}}},[H]),je=s.useCallback((ce,he)=>(ue,He)=>{const ie=ue.nativeEvent,be=H.get(He);if(Qe.current!==null||!be||ie.dndKit||ie.defaultPrevented)return;const fe={active:be};ce(ue,he.options,fe)===!0&&(ie.dndKit={capturedBy:he.sensor},Qe.current=He,vt(ue,he))},[H,vt]),oe=Gs(x,je);Zs(x),It(()=>{X&&L===Ot.Initializing&&P(Ot.Initialized)},[X,L]),s.useEffect(()=>{const{onDragMove:ce}=U.current,{active:he,activatorEvent:ue,collisions:He,over:ie}=Te.current;if(!he||!ue)return;const be={active:he,activatorEvent:ue,collisions:He,delta:{x:ye.x,y:ye.y},over:ie};Kt.unstable_batchedUpdates(()=>{ce==null||ce(be),D({type:"onDragMove",event:be})})},[ye.x,ye.y]),s.useEffect(()=>{const{active:ce,activatorEvent:he,collisions:ue,droppableContainers:He,scrollAdjustedTranslate:ie}=Te.current;if(!ce||Qe.current==null||!he||!ie)return;const{onDragOver:be}=U.current,fe=He.get(Mt),lt=fe&&fe.rect.current?{id:fe.id,rect:fe.rect.current,data:fe.data,disabled:fe.disabled}:null,ee={active:ce,activatorEvent:he,collisions:ue,delta:{x:ie.x,y:ie.y},over:lt};Kt.unstable_batchedUpdates(()=>{Ze(lt),be==null||be(ee),D({type:"onDragOver",event:ee})})},[Mt]),It(()=>{Te.current={activatorEvent:te,active:re,activeNode:Z,collisionRect:Ae,collisions:Oe,droppableRects:q,draggableNodes:H,draggingNode:Ge,draggingNodeRect:$e,droppableContainers:ae,over:we,scrollableAncestors:pe,scrollAdjustedTranslate:ye},Ee.current={initial:$e,translated:Ae}},[re,Z,Oe,Ae,H,Ge,$e,q,ae,we,pe,ye]),Ps({...rt,delta:ne,draggingRect:Ae,pointerCoordinates:_e,scrollableAncestors:pe,scrollableAncestorRects:ft});const Dt=s.useMemo(()=>({active:re,activeNode:Z,activeNodeRect:X,activatorEvent:te,collisions:Oe,containerNodeRect:Je,dragOverlay:ot,draggableNodes:H,droppableContainers:ae,droppableRects:q,over:we,measureDroppableContainers:Ne,scrollableAncestors:pe,scrollableAncestorRects:ft,measuringConfiguration:De,measuringScheduled:se,windowRect:yt}),[re,Z,X,te,Oe,Je,ot,H,ae,q,we,Ne,pe,ft,De,se,yt]),Fe=s.useMemo(()=>({activatorEvent:te,activators:oe,active:re,activeNodeRect:X,ariaDescribedById:{draggable:le},dispatch:k,draggableNodes:H,over:we,measureDroppableContainers:Ne}),[te,oe,re,X,k,le,H,we,Ne]);return Ie.createElement(Yr.Provider,{value:B},Ie.createElement(En.Provider,{value:Fe},Ie.createElement(co.Provider,{value:Dt},Ie.createElement(uo.Provider,{value:Nt},u)),Ie.createElement(di,{disabled:(c==null?void 0:c.restoreFocus)===!1})),Ie.createElement(fs,{...c,hiddenTextDescribedById:le}));function Bt(){const ce=(me==null?void 0:me.autoScrollEnabled)===!1,he=typeof f=="object"?f.enabled===!1:f===!1,ue=G&&!ce&&!he;return typeof f=="object"?{...f,enabled:ue}:{enabled:ue}}}),pi=s.createContext(null),Dr="button",hi="Draggable";function bi(e){let{id:t,data:n,disabled:o=!1,attributes:i}=e;const a=ln(hi),{activators:l,activatorEvent:c,active:f,activeNodeRect:u,ariaDescribedById:x,draggableNodes:b,over:m}=s.useContext(En),{role:E=Dr,roleDescription:R="draggable",tabIndex:j=0}=i??{},T=(f==null?void 0:f.id)===t,k=s.useContext(T?uo:pi),[D,B]=bn(),[L,P]=bn(),G=ei(l,t),$=nn(n);It(()=>(b.set(t,{id:t,key:a,node:D,activatorNode:L,data:$}),()=>{const ne=b.get(t);ne&&ne.key===a&&b.delete(t)}),[b,t]);const H=s.useMemo(()=>({role:E,tabIndex:j,"aria-disabled":o,"aria-pressed":T&&E===Dr?!0:void 0,"aria-roledescription":R,"aria-describedby":x.draggable}),[o,E,j,T,R,x.draggable]);return{active:f,activatorEvent:c,activeNodeRect:u,attributes:H,isDragging:T,listeners:o?void 0:G,node:D,over:m,setNodeRef:B,setActivatorNodeRef:P,transform:k}}function xi(){return s.useContext(co)}const mi="Droppable",yi={timeout:25};function vi(e){let{data:t,disabled:n=!1,id:o,resizeObserverConfig:i}=e;const a=ln(mi),{active:l,dispatch:c,over:f,measureDroppableContainers:u}=s.useContext(En),x=s.useRef({disabled:n}),b=s.useRef(!1),m=s.useRef(null),E=s.useRef(null),{disabled:R,updateMeasurementsFor:j,timeout:T}={...yi,...i},k=nn(j??o),D=s.useCallback(()=>{if(!b.current){b.current=!0;return}E.current!=null&&clearTimeout(E.current),E.current=setTimeout(()=>{u(Array.isArray(k.current)?k.current:[k.current]),E.current=null},T)},[T]),B=In({callback:D,disabled:R||!l}),L=s.useCallback((H,ne)=>{B&&(ne&&(B.unobserve(ne),b.current=!1),H&&B.observe(H))},[B]),[P,G]=bn(L),$=nn(t);return s.useEffect(()=>{!B||!P.current||(B.disconnect(),b.current=!1,B.observe(P.current))},[P,B]),s.useEffect(()=>(c({type:Ce.RegisterDroppable,element:{id:o,key:a,disabled:n,node:P,rect:m,data:$}}),()=>c({type:Ce.UnregisterDroppable,key:a,id:o})),[o]),s.useEffect(()=>{n!==x.current.disabled&&(c({type:Ce.SetDroppableDisabled,id:o,key:a,disabled:n}),x.current.disabled=n)},[o,a,n,c]),{active:l,rect:m,isOver:(f==null?void 0:f.id)===o,node:P,over:f,setNodeRef:G}}function yn(e,t,n){const o=e.slice();return o.splice(n<0?o.length+n:n,0,o.splice(t,1)[0]),o}function wi(e,t){return e.reduce((n,o,i)=>{const a=t.get(o);return a&&(n[i]=a),n},Array(e.length))}function fn(e){return e!==null&&e>=0}function Si(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Ci(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const fo=e=>{let{rects:t,activeIndex:n,overIndex:o,index:i}=e;const a=yn(t,o,n),l=t[i],c=a[i];return!c||!l?null:{x:c.left-l.left,y:c.top-l.top,scaleX:c.width/l.width,scaleY:c.height/l.height}},gn={scaleX:1,scaleY:1},jr=e=>{var t;let{activeIndex:n,activeNodeRect:o,index:i,rects:a,overIndex:l}=e;const c=(t=a[n])!=null?t:o;if(!c)return null;if(i===n){const u=a[l];return u?{x:0,y:n<l?u.top+u.height-(c.top+c.height):u.top-c.top,...gn}:null}const f=Ii(a,i,n);return i>n&&i<=l?{x:0,y:-c.height-f,...gn}:i<n&&i>=l?{x:0,y:c.height+f,...gn}:{x:0,y:0,...gn}};function Ii(e,t,n){const o=e[t],i=e[t-1],a=e[t+1];return o?n<t?i?o.top-(i.top+i.height):a?a.top-(o.top+o.height):0:a?a.top-(o.top+o.height):i?o.top-(i.top+i.height):0:0}const go="Sortable",po=Ie.createContext({activeIndex:-1,containerId:go,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:fo,disabled:{draggable:!1,droppable:!1}});function kr(e){let{children:t,id:n,items:o,strategy:i=fo,disabled:a=!1}=e;const{active:l,dragOverlay:c,droppableRects:f,over:u,measureDroppableContainers:x}=xi(),b=ln(go,n),m=c.rect!==null,E=s.useMemo(()=>o.map(G=>typeof G=="object"&&"id"in G?G.id:G),[o]),R=l!=null,j=l?E.indexOf(l.id):-1,T=u?E.indexOf(u.id):-1,k=s.useRef(E),D=!Si(E,k.current),B=T!==-1&&j===-1||D,L=Ci(a);It(()=>{D&&R&&x(E)},[D,E,R,x]),s.useEffect(()=>{k.current=E},[E]);const P=s.useMemo(()=>({activeIndex:j,containerId:b,disabled:L,disableTransforms:B,items:E,overIndex:T,useDragOverlay:m,sortedRects:wi(E,f),strategy:i}),[j,b,L.draggable,L.droppable,B,E,T,f,m,i]);return Ie.createElement(po.Provider,{value:P},t)}const Ei=e=>{let{id:t,items:n,activeIndex:o,overIndex:i}=e;return yn(n,o,i).indexOf(t)},Mi=e=>{let{containerId:t,isSorting:n,wasDragging:o,index:i,items:a,newIndex:l,previousItems:c,previousContainerId:f,transition:u}=e;return!u||!o||c!==a&&i===l?!1:n?!0:l!==i&&t===f},Di={duration:200,easing:"ease"},ho="transform",ji=Vt.Transition.toString({property:ho,duration:0,easing:"linear"}),ki={roleDescription:"sortable"};function Ri(e){let{disabled:t,index:n,node:o,rect:i}=e;const[a,l]=s.useState(null),c=s.useRef(n);return It(()=>{if(!t&&n!==c.current&&o.current){const f=i.current;if(f){const u=Ut(o.current,{ignoreTransform:!0}),x={x:f.left-u.left,y:f.top-u.top,scaleX:f.width/u.width,scaleY:f.height/u.height};(x.x||x.y)&&l(x)}}n!==c.current&&(c.current=n)},[t,n,o,i]),s.useEffect(()=>{a&&l(null)},[a]),a}function bo(e){let{animateLayoutChanges:t=Mi,attributes:n,disabled:o,data:i,getNewIndex:a=Ei,id:l,strategy:c,resizeObserverConfig:f,transition:u=Di}=e;const{items:x,containerId:b,activeIndex:m,disabled:E,disableTransforms:R,sortedRects:j,overIndex:T,useDragOverlay:k,strategy:D}=s.useContext(po),B=Ti(o,E),L=x.indexOf(l),P=s.useMemo(()=>({sortable:{containerId:b,index:L,items:x},...i}),[b,i,L,x]),G=s.useMemo(()=>x.slice(x.indexOf(l)),[x,l]),{rect:$,node:H,isOver:ne,setNodeRef:ae}=vi({id:l,data:P,disabled:B.droppable,resizeObserverConfig:{updateMeasurementsFor:G,...f}}),{active:V,activatorEvent:Ee,activeNodeRect:re,attributes:Qe,setNodeRef:me,listeners:mt,isDragging:te,over:Et,setActivatorNodeRef:U,transform:le}=bi({id:l,data:P,attributes:{...ki,...n},disabled:B.draggable}),Me=Zo(ae,me),De=!!V,q=De&&!R&&fn(m)&&fn(T),Ne=!k&&te,se=Ne&&q?le:null,nt=q?se??(c??D)({rects:j,activeNodeRect:re,activeIndex:m,overIndex:T,index:L}):null,rt=fn(m)&&fn(T)?a({id:l,items:x,activeIndex:m,overIndex:T}):L,ze=V==null?void 0:V.id,X=s.useRef({activeId:ze,items:x,newIndex:rt,containerId:b}),Je=x!==X.current.items,Te=t({active:V,containerId:b,isDragging:te,isSorting:De,id:l,index:L,items:x,newIndex:X.current.newIndex,previousItems:X.current.items,previousContainerId:X.current.containerId,transition:u,wasDragging:X.current.activeId!=null}),ut=Ri({disabled:!Te,index:L,node:H,rect:$});return s.useEffect(()=>{De&&X.current.newIndex!==rt&&(X.current.newIndex=rt),b!==X.current.containerId&&(X.current.containerId=b),x!==X.current.items&&(X.current.items=x)},[De,rt,b,x]),s.useEffect(()=>{if(ze===X.current.activeId)return;if(ze!=null&&X.current.activeId==null){X.current.activeId=ze;return}const Ge=setTimeout(()=>{X.current.activeId=ze},50);return()=>clearTimeout(Ge)},[ze]),{active:V,activeIndex:m,attributes:Qe,data:P,rect:$,index:L,newIndex:rt,items:x,isOver:ne,isSorting:De,isDragging:te,listeners:mt,node:H,overIndex:T,over:Et,setNodeRef:Me,setActivatorNodeRef:U,setDroppableNodeRef:ae,setDraggableNodeRef:me,transform:ut??nt,transition:ot()};function ot(){if(ut||Je&&X.current.newIndex===L)return ji;if(!(Ne&&!Kn(Ee)||!u)&&(De||Te))return Vt.Transition.toString({...u,property:ho})}}function Ti(e,t){var n,o;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e==null?void 0:e.draggable)!=null?n:t.draggable,droppable:(o=e==null?void 0:e.droppable)!=null?o:t.droppable}}function vn(e){if(!e)return!1;const t=e.data.current;return!!(t&&"sortable"in t&&typeof t.sortable=="object"&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const Bi=[Y.Down,Y.Right,Y.Up,Y.Left],Ai=(e,t)=>{let{context:{active:n,collisionRect:o,droppableRects:i,droppableContainers:a,over:l,scrollableAncestors:c}}=t;if(Bi.includes(e.code)){if(e.preventDefault(),!n||!o)return;const f=[];a.getEnabled().forEach(b=>{if(!b||b!=null&&b.disabled)return;const m=i.get(b.id);if(m)switch(e.code){case Y.Down:o.top<m.top&&f.push(b);break;case Y.Up:o.top>m.top&&f.push(b);break;case Y.Left:o.left>m.left&&f.push(b);break;case Y.Right:o.left<m.left&&f.push(b);break}});const u=hs({collisionRect:o,droppableRects:i,droppableContainers:f});let x=Jr(u,"id");if(x===(l==null?void 0:l.id)&&u.length>1&&(x=u[1].id),x!=null){const b=a.get(n.id),m=a.get(x),E=m?i.get(m.id):null,R=m==null?void 0:m.node.current;if(R&&E&&b&&m){const T=Cn(R).some((G,$)=>c[$]!==G),k=xo(b,m),D=Fi(b,m),B=T||!k?{x:0,y:0}:{x:D?o.width-E.width:0,y:D?o.height-E.height:0},L={x:E.left,y:E.top};return B.x&&B.y?L:rn(L,B)}}}};function xo(e,t){return!vn(e)||!vn(t)?!1:e.data.current.sortable.containerId===t.data.current.sortable.containerId}function Fi(e,t){return!vn(e)||!vn(t)||!xo(e,t)?!1:e.data.current.sortable.index<t.data.current.sortable.index}function Oi(e,t,n){const o={...e};return t.top+e.y<=n.top?o.y=n.top-t.top:t.bottom+e.y>=n.top+n.height&&(o.y=n.top+n.height-t.bottom),t.left+e.x<=n.left?o.x=n.left-t.left:t.right+e.x>=n.left+n.width&&(o.x=n.left+n.width-t.right),o}const Rr=e=>{let{containerNodeRect:t,draggingNodeRect:n,transform:o}=e;return!n||!t?o:Oi(o,n,t)},Tr=e=>{let{transform:t}=e;return{...t,x:0}},Li=xt("div")(({isDragging:e})=>({position:"relative",transition:"transform 0.2s ease, opacity 0.2s ease, background-color 0.2s ease",opacity:e?.8:1,cursor:e?"grabbing":"pointer",transform:e?"scale(1.02)":"none","&:hover":{opacity:e?.8:.95,cursor:"pointer"}})),Ni=xt(I)(({theme:e})=>({padding:"16px",marginBottom:"0",background:"rgba(30,30,47,0.3)",borderRadius:"8px",borderTop:"1px solid rgba(255,255,255,0.05)",width:"100%","&:hover":{borderColor:"rgba(255,105,180,0.2)",background:"rgba(30,30,47,0.4)"},transition:"all 0.2s ease-in-out",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"})),zi=xt(I)(({theme:e})=>({display:"flex",alignItems:"center",marginBottom:"8px",padding:"8px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",position:"relative","& .category-actions":{opacity:0,transition:"opacity 0.2s ease",pointerEvents:"none",position:"absolute",right:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",marginLeft:0},"&:hover .category-actions":{opacity:1,pointerEvents:"auto"},"& .drag-handle":{opacity:0,transition:"opacity 0.2s ease",cursor:"grab","&:active":{cursor:"grabbing"}},"&:hover .drag-handle":{opacity:1}})),$i=xt(I)(({theme:e})=>({display:"flex",alignItems:"center",gap:"8px",flex:1,cursor:"pointer",minWidth:0})),_i=({category:e,children:t,onAddChannel:n,onSettings:o,userPermissions:i,isOwner:a})=>{const l=a||Lt(i,"MANAGE_CATEGORIES"),c=a||Lt(i,"MANAGE_CHANNELS"),{attributes:f,listeners:u,setNodeRef:x,transform:b,transition:m,isDragging:E}=bo({id:typeof e.id=="string"?parseInt(e.id):e.id,disabled:!l}),R=T=>{T.stopPropagation(),l&&o(e)},j=T=>{T.stopPropagation(),c&&n(e.id)};return r.jsx(Li,{ref:x,style:{transform:Vt.Transform.toString(b),transition:m||"transform 0.2s ease",display:"flex",alignItems:"center"},isDragging:E,...l?{...f,...u}:{},children:r.jsxs(Ni,{sx:{background:E?"rgba(30,30,47,0.95)":"rgba(30,30,47,0.3)",boxShadow:E?"0 8px 24px rgba(0,0,0,0.2), 0 0 12px rgba(255,105,180,0.1)":"0 2px 8px rgba(0,0,0,0.1)",mb:e.channels&&e.channels.length>0?2:.5,"&:hover":{background:"rgba(30,30,47,0.5)",borderColor:E?"rgba(255,105,180,0.4)":"rgba(255,105,180,0.2)"},transition:"all 0.2s ease-in-out",flex:1,minWidth:0},children:[r.jsx(zi,{children:r.jsxs($i,{children:[r.jsx($t,{title:e.name,enterDelay:600,arrow:!0,children:r.jsx(z,{variant:"subtitle2",sx:{color:E?"rgba(255,105,180,0.9)":"rgba(255,255,255,0.7)",letterSpacing:1,fontWeight:700,transition:"all 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"calc(100% - 60px)",flex:1,minWidth:0},children:e.name})}),r.jsxs(I,{className:"category-actions",children:[l&&r.jsx(ke,{size:"small",sx:{color:"#B0B0B0","&:hover":{color:"#FF69B4"},p:"4px"},onClick:R,children:r.jsx(Un,{fontSize:"small",sx:{fontSize:20}})}),c&&r.jsx(ke,{size:"small",sx:{ml:.5,color:E?"rgba(255,105,180,0.9)":"#1976D2","&:hover":{background:E?"rgba(255,105,180,0.1)":"rgba(25,118,210,0.1)"},transition:"all 0.2s ease",p:"4px"},onClick:j,children:r.jsx(_r,{fontSize:"small"})})]})]})}),t]})})},Pi=({channel:e,children:t,userPermissions:n,isOwner:o})=>{const i=o||Lt(n,"MANAGE_CHANNELS"),{attributes:a,listeners:l,setNodeRef:c,transform:f,transition:u,isDragging:x}=bo({id:e.id,disabled:!i});return r.jsx("div",{ref:c,style:{transform:Vt.Transform.toString(f),transition:u,opacity:x?.7:1,cursor:i?"grab":"default"},...i?{...a,...l}:{},children:t})},Hi=Ye(r.jsx("path",{d:"m21.58 16.09-1.09-7.66C20.21 6.46 18.52 5 16.53 5H7.47C5.48 5 3.79 6.46 3.51 8.43l-1.09 7.66C2.2 17.63 3.39 19 4.94 19c.68 0 1.32-.27 1.8-.75L9 16h6l2.25 2.25c.48.48 1.13.75 1.8.75 1.56 0 2.75-1.37 2.53-2.91M11 11H9v2H8v-2H6v-1h2V8h1v2h2zm4-1c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m2 3c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1"})),Vi=Ye(r.jsx("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-7 9h-2V5h2zm0 4h-2v-2h2z"})),Wi=e=>r.jsx(wn,{...e}),Gi=e=>r.jsx(wn,{...e}),Ui=xt(ke)(({theme:e})=>({opacity:0,transition:"opacity 0.2s ease",pointerEvents:"none",color:"#B0B0B0","&:hover":{opacity:1,pointerEvents:"auto",color:"#FF69B4",background:"transparent"}})),qi=e=>e.type===Se.VOICE?Ur:e.name.includes("announcement")?Vi:e.name.includes("game")?Hi:Gr,Xi=({categories:e,activeChannel:t,setActiveChannel:n,openChannelSettings:o,sensors:i,handleDragEnd:a,handleChannelDragEnd:l,openCategorySettings:c,setActiveCategoryId:f,setCreateChannelOpen:u,userPermissions:x,isOwner:b,hubId:m})=>{const E=Pr(),R=k=>{n(k),E(`/hub/${m}/channel/${k.id}`)},j=b||Lt(x,"MANAGE_CHANNELS"),T=(k,D)=>{k.stopPropagation(),j&&o(D)};return r.jsx(Mr,{sensors:i,collisionDetection:br,onDragEnd:a,modifiers:[Tr,Rr],children:r.jsx(kr,{items:e.map(k=>typeof k.id=="string"?parseInt(k.id):k.id),strategy:jr,children:e.map(k=>r.jsx(_i,{category:k,onAddChannel:D=>{f(typeof D=="string"?parseInt(D):D),u(!0)},onSettings:c,userPermissions:x,isOwner:b,children:r.jsx(Mr,{sensors:i,collisionDetection:br,onDragEnd:D=>l(D,k),modifiers:[Tr,Rr],children:r.jsx(kr,{items:k.channels.map(D=>D.id),strategy:jr,children:r.jsx(I,{sx:{mb:2},children:k.channels.sort((D,B)=>(D.position??0)-(B.position??0)).map(D=>{const B=D.type===Se.VOICE?Gi:Wi,L=qi(D);return r.jsx(Pi,{channel:D,userPermissions:x,isOwner:b,children:r.jsxs(B,{alignItems:"center",onClick:()=>R(D),selected:(t==null?void 0:t.id)===D.id,sx:{cursor:"pointer","&:hover .settings-button":{opacity:1,pointerEvents:"auto"}},children:[r.jsx("span",{style:{display:"flex",alignItems:"center",minWidth:40},children:r.jsx(L,{className:"channel-icon",style:{color:"rgba(255,255,255,0.5)",fontSize:"1.2rem"}})}),r.jsx(z,{sx:{color:(t==null?void 0:t.id)===D.id?"#fff":"rgba(255,255,255,0.7)",fontWeight:(t==null?void 0:t.id)===D.id?600:400,flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:D.name}),j&&r.jsx(Ui,{className:"settings-button",size:"small",onClick:P=>T(P,D),children:r.jsx(Un,{fontSize:"small"})})]})},D.id)})})})})},k.id))})})},Yi=Ye(r.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M8.5 8c.83 0 1.5.67 1.5 1.5S9.33 11 8.5 11 7 10.33 7 9.5 7.67 8 8.5 8M12 18c-2.28 0-4.22-1.66-5-4h10c-.78 2.34-2.72 4-5 4m3.5-7c-.83 0-1.5-.67-1.5-1.5S14.67 8 15.5 8s1.5.67 1.5 1.5-.67 1.5-1.5 1.5"})),Ki=Ye(r.jsx("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6z"})),Br=Ye(r.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"})),Qi=Ye(r.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"})),Ji=Ye(r.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"})),Zi=Ye(r.jsx("path",{d:"m18 7-1.41-1.41-6.34 6.34 1.41 1.41zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12zM.41 13.41 6 19l1.41-1.41L1.83 12z"})),On=Ye(r.jsx("path",{d:"M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11"})),Ln=Ye(r.jsx("path",{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"})),Ar=(e,t)=>{const n=s.useCallback(t,[t]);s.useEffect(()=>{if(!e)return;let o=!0;return o&&(async()=>{try{await ht.subscribe(e,n)}catch(a){console.error("Failed to setup WebSocket subscription:",a)}})(),()=>{o=!1,ht.unsubscribe(e,n)}},[e,n])},Fr=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),Or=e=>{const t=new Date(e),n=new Date,o=new Date(n);if(o.setDate(o.getDate()-1),t.toDateString()===n.toDateString())return"Today";if(t.toDateString()===o.toDateString())return"Yesterday";const i=t.getFullYear()===n.getFullYear();return t.toLocaleDateString([],{weekday:"long",day:"numeric",month:"long",...i?{}:{year:"numeric"}})},ea=(e,t,n=30)=>{const o=new Date(e),i=new Date(t);return Math.abs(o.getTime()-i.getTime())/(1e3*60)<=n},Lr=$n().shape({content:_n().min(1,"Message cannot be empty").max(2e3,"Message is too long")}),ta=({activeChannel:e,user:t,hubId:n,userPermissions:o,isOwner:i})=>{const[a,l]=s.useState(!1),[c,f]=s.useState([]),[u,x]=s.useState(null),[b,m]=s.useState(null),E=s.useRef(null),[R,j]=s.useState(null),[T,k]=s.useState(!1),[D,B]=s.useState(null),[L,P]=s.useState(!0),[G,$]=s.useState(!1),[H,ne]=s.useState(new Map),[ae,V]=s.useState(new Set),[Ee,re]=s.useState(0),[Qe,me]=s.useState(!1),[mt,te]=s.useState(0),[Et,U]=s.useState(new Set),[le,Me]=s.useState(null),De=s.useRef(null),q=s.useRef(null),Ne=s.useRef(null),se=s.useRef(!1),Z=s.useRef(null),nt=s.useRef(null),rt=s.useRef(0),[ze,X]=s.useState(1),[Je,Te]=s.useState(!0),[ut,ot]=s.useState(new Set),Ge=s.useRef(null),$e=s.useRef(new Set),st=s.useRef(new Set),[qt,yt]=s.useState(!1),[pe,ft]=s.useState(null),[Be,_e]=s.useState(!1),Q=s.useRef(null),[Pe,Ue]=s.useState(!1),[ye,Ae]=s.useState(""),[Oe,Mt]=s.useState(""),[we,Ze]=s.useState(!1),it=s.useRef(null),Nt=s.useRef(null),at=s.useRef(null),[vt,je]=s.useState(!1),[oe,Dt]=s.useState(null),[Fe,Bt]=s.useState([]),[ce,he]=s.useState(!1),[ue,He]=s.useState(null),[ie,be]=s.useState(null),[fe,lt]=s.useState(!1),[ee,Ve]=s.useState(!1),[qe,We]=s.useState({lower:null,upper:null}),[xe,gt]=s.useState(!1),y=40,{data:C=[],isLoading:A}=Xo((e==null?void 0:e.type)===Se.TEXT?{channelId:(e==null?void 0:e.id)??0,params:{size:y,before:D||void 0,after:ie||void 0,around:oe||void 0}}:{channelId:0,params:{}},{skip:!e||e.type!==Se.TEXT,refetchOnMountOrArgChange:!0}),{data:F=[],isLoading:O}=Yo({channelId:(e==null?void 0:e.id)??0,search:Oe},{skip:!e||!Oe||e.type!==Se.TEXT}),[_]=Ko(),[N]=Qo(),[ge]=Jo(),{notify:ve}=Eo(),wt=Lt(o,"SEND_MESSAGES",i),Mn=Lt(o,"MANAGE_MESSAGES",i),Dn=s.useCallback((d,h,v)=>{if(console.log("🔍 Detecting gaps:",{currentMessages:d.length,aroundContext:h,targetMessageId:v}),d.length===0||h.length===0)return console.log("❌ No gap detection needed - empty data"),{hasGap:!1,gapDirection:null,boundaries:{lower:null,upper:null}};const w=d.map(de=>de.id).sort((de,et)=>de-et),p=Math.min(...w),S=Math.max(...w),M=Math.min(...h),g=Math.max(...h);console.log("📊 ID ranges:",{current:[p,S],around:[M,g],target:v});let J=null,W={lower:null,upper:null};g<p?(J="up",W={lower:g,upper:p},console.log("⬆️ Gap detected UP:",W)):M>S?(J="down",W={lower:S,upper:M},console.log("⬇️ Gap detected DOWN:",W)):(v<p||v>S)&&(v<p?(J="up",W={lower:g,upper:p},console.log("⬆️ Gap detected in MIDDLE (up):",W)):(J="down",W={lower:S,upper:M},console.log("⬇️ Gap detected in MIDDLE (down):",W)));const K=J!==null;return console.log("✅ Gap detection result:",{hasGap:K,gapDirection:J,boundaries:W}),{hasGap:K,gapDirection:J,boundaries:W}},[]),Xt=s.useCallback(()=>{console.log("🧹 Clearing gap filling state"),be(null),lt(!1),Ve(!1),We({lower:null,upper:null}),gt(!1),je(!1),se.current=!1},[]),tr=s.useCallback((d,h,v)=>{if(!d)return;if(h){const p=`/v1/user/${h}/queue/channels/${d.id}/messages`;ht.unsubscribe(p,v)}const w=`/v1/topic/channels/${d.id}/messages`;ht.unsubscribe(w,v)},[]);s.useEffect(()=>()=>{if(e&&t&&t.id&&e.id){const d=`/v1/user/${t.id}/queue/channels/${e.id}/messages`,h=`/v1/topic/channels/${e.id}/messages`;ht.unsubscribe(d,()=>{}),ht.unsubscribe(h,()=>{})}},[e==null?void 0:e.id,t==null?void 0:t.id]),s.useEffect(()=>{f([]),P(!0),B(null),x(null),j(null),k(!1),$(!1),ne(new Map),X(1),Te(!0),se.current=!1,ot(new Set),Ae(""),Mt(""),Ue(!1),Dt(null),Bt([]),console.log("Around messages context cleared"),Me(null),U(new Set),Xt(),je(!1),he(!1),He(null),V(new Set),re(0),te(0),me(!1),e&&ht.publish(`/app/v1/channels/${e.id}/messages/bulk-read-all`,{})},[e==null?void 0:e.id]);const pt=s.useCallback((d=!1)=>{if(vt||ce){console.log("Auto-scroll to bottom prevented by disableAutoScroll or isNavigatingToMessage flag");return}if(ue&&q.current){const h=document.querySelector(`[data-msg-id="${ue}"]`);if(h){const v=q.current,w=h.getBoundingClientRect(),p=v.getBoundingClientRect();if(w.bottom>p.top&&w.top<p.bottom)return}}q.current&&(d?q.current.scrollTo({top:q.current.scrollHeight,behavior:"smooth"}):q.current.scrollTop=q.current.scrollHeight,$(!1))},[vt,ce,ue]),nr=s.useCallback(()=>{je(!1),pt(!0),e&&(ht.publish(`/app/v1/channels/${e.id}/messages/bulk-read-all`,{}),f(d=>d.map(h=>h.author.id!==t.id?{...h,status:1}:h))),V(new Set),re(0),te(0),me(!1)},[e,t.id,pt]),jt=s.useCallback(d=>({...d,status:"status"in d?d.status:0}),[]);s.useEffect(()=>{if(!(!e||e.type!==Se.TEXT)){if(oe&&!A){const d=c.map(p=>p.id);if(d.includes(oe)){he(!0),je(!0),He(oe),U(new Set([oe])),Q.current&&clearTimeout(Q.current),Q.current=setTimeout(()=>{U(new Set),Me(null),Dt(null),Q.current=null},1500),setTimeout(()=>{const p=document.querySelector(`[data-msg-id="${oe}"]`);p&&(p.scrollIntoView({behavior:"smooth",block:"center"}),console.log(`Scrolled to existing message ${oe}`))},100);return}const v=C.map(p=>p.id);if(v.includes(oe)&&!v.every(S=>d.includes(S))){console.log("Loading around context for message:",oe),console.log("New around messages:",v),Bt(v),console.log("Around messages context updated:",v);const S=Dn(c,v,oe);S.hasGap?(console.log("🎯 Gap detected during navigation:",S),gt(!0),We(S.boundaries),je(!0),S.gapDirection==="down"?(lt(!0),Ve(!1),console.log("🔽 Gap filling DOWN activated")):S.gapDirection==="up"&&(Ve(!0),lt(!1),console.log("🔼 Gap filling UP activated"))):console.log("✅ No gap detected - continuous message range")}}if(!C||C.length===0){f([]),oe||setTimeout(()=>{pt(!1)},50);return}if(D===null&&ie===null||oe!==null){const d=C.map(jt),h=new Map;c.length>0&&c.forEach(p=>{typeof p.id=="number"&&p.id>0&&h.set(p.id,p)}),d.forEach(p=>{typeof p.id=="number"&&p.id>0&&h.set(p.id,p)});const v=Array.from(h.values()).sort((p,S)=>new Date(p.created_at).getTime()-new Date(S.created_at).getTime());f(v),rt.current=v.length,je(!1);const w=v.filter(p=>p.status===2&&p.author.id!==t.id);w.length>0&&(V(new Set(w.map(p=>p.id))),re(w.length)),oe||setTimeout(()=>{pt(!1)},150)}if(ie!==null&&xe){console.log("🔄 Processing gap fill with afterId:",ie);const d=C.map(w=>w.id),h=c.map(w=>w.id),v=d.some(w=>h.includes(w));if(console.log("📋 Gap fill intersection check:",{newIds:d.slice(0,3),hasIntersection:v,fillDirection:fe?"down":"up"}),v)console.log("✅ Gap filled successfully - intersection found"),Xt(),be(null),se.current=!1;else{console.log("🔗 Gap not filled yet - extending around context and merging messages");const w=C.map(jt),p=new Map;c.forEach(g=>{typeof g.id=="number"&&g.id>0&&p.set(g.id,g)}),w.forEach(g=>{typeof g.id=="number"&&g.id>0&&p.set(g.id,g)});const S=Array.from(p.values()).sort((g,J)=>new Date(g.created_at).getTime()-new Date(J.created_at).getTime());f(S);const M=[...Fe,...d];Bt(M),console.log("Around messages context extended:",M),be(null),se.current=!1}}}},[e,C,D,oe,ie,jt,t.id,pt,xe,Fe,fe,Xt]),s.useEffect(()=>{if(e&&!D&&!oe){const d=setTimeout(()=>{pt(!1)},100);return()=>clearTimeout(d)}},[e==null?void 0:e.id,D,oe,pt]),s.useEffect(()=>{(e==null?void 0:e.type)===Se.TEXT&&console.log("📡 Query parameters:",{channelId:e==null?void 0:e.id,beforeId:D,afterId:ie,aroundMessageId:oe,isGapFillingActive:xe})},[e==null?void 0:e.id,D,ie,oe,xe]),s.useEffect(()=>{oe&&le&&C.length>0&&(he(!0),je(!0),setTimeout(()=>{const d=document.querySelector(`[data-msg-id="${le}"]`);d&&(d.scrollIntoView({behavior:"smooth",block:"center"}),console.log(`Scrolled to message ${le}`),setTimeout(()=>{Dt(null)},1500))},200))},[oe,le,C]),s.useEffect(()=>{if(e&&Z.current){Z.current.focus();const d=Z.current.value.length;Z.current.setSelectionRange(d,d)}},[e]),s.useEffect(()=>{if(!e)return;const d=h=>{(h.ctrlKey||h.metaKey)&&h.key==="f"&&(h.preventDefault(),Ue(!0),setTimeout(()=>{it.current&&it.current.focus()},100)),h.key==="Escape"&&Pe&&(Ue(!1),U(new Set),Me(null),je(!1))};return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[e,Pe]),s.useEffect(()=>{if(u&&nt.current){nt.current.focus();const d=nt.current.value.length;nt.current.setSelectionRange(d,d)}},[u]),s.useEffect(()=>{E.current=b},[b]);const Yt=s.useCallback(()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur(),requestAnimationFrame(()=>{Z.current&&(Z.current.focus(),Z.current.setSelectionRange(0,0))})},[]),mo=s.useCallback(async(d,{resetForm:h})=>{if(!e||!t||!d.content.trim())return;h();const w=Date.now(),p=E.current;console.log("Reply message at start:",p),console.log("Reply message ID:",p==null?void 0:p.id);try{const S={id:-1,content:d.content,author:t,created_at:new Date().toISOString(),last_modified_at:void 0,attachments:[],status:0,read_by_count:0,channel_id:e.id,reply:p||void 0};ne(W=>{const K=new Map(W);return K.set(String(w),S),K}),setTimeout(()=>{pt(!0)},10),h();const M={channelId:e.id,content:d.content,...p!=null&&p.id?{replyId:p.id}:{}},g=await _(M).unwrap();m(null),ne(W=>{const K=new Map(W);return K.delete(String(w)),K});const J={...g,status:0,channel_id:e.id,reply:g.reply};f(W=>[...W,J])}catch(S){console.error("Failed to send message:",S),ne(M=>{const g=new Map(M);return g.delete(String(w)),g}),m(null),typeof S=="object"&&S!==null&&"status"in S&&S.status===403&&"data"in S&&typeof S.data=="object"&&S.data!==null&&"type"in S.data&&S.data.type==="ACCESS_DENIED"?ve("Недостаточно прав для отправки сообщения","error"):ve("Ошибка при отправке сообщения","error")}},[e,t,_,Yt,ve,pt]),yo=s.useCallback(async(d,{resetForm:h})=>{if(!u||!e)return;const v=d.content.trim();if(!v)return;const w=c.find(S=>S.id===u);if(!w)return;if(v===w.content){x(null),h(),Yt();return}const p={...w,content:v,last_modified_at:new Date().toISOString()};f(S=>S.map(M=>M.id===u?p:M)),x(null),h(),Yt();try{const S=await N({channelId:e.id,messageId:u,content:v}).unwrap();f(M=>M.map(g=>g.id===u?jt(S):g))}catch(S){console.error("Failed to edit message:",S),f(M=>M.map(g=>g.id===u?w:g)),ve("Ошибка при обновлении сообщения","error")}},[u,e,N,Yt,c,ve]),vo=s.useCallback(d=>{ft(d),yt(!0),_e(!1),c.find(h=>h.id===d)},[c]),wo=s.useCallback(async()=>{if(!e||!pe)return;const d=c.find(h=>h.id===pe);if(d){yt(!1),f(h=>h.filter(w=>w.id!==pe).map(w=>w.reply&&w.reply.id===pe?{...w,reply:void 0}:w));try{await ge({channelId:e.id,messageId:pe,forEveryone:Be}).unwrap()}catch(h){console.error("Ошибка при удалении сообщения",h),f(v=>{if(!v.some(w=>w.id===pe)){const w=[...v],p=w.findIndex(S=>new Date(S.created_at)>new Date(d.created_at));return p===-1?w.push(d):w.splice(p,0,d),w.map(S=>S.reply&&S.reply.id===pe?{...S,reply:d}:S)}return v}),ve("Ошибка при удалении сообщения","error")}ft(null),_e(!1)}},[e,ge,c,ve,pe,Be]),So=s.useCallback(d=>{he(!0),je(!0),He(d),B(null),Dt(d),Me(d),U(new Set([d])),Q.current&&clearTimeout(Q.current),Q.current=setTimeout(()=>{U(new Set),Me(null),Q.current=null},1500),console.log(`Navigating to message ID: ${d}`)},[]);s.useEffect(()=>{const d=q.current;if(!d)return;const h=()=>{console.log("📜 Scroll event triggered"),Ne.current&&clearTimeout(Ne.current),$(d.scrollTop+d.clientHeight<d.scrollHeight-400);const v=se.current;if(console.log("🔍 Gap filling check:",{isGapFillingActive:xe,aroundContextLength:Fe.length,isPaginationBlocked:v,isFillingGapDown:fe,isFillingGapUp:ee}),xe&&Fe.length>0&&!v){if(fe&&!ee){const g=Math.max(...Fe),J=d.querySelector(`[data-msg-id="${g}"]`);if(J){const W=J.getBoundingClientRect(),de=d.getBoundingClientRect().bottom-W.bottom;console.log("🔽 Checking gap fill down:",{lastAroundId:g,distanceFromBottom:de,threshold:100}),de<=100&&!ie&&(console.log("🚀 Triggering gap fill down from:",g),console.log("🔗 Setting afterId to:",g),se.current=!0,be(g))}}if(ee&&!fe){const g=Math.min(...Fe),J=d.querySelector(`[data-msg-id="${g}"]`);if(J){const W=J.getBoundingClientRect(),K=d.getBoundingClientRect(),de=W.top-K.top;console.log("🔼 Checking gap fill up:",{firstAroundId:g,distanceFromTop:de,threshold:100}),de<=100&&!D&&(console.log("🚀 Triggering gap fill up from:",g),se.current=!0,B(g))}}}if(d.scrollTop<d.scrollHeight/4&&!v&&L&&C.length>0&&!xe)if(C.length===y){se.current=!0,je(!1);const M=C[C.length-1];M&&B(M.id)}else P(!1);const w=d.querySelectorAll(".message-item");if(!w.length)return;let p=null,S=null;w.forEach(M=>{const g=M.getBoundingClientRect(),J=d.getBoundingClientRect();if(g.top>=J.top&&g.bottom<=J.bottom){if(!S){S=M;const de=M.getAttribute("data-date");de&&(p=Or(de))}const K=parseInt(M.getAttribute("data-msg-id")||"0",10);if(K){const de=c.find(et=>et.id===K);de&&de.author.id!==t.id&&de.status!==1&&(U(et=>{const Xe=new Set(et);return Xe.add(K),Xe}),setTimeout(()=>{U(et=>{const Xe=new Set(et);return Xe.delete(K),Xe})},1500))}}}),p&&(j(p),k(!0),Ne.current=setTimeout(()=>{k(!1)},1e3))};return d.addEventListener("scroll",h,{passive:!0}),()=>{d.removeEventListener("scroll",h),Ne.current&&clearTimeout(Ne.current)}},[C,L,e==null?void 0:e.id]),s.useEffect(()=>{if(C&&C.length>0&&D!==null){const d=q.current;if(!d)return;console.log("Processing additional loaded messages for beforeId:",D),console.log("Current messages count before pagination:",c.length);const h=d.scrollHeight,v=d.scrollTop;C.length<y&&P(!1),je(!0);const w=C.map(jt);if(f(p=>{const S=new Map;p.forEach(g=>{typeof g.id=="number"&&g.id>0&&S.set(g.id,g)}),w.forEach(g=>{typeof g.id=="number"&&g.id>0&&S.set(g.id,g)});const M=Array.from(S.values()).sort((g,J)=>new Date(g.created_at).getTime()-new Date(J.created_at).getTime());return console.log(`Pagination: Combined ${p.length} existing and ${w.length} new messages into ${M.length} total`),M}),requestAnimationFrame(()=>{requestAnimationFrame(()=>{const S=d.scrollHeight-h;console.log("Adjusting scroll position:",{before:v,after:v+S,heightAdded:S}),d.scrollTop=v+S,se.current=!1})}),xe&&ee&&D!==null){console.log("🔄 Processing gap fill up with beforeId:",D);const p=C.map(g=>g.id),S=c.map(g=>g.id),M=p.some(g=>S.includes(g));if(console.log("📋 Gap fill up intersection check:",{newIds:p.slice(0,3),hasIntersection:M,fillDirection:"up"}),M)console.log("✅ Gap filled up successfully - intersection found"),Xt(),B(null);else{console.log("🔗 Gap up not filled yet - extending around context");const g=[...p,...Fe];Bt(g),console.log("Around messages context extended (up):",g),B(null)}}}},[C,D,jt,c.length,xe,ee,Fe,Xt]),s.useEffect(()=>{if(at.current&&clearTimeout(at.current),!ye.trim()){Mt("");return}return at.current=setTimeout(()=>{Mt(ye.trim()),Ze(!0)},300),()=>{at.current&&clearTimeout(at.current)}},[ye]);const rr=s.useMemo(()=>[...c].sort((d,h)=>new Date(d.created_at).getTime()-new Date(h.created_at).getTime()),[c]),kt=s.useMemo(()=>!Pe||!Oe?[]:F,[Pe,Oe,F]);s.useEffect(()=>{const d=q.current;if(!d)return;let h=d.scrollTop,v=!1,w=0,p=null;const S=()=>{if(ce&&he(!1),ue){const K=document.querySelector(`[data-msg-id="${ue}"]`);if(K){const de=q.current,et=K.getBoundingClientRect(),Xe=de.getBoundingClientRect();et.bottom>Xe.top&&et.top<Xe.bottom||He(null)}}p&&clearTimeout(p);const M=d.scrollTop,J=d.scrollHeight-M-d.clientHeight<100;M<h?v||(v=!0,w=Date.now()):M>h&&J&&(v=!1),h=M;const W=Date.now()-w;(!v||W>1e3)&&Te(J),J&&e&&(je(!1),ht.publish(`/app/v1/channels/${e.id}/messages/bulk-read-all`,{}),f(K=>K.map(de=>de.author.id!==t.id?{...de,status:1}:de)),V(new Set),re(0),te(0),me(!1)),p=setTimeout(()=>{p=null},150)};return d.addEventListener("scroll",S,{passive:!0}),()=>d.removeEventListener("scroll",S)},[e,ce,ue]);const cn=s.useCallback(d=>{if(d.type==="MESSAGE_CREATE"&&d.message){const h=jt(d.message);if(h.author.id===t.id)return;f(w=>w.some(S=>S.id===h.id)?w:[...w,h]),U(w=>{const p=new Set(w);return p.add(h.id),p}),setTimeout(()=>{U(w=>{const p=new Set(w);return p.delete(h.id),p})},1500);const v=q.current;if(v&&v.scrollHeight-v.scrollTop-v.clientHeight<100&&e&&(f(S=>S.map(M=>M.id===h.id&&M.author.id!==t.id?{...M,status:1}:M)),st.current.add(h.id)),h.status===2){const w=q.current;if(w){const p=w.scrollHeight-w.scrollTop-w.clientHeight,S=p>300;console.log("New message received:",{isScrolledUpSignificantly:S,scrollPosition:p,messageId:h.id}),S?(me(!0),V(M=>{const g=new Set(M);return g.add(h.id),g}),re(M=>M+1),te(M=>M+1),setTimeout(()=>{const M=document.querySelector(`[data-msg-id="${h.id}"]`);if(M){const g=M.getBoundingClientRect();g.top>=0&&g.bottom<=window.innerHeight&&e&&(st.current.add(h.id),f(W=>W.map(K=>K.id===h.id?{...K,status:1}:K)),V(W=>{const K=new Set(W);return K.delete(h.id),K}),re(W=>Math.max(0,W-1)),te(W=>Math.max(0,W-1)))}},100)):e&&(st.current.add(h.id),requestAnimationFrame(()=>{w&&(w.scrollTop=w.scrollHeight,setTimeout(()=>{const M=document.querySelector(`[data-msg-id="${h.id}"]`);M&&M.scrollIntoView({behavior:"smooth",block:"nearest"})},50))}),ht.publish(`/app/v1/channels/${e.id}/messages/bulk-read-all`,{}),f(M=>M.map(g=>g.author.id!==t.id?{...g,status:1}:g)),V(new Set),re(0),te(0),me(!1))}}}else if(d.type==="MESSAGE_UPDATE"&&d.message){const h=jt(d.message);f(v=>v.some(p=>p.id===h.id)?v.map(p=>p.id===h.id?h:p):v),h.status===1&&(V(v=>{const w=new Set(v);return w.delete(h.id),w}),re(v=>Math.max(0,v-1)),te(v=>Math.max(0,v-1)))}else if(d.type==="MESSAGE_DELETE"&&d.messageId){const{messageId:h}=d;f(v=>v.some(S=>S.id===h)?v.filter(S=>S.id!==h).map(S=>S.reply&&S.reply.id===h?{...S,reply:void 0}:S):v),V(v=>{const w=new Set(v);return w.delete(h),w}),re(v=>Math.max(0,v-1)),te(v=>Math.max(0,v-1))}else if(d.type==="MESSAGE_READ_STATUS"&&d.message_range){const{from:h,to:v}=d.message_range;f(w=>w.map(p=>{if(p.id>=h&&p.id<=v&&p.author.id===t.id){const S=p.read_by_count||0;return{...p,read_by_count:S+1}}return p})),console.log(`Обновлены счетчики прочтений для сообщений в диапазоне ${h}-${v}`)}},[Je,t.id,e,jt]);Ar(e&&t?`/v1/user/${t.id}/queue/channels/${e.id}/messages`:null,cn),Ar(e?`/v1/topic/channels/${e.id}/messages`:null,cn),s.useEffect(()=>{if(!e)return;const d=()=>{if(st.current.size>0){const v=Array.from(st.current);ht.publish(`/app/v1/channels/${e.id}/messages/bulk-read`,{messageIds:v}),st.current.clear()}},h=setInterval(d,1e3);return()=>{clearInterval(h),d()}},[e]),s.useEffect(()=>{if(!q.current||!e)return;const d=new IntersectionObserver(v=>{v.forEach(w=>{const p=parseInt(w.target.getAttribute("data-msg-id")||"0",10);if(p)if(w.isIntersecting){$e.current.add(p);const S=c.find(M=>M.id===p);S&&S.author.id!==t.id&&S.status!==1&&(st.current.add(p),U(M=>{const g=new Set(M);return g.add(p),g}),setTimeout(()=>{U(M=>{const g=new Set(M);return g.delete(p),g})},1500),f(M=>M.map(g=>g.id===p?{...g,status:1}:g)),V(M=>{const g=new Set(M);return g.delete(p),g}),re(M=>Math.max(0,M-1)),te(M=>Math.max(0,M-1))),Ee<=1&&me(!1)}else $e.current.delete(p)})},{root:q.current,threshold:.5});return q.current.querySelectorAll(".message-item").forEach(v=>d.observe(v)),()=>{d.disconnect(),Ge.current&&clearTimeout(Ge.current)}},[c,t.id,e]),s.useEffect(()=>{const d=q.current;if(!d)return;const h=()=>{const v=d.scrollHeight-d.scrollTop-d.clientHeight<100;Te(v);const w=se.current;if(console.log("🔍 Gap filling check (stable handler):",{isGapFillingActive:xe,aroundContextLength:Fe.length,isPaginationBlocked:w,isFillingGapDown:fe,isFillingGapUp:ee}),xe&&Fe.length>0&&!w){if(fe&&!ee){const S=Math.max(...Fe),M=d.querySelector(`[data-msg-id="${S}"]`);if(M){const g=M.getBoundingClientRect(),W=d.getBoundingClientRect().bottom-g.bottom;console.log("🔽 Checking gap fill down (stable):",{lastAroundId:S,distanceFromBottom:W,threshold:100}),W<=100&&!ie&&(console.log("🚀 Triggering gap fill down from (stable):",S),console.log("🔗 Setting afterId to (stable):",S),se.current=!0,be(S))}}if(ee&&!fe){const S=Math.min(...Fe),M=d.querySelector(`[data-msg-id="${S}"]`);if(M){const g=M.getBoundingClientRect(),J=d.getBoundingClientRect(),W=g.top-J.top;console.log("🔼 Checking gap fill up (stable):",{firstAroundId:S,distanceFromTop:W,threshold:100}),W<=100&&!D&&(console.log("🚀 Triggering gap fill up from (stable):",S),se.current=!0,B(S))}}}};return d.addEventListener("scroll",h,{passive:!0}),()=>d.removeEventListener("scroll",h)},[xe,Fe,fe,ee,ie,D]),s.useEffect(()=>()=>{Ge.current&&clearTimeout(Ge.current),Q.current&&clearTimeout(Q.current),e&&t&&tr(e,t.id,cn)},[e,t,cn,tr]),s.useEffect(()=>{Je&&(me(!1),te(0))},[Je]),s.useEffect(()=>{Pe||(Ae(""),Ze(!1),!oe&&!le&&setTimeout(()=>{if(q.current){const{scrollHeight:d,scrollTop:h,clientHeight:v}=q.current;d-h-v<200&&pt(!0)}},100))},[Pe,oe,le,pt]),s.useEffect(()=>{const d=h=>{we&&Nt.current&&it.current&&!Nt.current.contains(h.target)&&!it.current.contains(h.target)&&Ze(!1)};return document.addEventListener("mousedown",d),()=>{document.removeEventListener("mousedown",d)}},[we]);const Co=()=>r.jsx(I,{sx:{flex:1,p:3,display:"flex",flexDirection:"column",gap:2},children:[...Array(5)].map((d,h)=>r.jsxs(I,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[r.jsx(Le,{variant:"circular",width:40,height:40,sx:{bgcolor:"rgba(255,255,255,0.1)"}}),r.jsxs(I,{sx:{flex:1},children:[r.jsx(Le,{variant:"text",width:120,height:24,sx:{bgcolor:"rgba(255,255,255,0.1)",mb:1}}),r.jsx(Le,{variant:"text",width:"80%",height:20,sx:{bgcolor:"rgba(255,255,255,0.1)"}}),r.jsx(Le,{variant:"text",width:"60%",height:20,sx:{bgcolor:"rgba(255,255,255,0.1)"}})]})]},h))}),Io=()=>r.jsx(I,{ref:q,className:"messages-container",sx:{flex:1,p:3,overflowY:"auto",display:"flex",flexDirection:"column",gap:1,position:"relative","&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"rgba(255,255,255,0.05)",borderRadius:"4px"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.1)",borderRadius:"4px","&:hover":{background:"rgba(255,255,255,0.15)"}}},children:rr.length===0&&H.size===0?r.jsx(I,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"rgba(255,255,255,0.5)",textAlign:"center",gap:2},children:Pe&&ye.trim()?r.jsxs(r.Fragment,{children:[r.jsx(z,{variant:"h6",children:"Нет результатов поиска"}),r.jsx(z,{variant:"body2",children:"Попробуйте изменить поисковый запрос"})]}):r.jsxs(r.Fragment,{children:[r.jsx(z,{variant:"h6",children:"Нет сообщений"}),r.jsx(z,{variant:"body2",children:"Начните общение, отправив первое сообщение"})]})}):r.jsxs(r.Fragment,{children:[r.jsx(Rn,{in:T,timeout:{enter:300,exit:500},children:r.jsx(I,{sx:{position:"sticky",top:0,zIndex:10,alignSelf:"center",backgroundColor:"rgba(30,30,47,0.85)",backdropFilter:"blur(8px)",borderRadius:"16px",px:2,py:.75,mb:1,boxShadow:"0 2px 8px rgba(0,0,0,0.2)",border:"1px solid rgba(255,255,255,0.1)",transition:"all 0.3s ease"},children:r.jsx(z,{sx:{color:"rgba(255,255,255,0.9)",fontWeight:600,fontSize:"0.9rem"},children:R})})}),(()=>{let d=[],h=null,v=null,w=[],p=null,S=new Set;return[...rr,...Array.from(H.values())].forEach((g,J)=>{const K=new Date(g.created_at).toDateString();p!==K&&!S.has(K)&&(w.length>0&&(d.push(...w),w=[]),d.push(r.jsxs(I,{className:"date-separator","data-date":g.created_at,sx:{display:"flex",justifyContent:"center",alignItems:"center",my:2,position:"relative"},children:[r.jsx(I,{sx:{backgroundColor:"rgba(30,30,47,0.85)",backdropFilter:"blur(8px)",borderRadius:"16px",px:2,py:.75,boxShadow:"0 2px 8px rgba(0,0,0,0.2)",border:"1px solid rgba(255,255,255,0.1)",zIndex:2},children:r.jsx(z,{sx:{color:"rgba(255,255,255,0.9)",fontWeight:600,fontSize:"0.9rem"},children:Or(g.created_at)})}),r.jsx(I,{sx:{position:"absolute",height:"1px",width:"100%",backgroundColor:"rgba(255,255,255,0.08)",zIndex:1}})]},`date-${K}`)),p=K,S.add(K));const et=h!==g.author.id||v&&!ea(v,g.created_at),Xe=g.id===-1,or=r.jsxs(I,{className:"message-item","data-date":g.created_at,"data-msg-id":g.id.toString(),sx:{display:"flex",gap:2,alignItems:"flex-start",position:"relative",borderRadius:"10px",transition:"background-color 0.3s ease, box-shadow 0.5s ease",opacity:Xe?.6:1,backgroundColor:le===g.id?"rgba(0, 207, 255, 0.25)":Et.has(g.id)?"rgba(33, 150, 243, 0.25)":ae.has(g.id)?"rgba(25,118,210,0.1)":"transparent","&.highlight-pulse":{animation:"pulse 2s infinite"},"&:hover":{backgroundColor:le===g.id?"rgba(0, 207, 255, 0.35)":Et.has(g.id)?"rgba(33, 150, 243, 0.35)":ae.has(g.id)?"rgba(25,118,210,0.15)":"rgba(255,255,255,0.05)"},"&:hover .message-actions":{opacity:Xe?0:1,pointerEvents:Xe?"none":"auto"}},children:[r.jsx(I,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",width:40,ml:1,mt:1},children:et?r.jsx("div",{style:{cursor:"pointer"},children:r.jsx(zn,{src:g.author.avatar||void 0,alt:g.author.login,userId:g.author.id,hubId:n})}):null}),r.jsxs(I,{sx:{flex:1,position:"relative"},children:[r.jsx(I,{sx:{maxWidth:"100%"},children:r.jsxs(I,{sx:{py:"5px",px:"0px",pl:0},children:[et&&r.jsx(z,{sx:{color:"#00CFFF",fontWeight:700,mb:.5,fontSize:"1rem",letterSpacing:.2},children:g.author.login}),g.reply&&r.jsxs(I,{sx:{display:"flex",alignItems:"flex-start",gap:1,mb:1,cursor:"pointer",p:"4px 8px",width:"100%",ml:-1,mr:-1,borderRadius:1,backgroundColor:"rgba(0, 207, 255, 0.05)",borderLeft:"3px solid #00CFFF","&:hover":{backgroundColor:"rgba(0, 207, 255, 0.1)"}},onClick:()=>{const Rt=document.querySelector(`[data-msg-id='${g.reply.id}']`);Rt&&(Rt.scrollIntoView({behavior:"smooth",block:"center"}),Q.current&&(clearTimeout(Q.current),Q.current=null),Me(null),U(new Set),Me(g.reply.id),U(zt=>{const At=new Set;return At.add(g.reply.id),At}),Q.current=setTimeout(()=>{U(zt=>{const At=new Set(zt);return At.delete(g.reply.id),At}),Me(null),Q.current=null},1500))},children:[r.jsx(On,{sx:{color:"#00CFFF",fontSize:"0.85rem",mt:"2px"}}),r.jsxs(I,{sx:{flex:1,minWidth:0},children:[r.jsx(z,{sx:{color:"#00CFFF",fontWeight:600,fontSize:"0.85rem",mb:.25},children:g.reply.author.login}),r.jsx(z,{sx:{color:"rgba(255,255,255,0.6)",fontSize:"1rem",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:g.reply.content})]})]}),u===g.id?r.jsx(_t,{initialValues:{content:g.content},validationSchema:Lr,onSubmit:yo,children:({handleSubmit:Rt,values:zt,setFieldValue:At})=>r.jsx(Pt,{children:r.jsxs(I,{sx:{display:"flex",flexDirection:"column",gap:1,background:"rgba(30,30,47,0.9)",borderRadius:"8px",padding:"8px",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"},children:[r.jsx(jn,{name:"content",component:ur,multiline:!0,fullWidth:!0,size:"small",inputRef:nt,onKeyDown:St=>{St.key==="Enter"&&!St.shiftKey?(St.preventDefault(),Rt()):St.key==="Escape"&&(St.preventDefault(),x(null))}}),r.jsxs(I,{sx:{display:"flex",gap:1,justifyContent:"flex-end",padding:"4px 8px"},children:[r.jsx(ke,{size:"small",onClick:St=>{St.preventDefault(),x(null)},sx:{color:"#d32f2f","&:hover":{background:"rgba(211,47,47,0.1)"}},children:r.jsx(kn,{fontSize:"small"})}),r.jsx(ke,{size:"small",onClick:St=>Rt(),disabled:!zt.content,sx:{color:zt.content?"#1976D2":"rgba(255,255,255,0.3)",transition:"color 0.25s cubic-bezier(.4,0,.2,1)","&:hover":{color:zt.content?"#1976D2":"rgba(255,255,255,0.3)"}},children:r.jsx(Br,{fontSize:"small"})})]})]})})}):r.jsxs(I,{sx:{display:"flex",flexDirection:"column",position:"relative"},children:[r.jsx(z,{sx:{color:"rgba(255,255,255,0.85)",wordBreak:"break-word",fontSize:"1.01rem",whiteSpace:"pre-wrap",pr:"120px",pl:0,lineHeight:1.4},component:"span",dangerouslySetInnerHTML:{__html:sr.sanitize((()=>{let Rt=g.content.replace(/\r\n/g,`
`).replace(/\n/g,"<br>");if(Pe&&ye.trim()){const At=ye.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),St=new RegExp(`(${At})`,"gi");Rt=Rt.replace(St,'<span style="background-color: rgba(0, 207, 255, 0.3); color: #fff; border-radius: 2px; padding: 0; font-weight: 600;">$1</span>')}return Rt})())}}),r.jsxs(I,{sx:{display:"flex",alignItems:"center",gap:.5,position:"absolute",top:0,right:0},children:[g.last_modified_at&&g.last_modified_at!==g.created_at&&r.jsx("span",{style:{color:"#90caf9",fontSize:"0.85em",fontStyle:"italic",fontWeight:500},children:"ред."}),g.author.id===t.id&&r.jsx(I,{sx:{display:"flex",alignItems:"center",gap:.5,mr:.5},children:r.jsx(Zi,{sx:{fontSize:"1rem",color:g.read_by_count&&g.read_by_count>0?"#FF69B4":"rgba(255,255,255,0.35)"}})}),r.jsx(z,{sx:{color:"rgba(255,255,255,0.35)",fontSize:"0.78rem",lineHeight:1,whiteSpace:"nowrap",display:"flex",alignItems:"center",gap:.5},children:Fr(g.created_at)})]})]})]})}),!Xe&&r.jsxs(I,{className:"message-actions",sx:{position:"absolute",top:-38,left:"50%",transform:"translateX(-50%)",display:"flex",gap:1,opacity:0,pointerEvents:"none",transition:"opacity 0.2s",zIndex:10,background:"rgba(20,20,35,0.85)",borderRadius:2,boxShadow:"0 8px 24px 0 rgba(0,0,0,0.3), 0 0 12px 0 rgba(149,128,255,0.2)",px:1.5,py:.5,border:"1px solid rgba(149,128,255,0.25)",backdropFilter:"blur(12px)"},children:[r.jsx($t,{title:"Ответить",enterDelay:1e3,placement:"top",children:r.jsx(ke,{size:"small",onClick:()=>{console.log("Setting reply message:",g),m(g),Yt()},sx:{color:"#00FFBA",transition:"all 0.2s ease",padding:"6px",backgroundColor:"rgba(0, 255, 186, 0.12)","&:hover":{color:"#00FFBA",backgroundColor:"rgba(0, 255, 186, 0.25)",transform:"translateY(-2px)",boxShadow:"0 4px 8px rgba(0, 255, 186, 0.3)"}},children:r.jsx(On,{fontSize:"small"})})}),g.author.id===t.id&&r.jsx($t,{title:"Редактировать",enterDelay:1e3,placement:"top",children:r.jsx(ke,{size:"small",onClick:()=>x(g.id),sx:{color:"#00CFFF",transition:"all 0.2s ease",padding:"6px",backgroundColor:"rgba(0, 207, 255, 0.12)","&:hover":{color:"#00CFFF",backgroundColor:"rgba(0, 207, 255, 0.25)",transform:"translateY(-2px)",boxShadow:"0 4px 8px rgba(0, 207, 255, 0.3)"}},children:r.jsx(Ji,{fontSize:"small"})})}),r.jsx($t,{title:"Удалить",enterDelay:1e3,placement:"top",children:r.jsx(ke,{size:"small",onClick:()=>vo(g.id),sx:{color:"#FF3D71",transition:"all 0.2s ease",padding:"6px",backgroundColor:"rgba(255, 61, 113, 0.12)","&:hover":{color:"#FF3D71",backgroundColor:"rgba(255, 61, 113, 0.25)",transform:"translateY(-2px)",boxShadow:"0 4px 8px rgba(255, 61, 113, 0.3)"}},children:r.jsx(Qi,{fontSize:"small"})})})]})]})]},Xe?`temp-${g.created_at}`:g.id);w.push(or),h=g.author.id,v=g.created_at}),w.length>0&&d.push(...w),d})(),r.jsx("div",{ref:De})]})});return r.jsxs(I,{sx:{flex:1,display:"flex",flexDirection:"column",background:"rgba(30,30,47,0.95)",backdropFilter:"blur(10px)",position:"relative"},children:[r.jsx(Qt,{open:qt,onClose:()=>{yt(!1),ft(null),_e(!1)},title:"Удалить сообщение",children:r.jsxs(I,{sx:{p:2,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[pe&&(()=>{const d=c.find(w=>w.id===pe),v=d&&d.author.id===t.id||Mn;return r.jsxs(I,{sx:{mb:3,width:"100%",maxWidth:300},children:[v&&r.jsxs(I,{onClick:()=>_e(!Be),sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",p:1.5,mb:1.5,borderRadius:2,cursor:"pointer",backgroundColor:Be?"rgba(255, 61, 113, 0.1)":"rgba(0,0,0,0.15)",border:`1px solid ${Be?"rgba(255, 61, 113, 0.3)":"rgba(255,255,255,0.1)"}`,transition:"all 0.2s ease","&:hover":{backgroundColor:Be?"rgba(255, 61, 113, 0.15)":"rgba(0,0,0,0.2)",transform:"translateY(-2px)"}},children:[r.jsxs(I,{sx:{display:"flex",alignItems:"center",mb:.5},children:[r.jsx(No,{checked:Be,onChange:w=>_e(w.target.checked),sx:{color:"rgba(255,255,255,0.5)",p:.5,mr:1,"&.Mui-checked":{color:"#FF3D71"}}}),r.jsx(z,{sx:{fontWeight:500,fontSize:"0.9rem"},children:"Удалить у всех"})]}),r.jsx(z,{variant:"body2",sx:{color:"rgba(255,255,255,0.6)",fontStyle:"italic",fontSize:"0.75rem",textAlign:"center"},children:Be?"Сообщение исчезнет у всех участников чата":"Сообщение останется видимым для других"})]}),r.jsx(z,{sx:{color:"rgba(255,255,255,0.7)",fontSize:"0.75rem",textAlign:"center",mt:1},children:v?Be?"":"Сообщение будет скрыто только в вашем интерфейсе":"Сообщение будет скрыто только для вас"})]})})(),r.jsxs(I,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[r.jsx(ct,{variant:"outlined",onClick:()=>{yt(!1),ft(null),_e(!1)},sx:{color:"rgba(255,255,255,0.7)",borderColor:"rgba(255,255,255,0.2)",borderRadius:2,px:3,"&:hover":{borderColor:"rgba(255,255,255,0.4)",backgroundColor:"rgba(255,255,255,0.05)"}},children:"Отмена"}),r.jsx(ct,{variant:"contained",onClick:wo,sx:{backgroundColor:"#FF3D71",color:"#fff",borderRadius:2,px:3,"&:hover":{backgroundColor:"#FF1744"}},children:"Удалить"})]})]})}),r.jsxs(I,{sx:{height:60,px:3,display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:[r.jsx(z,{variant:"h6",sx:{color:"#fff",fontWeight:700},children:(e==null?void 0:e.name)||"Select a channel"}),Pe?r.jsxs(I,{sx:{display:"flex",flexDirection:"column",position:"relative",zIndex:1050},children:[r.jsx(I,{sx:{display:"flex",alignItems:"center",background:"rgba(255,255,255,0.05)",borderRadius:we&&ye.trim()&&kt.length>0?"20px 20px 0 0":"20px",border:"1px solid rgba(255,255,255,0.1)",borderBottom:we&&ye.trim()&&kt.length>0?"none":"1px solid rgba(255,255,255,0.1)",paddingLeft:2,paddingRight:1,width:"300px",transition:"all 0.3s ease"},children:r.jsx(_t,{initialValues:{query:ye},onSubmit:()=>{},enableReinitialize:!0,children:({values:d,setFieldValue:h})=>r.jsxs(Pt,{style:{width:"100%",display:"flex",alignItems:"center"},children:[r.jsxs(I,{sx:{display:"flex",alignItems:"center",width:"100%",position:"relative"},children:[r.jsx(jn,{name:"query",children:({field:v,form:w})=>r.jsx("input",{...v,ref:it,onChange:p=>{v.onChange(p),Ae(p.target.value);const S=p.target.value.trim()&&c.filter(M=>M.content.toLowerCase().includes(p.target.value.toLowerCase().trim())||M.author.login.toLowerCase().includes(p.target.value.toLowerCase().trim())).length>0;Ze(!!S)},onFocus:()=>{var p;(p=v.value)!=null&&p.trim()&&kt.length>0&&Ze(!0)},onBlur:p=>{p.preventDefault()},placeholder:"Поиск сообщений...",style:{background:"transparent",border:"none",outline:"none",color:"#fff",width:"100%",fontSize:"0.9rem",padding:"8px 0"},onKeyDown:p=>{p.key==="Escape"&&(we?Ze(!1):(Ue(!1),Ae(""),w.resetForm(),je(!1)))}})}),ye.trim()&&r.jsxs(z,{variant:"caption",sx:{position:"absolute",right:0,top:"-18px",color:kt.length>0?"#00FFBA":"#FF69B4",fontSize:"0.7rem",fontWeight:500,padding:"2px 6px",borderRadius:"4px",background:"rgba(0,0,0,0.3)"},children:[kt.length," ",kt.length===1?"result":"results"]})]}),r.jsx(ke,{type:"button",size:"small",onClick:()=>{we?Ze(!1):(Ue(!1),Ae(""),h("query",""),je(!1))},sx:{color:"rgba(255,255,255,0.5)","&:hover":{color:"rgba(255,255,255,0.9)",background:"rgba(255,255,255,0.1)"}},children:we?r.jsx(Ln,{fontSize:"small"}):r.jsx(kn,{fontSize:"small"})})]})})}),we&&ye.trim()&&r.jsxs(I,{ref:Nt,sx:{position:"absolute",top:"100%",left:0,width:"100%",maxHeight:"300px",overflowY:"auto",background:"rgba(20,20,35,0.95)",borderRadius:"0 0 10px 10px",border:"1px solid rgba(255,255,255,0.1)",borderTop:"none",boxShadow:"0 10px 25px rgba(0,0,0,0.3)",zIndex:1051,backdropFilter:"blur(10px)","&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-track":{background:"rgba(255,255,255,0.05)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.1)",borderRadius:"3px","&:hover":{background:"rgba(255,255,255,0.15)"}}},children:[O&&r.jsxs(I,{sx:{p:2,display:"flex",justifyContent:"center",alignItems:"center"},children:[r.jsx(I,{sx:{width:24,height:24,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.1)",borderTop:"2px solid rgba(0,207,255,0.7)",animation:"spin 1s linear infinite","@keyframes spin":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}}}),r.jsx(z,{sx:{ml:2,color:"rgba(255,255,255,0.7)",fontSize:"0.9rem"},children:"Поиск сообщений..."})]}),!O&&kt.length===0&&Oe&&r.jsx(I,{sx:{p:3,textAlign:"center"},children:r.jsxs(z,{sx:{color:"rgba(255,255,255,0.5)",fontSize:"0.9rem"},children:["По запросу ",r.jsx(I,{component:"span",sx:{fontWeight:"bold",color:"#00CFFF"},children:Oe})," ничего не найдено"]})}),!O&&kt.length>0&&kt.map(d=>r.jsxs(I,{onClick:()=>{Ze(!1),Ue(!1),So(d.id)},sx:{p:1.5,borderBottom:"1px solid rgba(255,255,255,0.05)",cursor:"pointer","&:hover":{background:"rgba(255,255,255,0.05)"},transition:"all 0.2s ease",display:"flex",flexDirection:"column",gap:.5},children:[r.jsxs(I,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[r.jsx(zn,{src:d.author.avatar||void 0,alt:d.author.login,userId:d.author.id,hubId:n,sx:{width:24,height:24,"& span":{fontSize:"1rem !important",top:"2px !important"}}}),r.jsx(z,{sx:{fontWeight:600,fontSize:"0.85rem",color:"rgba(255,255,255,0.95)"},children:d.author.login}),r.jsx(I,{sx:{flexGrow:1}}),r.jsx(z,{sx:{fontSize:"0.7rem",color:"rgba(255,255,255,0.5)",ml:"auto"},children:Fr(d.created_at)})]}),r.jsx(z,{sx:{fontSize:"0.85rem",color:"rgba(255,255,255,0.8)",overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical","& mark":{backgroundColor:"rgba(0, 207, 255, 0.25)",color:"#00CFFF",padding:"0 1px",borderRadius:"2px",fontWeight:"bold"}},dangerouslySetInnerHTML:{__html:sr.sanitize((()=>{let h=d.content;if(h.length>150&&(h=h.substring(0,150)+"..."),h=h.replace(/\r\n/g," ").replace(/\n/g," "),Oe.trim()){const w=Oe.trim().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),p=new RegExp(`(${w})`,"gi");h=h.replace(p,"<mark>$1</mark>")}return h})())}})]},d.id))]})]}):r.jsx($t,{title:"Поиск сообщений (Ctrl + F)",placement:"top",children:r.jsx(ke,{onClick:()=>{Ue(!0),setTimeout(()=>{it.current&&it.current.focus()},100)},sx:{color:Pe?"#00CFFF":"rgba(255,255,255,0.6)","&:hover":{color:Pe?"#00CFFF":"rgba(255,255,255,0.9)",background:"rgba(255,255,255,0.05)"}},children:r.jsx(Mo,{})})})]}),A&&!D?Co():Io(),r.jsx(Rn,{in:G,children:r.jsx(ke,{onClick:nr,sx:{position:"absolute",bottom:b?160:100,right:20,backgroundColor:"rgba(30,30,47,0.95)",backdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 4px 12px rgba(0,0,0,0.2)","&:hover":{backgroundColor:"rgba(40,40,57,0.95)"},zIndex:1e3,transition:"bottom 0.2s ease-out"},children:r.jsx(Ln,{sx:{color:"#fff"}})})}),r.jsx(Rn,{in:mt>0||Ee>0,children:r.jsx(I,{sx:{position:"absolute",bottom:b?160:100,left:"50%",transform:"translateX(-50%)",zIndex:1e3,transition:"bottom 0.2s ease-out"},children:r.jsxs(Jt,{sx:{backgroundColor:"#FF69B4",color:"#fff",px:2,py:1,borderRadius:"20px",cursor:"pointer",boxShadow:"0 4px 12px rgba(255,105,180,0.2)",display:"flex",alignItems:"center",gap:1,"&:hover":{backgroundColor:"#FF1493"}},onClick:nr,children:[r.jsx(Ln,{}),r.jsxs(z,{variant:"body2",sx:{fontWeight:600},children:[mt||Ee," ",(mt||Ee)===1?"новое сообщение":"новых сообщений"]})]})})}),r.jsx(I,{sx:{p:2},children:wt?r.jsxs(I,{sx:{display:"flex",flexDirection:"column",gap:1},children:[b&&r.jsxs(Jt,{sx:{p:"8px 16px",display:"flex",alignItems:"flex-start",gap:1,background:"rgba(30,30,47,0.95)",border:"1px solid rgba(149,128,255,0.25)",borderRadius:2,position:"relative",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",mb:1,pl:3,width:"100%"},children:[r.jsx(I,{sx:{position:"absolute",left:0,top:0,bottom:0,width:"4px",backgroundColor:"#00CFFF",borderTopLeftRadius:2,borderBottomLeftRadius:2}}),r.jsxs(I,{sx:{flex:1,cursor:"pointer"},onClick:()=>{if(b&&b.id){const d=document.querySelector(`[data-msg-id='${b.id}']`);d&&(d.scrollIntoView({behavior:"smooth",block:"center"}),Q.current&&(clearTimeout(Q.current),Q.current=null),Me(null),U(new Set),Me(b.id),U(h=>{const v=new Set;return v.add(b.id),v}),Q.current=setTimeout(()=>{U(h=>{const v=new Set(h);return v.delete(b.id),v}),Me(null),Q.current=null},1500))}},children:[r.jsxs(I,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[r.jsx(On,{sx:{color:"#00CFFF",fontSize:"0.9rem"}}),r.jsx(z,{sx:{color:"#00CFFF",fontWeight:600,fontSize:"0.9rem"},children:b.author.login})]}),r.jsx(z,{sx:{color:"rgba(255,255,255,0.7)",fontSize:"0.85rem",maxWidth:"500px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxHeight:"1.5em"},children:(()=>{const d=b.content;return d.length>150?!(d.indexOf(" ")!==-1)&&d.length>100?d.substring(0,100)+"...":d.substring(0,150)+"...":d})()})]}),r.jsx(ke,{size:"small",onClick:()=>m(null),sx:{color:"rgba(255,255,255,0.5)","&:hover":{color:"rgba(255,255,255,0.8)"}},children:r.jsx(kn,{fontSize:"small"})})]}),r.jsx(Jt,{sx:{p:"8px 16px",display:"flex",alignItems:"center",gap:1,background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:3},children:r.jsx(_t,{initialValues:{content:""},validationSchema:Lr,onSubmit:mo,children:({handleSubmit:d,values:h,setFieldValue:v})=>r.jsxs(r.Fragment,{children:[r.jsx(Pt,{style:{width:"100%"},children:r.jsx(jn,{name:"content",component:ur,placeholder:"Type a message...",multiline:!0,maxRows:4,size:"small",disabled:!e||a,inputRef:Z,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"transparent"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"transparent"},"& .MuiOutlinedInput-notchedOutline":{borderColor:"transparent"}}},onKeyDown:w=>{w.key==="Enter"&&!w.shiftKey&&(w.preventDefault(),d())}})}),r.jsxs(Hr,{direction:"row",spacing:1,children:[r.jsx(ke,{size:"small",sx:{color:"#FF69B4"},children:r.jsx(Yi,{})}),r.jsx(ke,{size:"small",sx:{color:"#1E90FF"},children:r.jsx(Ki,{})}),r.jsx(ke,{size:"small",sx:{color:h.content?"#1976D2":"rgba(255,255,255,0.3)",transition:"color 0.25s cubic-bezier(.4,0,.2,1)","&:hover":{color:h.content?"#1976D2":"rgba(255,255,255,0.3)"}},onClick:()=>d(),disabled:a||!h.content,children:r.jsx(Br,{})})]})]})})})]}):r.jsx(Jt,{sx:{p:"12px 16px",display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:3},children:r.jsx(z,{sx:{color:"rgba(255,255,255,0.5)",fontSize:"0.9rem"},children:"Недостаточно прав для отправки сообщений"})})})]})},na=({hubId:e,presenceUpdates:t=[]})=>{const{data:n=[],isLoading:o}=Vr({hubId:e}),i=Wr(l=>l.user.currentUser),a=Ie.useMemo(()=>{const l=new Map;return n.forEach(u=>{var x;u.user_id&&u.user?l.set(u.user_id,u):(x=u.user)!=null&&x.id&&l.set(u.user.id,{...u,user_id:u.user.id})}),(Array.isArray(t)?t:[]).forEach(u=>{var m;const x=u.user_id||((m=u.user)==null?void 0:m.id);if(!x)return;const b=l.get(x);b?l.set(x,{...b,...u,online:u.online??b.online}):l.set(x,{...u,user_id:x})}),i&&!l.has(i.id)&&l.set(i.id,{id:Date.now(),user_id:i.id,hub_id:e,joined_at:new Date().toISOString(),is_owner:!1,user:{id:i.id,login:i.login,avatar:i.avatar,online:!0},roles:[]}),Array.from(l.values()).sort((u,x)=>{var j,T,k,D,B,L;const b=i&&u.user_id===i.id,m=i&&x.user_id===i.id;if(b&&!m)return-1;if(!b&&m)return 1;const E=u.online||((j=u.user)==null?void 0:j.online)||((T=u.user)==null?void 0:T.presence)==="ONLINE",R=x.online||((k=x.user)==null?void 0:k.online)||((D=x.user)==null?void 0:D.presence)==="ONLINE";return E&&!R?-1:!E&&R?1:(((B=u.user)==null?void 0:B.login)||"").localeCompare(((L=x.user)==null?void 0:L.login)||"")})},[n,t,i,e]);return o?r.jsx(I,{sx:{width:240,p:2,background:"rgba(30,30,47,0.95)",borderLeft:"1px solid rgba(255,255,255,0.1)",backdropFilter:"blur(10px)"},children:[...Array(5)].map((l,c)=>r.jsxs(I,{sx:{display:"flex",alignItems:"center",mb:2},children:[r.jsx(Le,{variant:"circular",width:40,height:40,sx:{bgcolor:"rgba(255,255,255,0.1)",mr:2}}),r.jsxs(I,{sx:{flex:1},children:[r.jsx(Le,{variant:"text",width:"60%",height:20,sx:{bgcolor:"rgba(255,255,255,0.1)",mb:.5}}),r.jsx(Le,{variant:"text",width:"40%",height:16,sx:{bgcolor:"rgba(255,255,255,0.1)"}})]})]},c))}):r.jsxs(I,{sx:{width:240,p:2,background:"rgba(30,30,47,0.95)",borderLeft:"1px solid rgba(255,255,255,0.1)",backdropFilter:"blur(10px)"},children:[r.jsxs(z,{variant:"subtitle2",sx:{color:"#B0B0B0",fontWeight:600,textTransform:"uppercase",letterSpacing:1,mb:2},children:["Участники (",a.length,")"]}),a.map(l=>{if(!l.user)return null;const c=i&&l.user_id===i.id;return r.jsxs(Jt,{sx:{p:1,mb:1,display:"flex",alignItems:"center",background:c?"rgba(0,207,255,0.1)":"rgba(30,30,47,0.5)",border:`1px solid ${c?"rgba(0,207,255,0.3)":"rgba(255,255,255,0.05)"}`,"&:hover":{background:c?"rgba(0,207,255,0.15)":"rgba(30,30,47,0.7)",borderColor:c?"rgba(0,207,255,0.4)":"rgba(255,255,255,0.1)"},transition:"all 0.2s ease",position:"relative"},children:[r.jsxs(I,{sx:{position:"relative",mr:1},children:[r.jsx(zn,{src:l.user.avatar,alt:l.user.login,userId:l.user.id,hubId:e,sx:{width:32,height:32,background:"linear-gradient(135deg, #C2185B 0%, #1976D2 100%)"}}),l.user.presence&&r.jsx(I,{sx:{position:"absolute",bottom:-2,right:-2,width:14,height:14,bgcolor:l.user.presence==="ONLINE"?"#4CAF50":"#6B5B95",border:"3px solid #1E1E2F",borderRadius:"50%"}})]}),r.jsxs(I,{sx:{flex:1},children:[r.jsx(z,{sx:{color:"#fff",fontWeight:500},children:l.user.login}),r.jsx(z,{sx:{color:"#B0B0B0",fontSize:"0.8rem"},children:l.user.presence==="ONLINE"?"В сети":"Не в сети"})]})]},l.id||l.user_id||l.user.id)})]})},Nr={dark:{background:"#0A0A1A",backgroundVariant:"#1E1E2F",backgroundPaper:"rgba(30,30,47,0.95)",backgroundGradient:"linear-gradient(135deg, #1E1E2F 60%, #1E1E2F 100%)",backgroundMain:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",backgroundOverlay:"rgba(30,30,47,0.6)",backgroundTransparent:"rgba(30,30,47,0.85)",backgroundHover:"rgba(255,255,255,0.05)",backgroundHoverAlt:"rgba(255,255,255,0.1)",backgroundSelected:"rgba(255,255,255,0.15)",backgroundOpacity:"rgba(255,255,255,0.08)",channelBackground:"rgba(37,37,54,0.95)",channelBackgroundHover:"rgba(45,45,62,0.95)",tooltip:"rgba(30,30,47,0.85)",messageBubble:"rgba(20,20,35,0.85)"},light:{background:"#f5f5f5",backgroundVariant:"#ffffff",backgroundPaper:"rgba(255,255,255,0.95)",backgroundGradient:"linear-gradient(135deg, #ffffff 60%, #f5f5f5 100%)",backgroundMain:"linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%)",backgroundOverlay:"rgba(255,255,255,0.9)",backgroundTransparent:"rgba(255,255,255,0.85)",backgroundHover:"rgba(0,0,0,0.04)",backgroundHoverAlt:"rgba(0,0,0,0.08)",backgroundSelected:"rgba(0,0,0,0.12)",backgroundOpacity:"rgba(0,0,0,0.06)",channelBackground:"rgba(245,245,245,0.95)",channelBackgroundHover:"rgba(235,235,235,0.95)",tooltip:"rgba(97,97,97,0.92)",messageBubble:"rgba(245,245,245,0.85)"}},tt=(e,t)=>e.palette.mode==="dark"?Nr.dark[t]:Nr.light[t],Ct=(e,t,n)=>e.palette.mode==="dark"?Tt("#FFFFFF",n):Tt("#000000",n),ra=(e,t="main")=>{const n=e.palette.mode==="dark",o={main:"linear-gradient(90deg, #FF69B4 0%, #1E90FF 100%)",hover:"linear-gradient(90deg, #FF1493 0%, #00BFFF 100%)",cyber:"linear-gradient(45deg, #FF69B4 0%, #1E90FF 50%, #FF69B4 100%)"};return!n&&t==="main"?"linear-gradient(90deg, #E91E63 0%, #2196F3 100%)":o[t]},Nn=(e,t=.12)=>e.palette.mode==="dark"?Tt("#FF69B4",t):Tt("#E91E63",t),zr=()=>r.jsxs(I,{sx:{p:2},children:[r.jsx(Le,{variant:"rectangular",width:"100%",height:40,sx:{borderRadius:1,mb:1,bgcolor:"rgba(255,255,255,0.05)"},animation:"wave"}),r.jsx(Le,{variant:"rectangular",width:"100%",height:40,sx:{borderRadius:1,mb:1,bgcolor:"rgba(255,255,255,0.05)"},animation:"wave"}),r.jsx(Le,{variant:"rectangular",width:"100%",height:40,sx:{borderRadius:1,mb:1,bgcolor:"rgba(255,255,255,0.05)"},animation:"wave"})]});xt(wn)(({theme:e})=>({borderRadius:8,marginBottom:8,background:tt(e,"channelBackground"),border:`1px solid ${Ct(e,e.palette.mode==="dark"?"white":"black",.05)}`,"&:hover":{background:tt(e,"channelBackgroundHover"),transform:"translateX(5px)",borderColor:Tt(e.palette.primary.main,.3),"& .channel-icon":{color:"#FF69B4"},"& .settings-button":{opacity:1,color:"#B0B0B0","&:hover":{color:"#FF69B4"}}},transition:"all 0.3s ease-in-out"}));xt(wn)(({theme:e})=>({borderRadius:8,marginBottom:8,background:tt(e,"channelBackground"),border:`1px solid ${Ct(e,e.palette.mode==="dark"?"white":"black",.05)}`,"&:hover":{background:tt(e,"channelBackgroundHover"),transform:"translateX(5px)",borderColor:Tt(e.palette.secondary.main,.3),"& .channel-icon":{color:"#1E90FF"},"& .settings-button":{opacity:1,color:"#B0B0B0","&:hover":{color:"#1E90FF"}}},transition:"all 0.3s ease-in-out"}));xt(I)(({theme:e})=>({background:tt(e,"messageBubble"),borderRadius:"12px 12px 12px 0",padding:"12px 16px",maxWidth:"70%",position:"relative","&::before":{content:'""',position:"absolute",left:"-8px",bottom:0,width:"16px",height:"16px",background:tt(e,"messageBubble"),clipPath:"polygon(100% 0, 0 100%, 100% 100%)"},transition:"all 0.3s ease-in-out"}));xt(I)(({theme:e})=>({background:Nn(e,.1),borderRadius:16,padding:"4px 12px",border:`1px solid ${Nn(e,.3)}`,transition:"all 0.3s ease-in-out",cursor:"pointer","&:hover":{background:Nn(e,.2),transform:"scale(1.05)"}}));xt(I)(({theme:e})=>({cursor:"pointer",padding:"8px 16px",borderRadius:8,transition:"all 0.3s ease-in-out","&:hover":{background:"rgba(255,255,255,0.05)"}}));xt(z)(({theme:e})=>({fontSize:14,fontWeight:500,color:"rgba(255,255,255,0.7)",transition:"color 0.3s ease-in-out"}));const oa=["💬 Общение","🎮 Гейминг","🎨 Творчество","🎵 Музыка","📚 Учеба"],sa=["💬 основной","🔊 войс-рум","📢 анонсы","🎮 геймчат","🤝 знакомства"],ia=["🌟 Новый вайб","💫 Свежий нейм","🔥 Топ название","✨ Крутая идея","🎯 Точное попадание"],aa=["💬 Чил-чат","🎮 Игровая","🎵 Музыкалка","📸 Медиа","💡 Идеи"],pn=e=>e[Math.floor(Math.random()*e.length)],ha=()=>{var qe,We,xe,gt;const e=Pr(),t=Do(),{hubId:n,channelId:o}=jo(),{setUpdateHubData:i}=ir(),[a,l]=s.useState(!1),{data:c=[],isLoading:f}=ar({}),{data:u,isLoading:x,error:b}=ko(Number(n),{skip:!n}),[m,E]=Ie.useState(null),[R,j]=s.useState([]),[T,k]=s.useState(""),[D,B]=s.useState(""),[L,P]=s.useState(Se.TEXT),[G,$]=s.useState(null),[H,ne]=s.useState(!1),[ae,V]=s.useState(!1),[Ee,re]=s.useState(!1),[Qe,me]=s.useState(!1),[mt,te]=s.useState(null),[Et,U]=s.useState(!1),[le,Me]=s.useState(null),[De,q]=s.useState(!1),[Ne,se]=s.useState(!1),[Z,nt]=s.useState(null),[rt,ze]=s.useState(!1),[X,Je]=s.useState(null),Te=Wr(y=>y.user.currentUser),[ut,ot]=s.useState(!1),Ge=s.useRef(null),[$e,st]=s.useState([]),[qt,yt]=s.useState([]),[pe,ft]=s.useState([]),{setHubMembers:Be}=ir(),_e=s.useRef(!1),Q=s.useRef([]);s.useRef(null),s.useRef(null);const Pe=gs(gr(er,{activationConstraint:{distance:8}}),gr(Jn,{coordinateGetter:Ai})),{data:Ue,isLoading:ye}=Po(Number(n)),{refetch:Ae}=ar({}),[Oe]=_o(),[Mt]=Ho(),[we]=Vo(),[Ze]=Go(),[it]=Uo(),[Nt]=qo(),at=Ie.useCallback(async()=>{try{await Ae()}catch{window.notify&&window.notify("Failed to refresh hub data. Please try again.","error")}},[Ae]);s.useEffect(()=>{if(n){const y=c.find(C=>C.id===Number(n));E(y||null)}},[c,n]),s.useEffect(()=>{n!==Ge.current&&(Je(null),Ge.current=n||null,n&&Ae())},[n,Ae]),s.useEffect(()=>{if(o&&R.length>0){const y=R.flatMap(C=>C.channels).find(C=>C.id===Number(o));y&&Je({...y})}},[o,R]),Ie.useEffect(()=>{i(at)},[i,at]),s.useEffect(()=>{(async()=>{if(m!=null&&m.id&&Ue){const C=Ue.channels.map(F=>({...F,type:F.type===0?Se.VOICE:Se.TEXT,categoryId:F.category_id})),A=Ue.categories.map(F=>({...F,channels:C.filter(O=>O.category_id===F.id)}));j(A)}})()},[m,Ue]),s.useEffect(()=>{},[u]),s.useEffect(()=>{if(u!=null&&u.roles){const y=u.roles.map(O=>O.permissions);st(y);const C=Ro(y),F=To(C).map(O=>{const _=Bo.find(N=>N.bit===O);return _?_.key:null}).filter(O=>O!==null);yt(F)}},[u]);const{data:vt=[]}=Vr(m!=null&&m.id?{hubId:m.id}:void 0,{skip:!(m!=null&&m.id)});s.useEffect(()=>{if(vt){const y=Array.isArray(vt)?vt:[];ft(y),Be(y)}},[vt,Be]);const je=async y=>{if(!(!y.trim()||!(m!=null&&m.id))){ne(!0);try{const C=await Oe({hubId:Number(m.id),name:y.trim()}).unwrap();j([...R,{id:C.id,name:C.name,channels:[]}]),k(""),re(!1)}catch{window.notify&&window.notify("Ошибка при создании категории","error")}finally{ne(!1)}}},oe=async(y,C)=>{const A=y||D,F=C||L,O=mt||G;if(!A.trim()||!O||!(m!=null&&m.id)){window.notify&&window.notify("Не удалось создать канал. Проверьте, что выбрана категория.","error");return}V(!0);try{const _=await Ze({hubId:Number(m.id),categoryId:Number(O),data:{name:A.trim(),type:F,categoryId:Number(O)}}).unwrap();j(N=>N.map(ge=>ge.id===O?{...ge,channels:[...ge.channels,_]}:ge)),B(""),me(!1)}catch{window.notify&&window.notify("Ошибка при создании канала","error")}finally{V(!1)}},Dt=async()=>{if(Q.current.length===0){_e.current=!1;return}const y=Q.current[0];try{await y(),Q.current=Q.current.slice(1),Q.current.length>0?setTimeout(Dt,100):_e.current=!1}catch{Q.current=[],_e.current=!1}},Fe=y=>{Q.current.push(y),_e.current||(_e.current=!0,Dt())},Bt=y=>{const{active:C,over:A}=y;!A||C.id===A.id||j(F=>{const O=F.findIndex(ge=>ge.id===C.id),_=F.findIndex(ge=>ge.id===A.id);if(O===_)return F;const N=yn(F,O,_);if(m!=null&&m.id){const ge=_+1;Fe(async()=>{try{await Mt({hubId:Number(m.id),categoryId:Number(C.id),data:{position:ge}}).unwrap()}catch(wt){throw window.notify&&window.notify("Ошибка при обновлении позиции категории","error"),j(F),wt}})}return N})},ce=async(y,C)=>{var ge;const{active:A,over:F}=y;if(!F||A.id===F.id)return;const O=C.channels.findIndex(ve=>ve.id===A.id),_=C.channels.findIndex(ve=>ve.id===F.id);if(O===_)return;const N=R.map(ve=>{if(ve.id!==C.id)return ve;const wt=yn(ve.channels,O,_);return{...ve,channels:wt.map((Mn,Dn)=>({...Mn,position:Dn+1}))}});j(N);try{const ve=((ge=N.find(wt=>wt.id===C.id))==null?void 0:ge.channels)||[];await Promise.all(ve.map(wt=>it({channelId:wt.id,data:{category_id:C.id,position:wt.position}}).unwrap()))}catch{j(R),window.notify&&window.notify("Ошибка при обновлении позиции канала","error")}},he=y=>{Me(y.id),U(!0)},ue=async()=>{if(!(!le||!(m!=null&&m.id))){q(!0);try{await we({hubId:Number(m.id),categoryId:Number(le)}).unwrap(),j(y=>y.filter(C=>C.id!==le)),U(!1)}catch{window.notify&&window.notify("Ошибка при удалении категории","error")}finally{q(!1)}}},He=y=>{nt(y.id),se(!0)},ie=async()=>{if(!Z)return;const y=R.flatMap(C=>C.channels).find(C=>C.id===Z);if(y){ze(!0);try{await Nt({channelId:y.id}).unwrap(),j(C=>C.map(A=>({...A,channels:A.channels.filter(F=>F.id!==Z)}))),se(!1)}catch{window.notify&&window.notify("Ошибка при удалении канала","error")}finally{ze(!1)}}},be=y=>{te(y),me(!0)},fe=()=>r.jsx(I,{sx:{width:240,background:tt(t,"backgroundPaper"),borderRight:`1px solid ${Ct(t,t.palette.mode==="dark"?"white":"black",.1)}`,display:"flex",flexDirection:"column",backdropFilter:"blur(10px)",height:"100%"},children:r.jsxs(I,{sx:{p:2},children:[r.jsx(Le,{variant:"text",width:"50%",height:24,sx:{bgcolor:Ct(t,t.palette.mode==="dark"?"white":"black",.1),mb:2},animation:"wave"}),r.jsx(zr,{}),r.jsx(Le,{variant:"text",width:"50%",height:24,sx:{bgcolor:"rgba(255,255,255,0.1)",mb:2,mt:3},animation:"wave"}),r.jsx(zr,{})]})}),lt=()=>r.jsxs(I,{sx:{width:240,background:tt(t,"backgroundOverlay"),borderLeft:`1px solid ${Ct(t,t.palette.mode==="dark"?"white":"black",.1)}`,p:2},children:[r.jsx(Le,{variant:"text",width:"50%",height:24,sx:{bgcolor:Ct(t,t.palette.mode==="dark"?"white":"black",.1),mb:2},animation:"wave"}),[1,2,3,4,5].map(y=>r.jsxs(I,{sx:{display:"flex",alignItems:"center",mb:2},children:[r.jsx(Le,{variant:"circular",width:32,height:32,sx:{bgcolor:Ct(t,t.palette.mode==="dark"?"white":"black",.1),mr:1},animation:"wave"}),r.jsx(Le,{variant:"text",width:"60%",height:20,sx:{bgcolor:Ct(t,t.palette.mode==="dark"?"white":"black",.1)},animation:"wave"})]},y))]}),ee=$n().shape({name:_n().required("Обязательное поле").max(30,"Максимум 30 символов").test("max-length","Максимум 30 символов",y=>!y||y.length<=30),type:Ao().required("Обязательное поле").oneOf([Se.VOICE,Se.TEXT],"Неверный тип канала")}),Ve=$n().shape({name:_n().required("Обязательное поле").max(30,"Максимум 30 символов").test("max-length","Максимум 30 символов",y=>!y||y.length<=30)});return f||x?r.jsx(I,{sx:{display:"flex",height:"100vh",alignItems:"center",justifyContent:"center",background:tt(t,"backgroundMain"),position:"relative","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,background:`radial-gradient(circle at 50% 50%, ${Tt(t.palette.primary.main,.1)} 0%, transparent 70%)`,zIndex:0}},children:r.jsx(z,{variant:"h6",sx:{color:t.palette.text.secondary},children:"Загрузка хаба..."})}):!m&&!f?r.jsx(I,{sx:{display:"flex",height:"100vh",alignItems:"center",justifyContent:"center",background:tt(t,"backgroundMain"),position:"relative","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,background:`radial-gradient(circle at 50% 50%, ${Tt(t.palette.primary.main,.1)} 0%, transparent 70%)`,zIndex:0}},children:r.jsx(z,{variant:"h6",sx:{color:t.palette.text.secondary},children:"Хаб не найден"})}):r.jsxs(r.Fragment,{children:[r.jsxs(I,{sx:{display:"flex",height:"100vh",flexDirection:"column",background:tt(t,"backgroundMain"),position:"relative","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,background:`radial-gradient(circle at 50% 50%, ${Tt(t.palette.primary.main,.1)} 0%, transparent 70%)`,zIndex:0}},children:[r.jsxs(I,{sx:{height:64,px:4,display:"flex",alignItems:"center",background:tt(t,"backgroundPaper"),borderBottom:`1px solid ${Ct(t,t.palette.mode==="dark"?"white":"black",.1)}`,boxShadow:`0 2px 8px 0 ${Ct(t,"black",.15)}`,backdropFilter:"blur(10px)"},children:[r.jsx(z,{variant:"h5",sx:{fontWeight:700,background:ra(t,"main"),WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",letterSpacing:1},children:ut||f?r.jsx(Le,{variant:"text",width:200,height:40,sx:{bgcolor:"rgba(255,255,255,0.1)"}}):((qe=c.find(y=>y.id===Number(n)))==null?void 0:qe.name)||"Hub"}),r.jsx(I,{sx:{flex:1}}),r.jsxs(Hr,{direction:"row",spacing:1,children:[r.jsx($t,{title:"Notifications",children:r.jsx(ke,{sx:{color:t.palette.primary.main},children:r.jsx(zo,{})})}),((u==null?void 0:u.is_owner)||Fo($e,["MANAGE_ROLES","MANAGE_INVITES","MANAGE_HUB"]))&&r.jsx($t,{title:"Settings",children:r.jsx(ke,{sx:{color:t.palette.primary.main},onClick:()=>e(`/hub/${n}/settings`),children:r.jsx(Un,{})})})]})]}),r.jsxs(I,{sx:{flex:1,display:"flex",overflow:"hidden"},children:[ut||ye?fe():r.jsx(I,{sx:{width:240,background:tt(t,"backgroundPaper"),borderRight:"1px solid rgba(255,255,255,0.1)",display:"flex",flexDirection:"column",backdropFilter:"blur(10px)",height:"100%","& .simplebar-scrollbar":{"&:before":{backgroundColor:"rgba(194,24,91,0.4)",width:"4px",left:"0",right:"auto",opacity:0,transition:"opacity 0.2s ease"},"&.simplebar-visible:before":{opacity:1}},"&:hover .simplebar-scrollbar":{"&:before":{opacity:1}},"& .simplebar-track.simplebar-vertical":{width:"4px",right:"0",top:"0",bottom:"0",background:"transparent"},"& .simplebar-track.simplebar-horizontal":{display:"none"}},children:r.jsxs(I,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[r.jsx(I,{sx:{p:"16px 0"},children:r.jsxs(I,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,px:2},children:[r.jsx(z,{variant:"subtitle2",sx:{color:"rgba(255,255,255,0.7)",textTransform:"uppercase",letterSpacing:1,fontWeight:700},children:"Категории"}),((u==null?void 0:u.is_owner)||Lt($e,"MANAGE_CATEGORIES"))&&r.jsx(ke,{size:"small",sx:{color:"#1976D2","&:hover":{background:"rgba(25,118,210,0.1)"}},onClick:()=>{(u!=null&&u.is_owner||Lt($e,"MANAGE_CATEGORIES"))&&re(!0)},children:r.jsx(_r,{fontSize:"small"})})]})}),r.jsx(Oo,{style:{height:"calc(100vh - 180px)",width:"100%",flex:1,minHeight:0},className:"custom-scrollbar",scrollbarMinSize:40,autoHide:!0,children:r.jsx(Xi,{categories:R,activeChannel:X,setActiveChannel:Je,openChannelSettings:He,sensors:Pe,handleDragEnd:Bt,handleChannelDragEnd:ce,openCategorySettings:he,setActiveCategoryId:$,setCreateChannelOpen:y=>{y?be(G||""):me(!1)},userPermissions:$e,isOwner:(u==null?void 0:u.is_owner)||!1,hubId:n||""})})]})}),X&&Te?r.jsx(Ie.Fragment,{children:r.jsx(ta,{activeChannel:X,user:Te,hubId:(m==null?void 0:m.id)||parseInt(n||"0",10),userPermissions:$e,isOwner:(u==null?void 0:u.is_owner)||!1})},`channel-${X.id}`):r.jsx(I,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",color:"rgba(255,255,255,0.5)"},children:r.jsx(z,{variant:"h5",children:"Select a channel to start chatting"})}),ut?lt():c.find(y=>y.id===Number(n))&&r.jsx(na,{hubId:Number(n),presenceUpdates:pe})]})]}),r.jsx(Lo,{open:a,onClose:()=>l(!1)}),r.jsx(Qt,{open:Ee,onClose:()=>re(!1),title:"Создать категорию",children:r.jsx(_t,{initialValues:{name:""},validationSchema:Ve,onSubmit:async(y,{resetForm:C})=>{await je(y.name.trim()),C(),re(!1)},children:({values:y,errors:C,touched:A,handleChange:F,handleBlur:O,resetForm:_})=>r.jsxs(Pt,{children:[r.jsx(dn,{name:"name",label:"Название категории",placeholder:pn(oa),autoFocus:!0,margin:"dense",fullWidth:!0,value:y.name,onChange:N=>{N.target.value.length<=30&&F(N)},onBlur:N=>{const ge=N.target.value.trim();ge!==N.target.value&&(N.target.value=ge,F(N)),O(N)},error:A.name&&!!C.name,helperText:r.jsxs(z,{component:"span",sx:{display:"flex",justifyContent:"space-between",width:"100%"},children:[r.jsx("span",{style:{color:"#ff4444"},children:A.name&&C.name}),r.jsxs("span",{style:{color:y.name.length>30?"#ff4444":"rgba(255,255,255,0.5)"},children:[y.name.length,"/30"]})]}),sx:{mb:3,"& .MuiInputBase-input":{color:"#fff","&::placeholder":{color:"#B0B0B0",opacity:1}},"& .MuiInputLabel-root":{color:"#B0B0B0"},"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.4)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#fff"},"& .MuiFormHelperText-root":{color:"rgba(255,255,255,0.5)"}}}),r.jsxs(I,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[r.jsx(ct,{onClick:()=>{_(),re(!1)},sx:{color:"rgba(255,255,255,0.7)"},children:"Отмена"}),r.jsx(ct,{type:"submit",variant:"contained",disabled:H||!y.name.trim(),sx:{background:Ft.neon,color:"#fff","&:hover":{background:Ft.hover,boxShadow:"0 4px 15px rgba(255,105,180,0.4)"},"&:disabled":{background:"rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.3)"}},children:"Создать"})]})]})})}),r.jsx(Qt,{open:Et,onClose:()=>U(!1),title:"Настройки категории",children:r.jsx(_t,{initialValues:{name:((We=R.find(y=>y.id===le))==null?void 0:We.name)||""},enableReinitialize:!0,validationSchema:Ve,onSubmit:async y=>{if(!le||!(m!=null&&m.id))return;const C=y.name.trim();if(!C)return;const A=R.find(F=>F.id===le);if(A&&A.name.trim()===C){U(!1);return}q(!0);try{await Mt({hubId:Number(m.id),categoryId:Number(le),data:{name:C}}).unwrap(),j(F=>F.map(O=>O.id===le?{...O,name:C}:O)),U(!1)}catch{window.notify&&window.notify("Ошибка при обновлении категории","error")}finally{q(!1)}},children:({values:y,errors:C,touched:A,handleChange:F,handleBlur:O})=>r.jsxs(Pt,{children:[r.jsx(dn,{name:"name",label:"Название категории",placeholder:pn(ia),autoFocus:!0,margin:"dense",fullWidth:!0,value:y.name,onChange:_=>{_.target.value.length<=30&&F(_)},onBlur:_=>{const N=_.target.value.trim();N!==_.target.value&&(_.target.value=N,F(_)),O(_)},error:A.name&&!!C.name,helperText:r.jsxs(z,{component:"span",sx:{display:"flex",justifyContent:"space-between",width:"100%"},children:[r.jsx("span",{style:{color:"#ff4444"},children:A.name&&C.name}),r.jsxs("span",{style:{color:y.name.length>30?"#ff4444":"rgba(255,255,255,0.5)"},children:[y.name.length,"/30"]})]}),sx:{mb:3,"& .MuiInputBase-input":{color:"#fff","&::placeholder":{color:"#B0B0B0",opacity:1}},"& .MuiInputLabel-root":{color:"#B0B0B0"},"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.4)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#fff"},"& .MuiFormHelperText-root":{color:"rgba(255,255,255,0.5)"}}}),r.jsx(ct,{variant:"outlined",color:"error",fullWidth:!0,sx:{mb:2,mt:1,fontWeight:700},onClick:ue,children:"Удалить категорию"}),r.jsxs(I,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[r.jsx(ct,{onClick:()=>U(!1),sx:{color:"#B0B0B0"},children:"Отмена"}),r.jsx(ct,{type:"submit",variant:"contained",disabled:De,sx:{background:Ft.neon,color:"#fff","&:hover":{background:Ft.hover,boxShadow:"0 4px 15px rgba(255,105,180,0.4)"},"&:disabled":{background:"rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.3)"}},children:"Сохранить"})]})]})})}),r.jsx(Qt,{open:Ne,onClose:()=>se(!1),title:"Настройки канала",children:r.jsx(_t,{initialValues:{name:((xe=R.flatMap(y=>y.channels).find(y=>y.id===Z))==null?void 0:xe.name)||"",type:((gt=R.flatMap(y=>y.channels).find(y=>y.id===Z))==null?void 0:gt.type)||Se.TEXT},enableReinitialize:!0,validationSchema:ee,onSubmit:async y=>{if(!Z)return;const C=y.name.trim();if(!C)return;const A=R.flatMap(O=>O.channels).find(O=>O.id===Z);if(!A)return;if(!(A.name.trim()!==C||A.type!==y.type)){se(!1);return}ze(!0);try{await it({channelId:A.id,data:{name:C,type:y.type}}).unwrap(),j(O=>O.map(_=>({..._,channels:_.channels.map(N=>N.id===Z?{...N,name:C,type:y.type}:N)}))),se(!1)}catch{window.notify&&window.notify("Ошибка при обновлении канала","error")}finally{ze(!1)}},children:({values:y,errors:C,touched:A,handleChange:F,handleBlur:O})=>r.jsxs(Pt,{children:[r.jsx(dn,{name:"name",label:"Название канала",placeholder:pn(aa),autoFocus:!0,margin:"dense",fullWidth:!0,value:y.name,onChange:_=>{_.target.value.length<=30&&F(_)},onBlur:_=>{const N=_.target.value.trim();N!==_.target.value&&(_.target.value=N,F(_)),O(_)},error:A.name&&!!C.name,helperText:r.jsxs(z,{component:"span",sx:{display:"flex",justifyContent:"space-between",width:"100%"},children:[r.jsx("span",{style:{color:"#ff4444"},children:A.name&&C.name}),r.jsxs("span",{style:{color:y.name.length>30?"#ff4444":"rgba(255,255,255,0.5)"},children:[y.name.length,"/30"]})]}),sx:{mb:3,"& .MuiInputBase-input":{color:"#fff","&::placeholder":{color:"#B0B0B0",opacity:1}},"& .MuiInputLabel-root":{color:"#B0B0B0"},"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.4)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#fff"},"& .MuiFormHelperText-root":{color:"rgba(255,255,255,0.5)"}}}),r.jsxs(lr,{fullWidth:!0,sx:{mb:3},children:[r.jsx(cr,{id:"channel-type-edit-label",sx:{color:"#B0B0B0"},children:"Тип канала"}),r.jsxs(dr,{name:"type",labelId:"channel-type-edit-label",value:y.type,label:"Тип канала",onChange:F,onBlur:O,error:A.type&&!!C.type,sx:{color:"#fff",".MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.4)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#fff"}},children:[r.jsx(un,{value:Se.TEXT,children:r.jsxs(I,{sx:{display:"flex",alignItems:"center",gap:1},children:[r.jsx(Gr,{fontSize:"small"}),"Текстовый"]})}),r.jsx(un,{value:Se.VOICE,children:r.jsxs(I,{sx:{display:"flex",alignItems:"center",gap:1},children:[r.jsx(Ur,{fontSize:"small"}),"Голосовой"]})})]}),A.type&&C.type&&r.jsx(z,{sx:{color:"#ff4444",fontSize:"0.75rem",mt:1,ml:2},children:C.type})]}),r.jsx(ct,{variant:"outlined",color:"error",fullWidth:!0,sx:{mb:2,fontWeight:700},onClick:ie,children:"Удалить канал"}),r.jsxs(I,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[r.jsx(ct,{onClick:()=>se(!1),sx:{color:"#B0B0B0"},children:"Отмена"}),r.jsx(ct,{type:"submit",variant:"contained",disabled:rt,sx:{background:Ft.neon,color:"#fff","&:hover":{background:Ft.hover,boxShadow:"0 4px 15px rgba(255,105,180,0.4)"},"&:disabled":{background:"rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.3)"}},children:"Сохранить"})]})]})})}),r.jsx(Qt,{open:Qe,onClose:()=>{me(!1),te(null)},title:"Создать канал",children:r.jsx(_t,{initialValues:{name:"",type:Se.TEXT},validationSchema:ee,onSubmit:async(y,{resetForm:C})=>{await oe(y.name,y.type),C(),me(!1),te(null)},children:({values:y,errors:C,touched:A,handleChange:F,handleBlur:O,resetForm:_})=>r.jsxs(Pt,{children:[r.jsx(dn,{name:"name",label:"Название канала",placeholder:pn(sa),autoFocus:!0,margin:"dense",fullWidth:!0,value:y.name,onChange:N=>{N.target.value.length<=30&&F(N)},onBlur:N=>{const ge=N.target.value.trim();ge!==N.target.value&&(N.target.value=ge,F(N)),O(N)},error:A.name&&!!C.name,helperText:r.jsxs(z,{component:"span",sx:{display:"flex",justifyContent:"space-between",width:"100%"},children:[r.jsx("span",{style:{color:"#ff4444"},children:A.name&&C.name}),r.jsxs("span",{style:{color:y.name.length>30?"#ff4444":"rgba(255,255,255,0.5)"},children:[y.name.length,"/30"]})]}),sx:{mb:3,"& .MuiInputBase-input":{color:"#fff","&::placeholder":{color:"#B0B0B0",opacity:1}},"& .MuiInputLabel-root":{color:"#B0B0B0"},"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.4)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#fff"},"& .MuiFormHelperText-root":{color:"rgba(255,255,255,0.5)"}}}),r.jsxs(lr,{fullWidth:!0,sx:{mb:3},children:[r.jsx(cr,{id:"channel-type-label",sx:{color:"#B0B0B0"},children:"Тип канала"}),r.jsxs(dr,{name:"type",labelId:"channel-type-label",value:y.type,label:"Тип канала",onChange:N=>{F(N),P(N.target.value)},onBlur:O,error:A.type&&!!C.type,sx:{color:"#fff",".MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.4)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#fff"}},children:[r.jsx(un,{value:Se.TEXT,children:"Текстовый"}),r.jsx(un,{value:Se.VOICE,children:"Голосовой"})]}),A.type&&C.type&&r.jsx(z,{sx:{color:"#ff4444",fontSize:"0.75rem",mt:1,ml:2},children:C.type})]}),r.jsxs(I,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[r.jsx(ct,{onClick:()=>{_(),me(!1),te(null)},sx:{color:"#B0B0B0"},children:"Отмена"}),r.jsx(ct,{type:"submit",variant:"contained",disabled:ae,sx:{background:Ft.neon,color:"#fff","&:hover":{background:Ft.hover,boxShadow:"0 4px 15px rgba(255,105,180,0.4)"},"&:disabled":{background:"rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.3)"}},children:"Создать"})]})]})})})]})};export{ha as default};
