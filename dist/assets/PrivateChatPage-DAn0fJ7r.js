import{j as c,B as T,U as Rt,T as We,bs as kt,r,C as ae,n as Ve,o as Lt,p as Dt,q as Pt,t as jt,v as Se,z as Ht,bb as Bt,a as _t,bt as Ft,bu as Nt}from"./index-DLx8hl9i.js";import{f as Jt,S as Ct,u as Ot,a as Qt,b as zt,c as qt,d as Wt,e as Vt,M as K,D as Gt,N as Kt,C as vt}from"./useMessageState-BeAWUcXE.js";import"./Input-Dqn_Mi60.js";import"./Checkbox--JxRkKXc.js";const Xt=o=>{const{otherUser:d,...A}=o;return c.jsx(Jt,{...A})},Yt=({activeChannel:o,otherUser:d,searchMode:A,setSearchMode:_,searchQuery:m,searchInputRef:k,searchResultsRef:F,showSearchResults:N,setShowSearchResults:x,searchResults:g,isSearching:p,debouncedSearchQuery:Ie,handleSearchInputChange:E,clearSearch:be,onSearchResultClick:L,onLoadMore:xe,hasMore:$,isLoadingMore:w,isLoadingMessages:re,isLoadingAround:oe,paginationState:ee})=>{const le=re||oe||ee.loadingMode==="around"||ee.isJumpingToMessage,ie=()=>d?d.login:"Private Chat",de=()=>d!=null&&d.presence?d.presence.toLowerCase():"offline";return c.jsxs(T,{sx:{display:"flex",alignItems:"center",padding:"12px 24px",background:"linear-gradient(135deg, rgba(25,25,40,0.95) 0%, rgba(35,35,55,0.95) 100%)",backdropFilter:"blur(20px)",borderBottom:"1px solid rgba(255,255,255,0.1)",position:"relative",minHeight:"64px",zIndex:1},children:[c.jsxs(T,{sx:{display:"flex",alignItems:"center",flex:1},children:[d&&c.jsxs(T,{sx:{position:"relative",mr:2},children:[c.jsx(Rt,{userId:d.id,src:d.avatar||void 0,alt:d.login,sx:{width:40,height:40}}),d.presence==="ONLINE"&&c.jsx(T,{sx:{position:"absolute",bottom:0,right:0,width:12,height:12,backgroundColor:"#44b700",borderRadius:"50%",border:"2px solid rgba(25,25,40,0.95)"}})]}),c.jsxs(T,{sx:{display:"flex",flexDirection:"column"},children:[c.jsxs(T,{sx:{display:"flex",alignItems:"center",gap:1},children:[c.jsx(We,{variant:"h6",sx:{color:"white",fontWeight:600,fontSize:"18px"},children:ie()}),le&&c.jsx(kt,{size:16,thickness:4,sx:{color:"rgba(255,255,255,0.6)","& .MuiCircularProgress-circle":{strokeLinecap:"round"}}})]}),d&&c.jsx(We,{variant:"body2",sx:{color:"rgba(255,255,255,0.7)",fontSize:"14px",lineHeight:1.2},children:(()=>{const D=de();return D==="online"?"В сети":D==="away"?"Отошел":D==="busy"?"Занят":D==="offline"?"Не в сети":"Был недавно"})()})]})]}),c.jsx(T,{sx:{display:"flex",alignItems:"center",gap:1,position:"relative",zIndex:1e4},children:c.jsx(Ct,{searchMode:A,setSearchMode:_,searchQuery:m,searchInputRef:k,searchResultsRef:F,showSearchResults:N,setShowSearchResults:x,searchResults:g,isSearching:p,debouncedSearchQuery:Ie,handleSearchInputChange:D=>E({target:{value:D}}),clearSearch:be,onSearchResultClick:L,onLoadMore:xe,hasMore:$,isLoadingMore:w})})]})},Ut=({activeChannel:o,user:d,otherUser:A})=>{const[_]=r.useState(!1),[m,k]=r.useState(null),[F,N]=r.useState(null),x=r.useRef(null),{messages:g,setMessages:p,tempMessages:Ie,setTempMessages:E,unreadMessages:be,setUnreadMessages:L,unreadCount:xe,newMessagesCount:$,convertToExtendedMessage:w,resetMessageStates:re,updateMessageReadStatus:oe,markAllMessagesAsReadInState:ee,updateMessageReadByCount:le,deleteMessageFromState:ie,updateMessageInState:de,addMessageToState:D,addUnreadMessage:Pe,removeUnreadMessage:je,updateUnreadCount:ue,resetUnreadCounts:P}=Ot(),{state:s,actions:t,isLoadingMoreRef:Ge,lastBeforeIdRef:ce,lastAfterIdRef:O,setLoadingWithTimeout:h}=Qt(),R=r.useRef(null),v=r.useRef(null),{markMessageAsRead:He,markAllMessagesAsRead:X,addToReadBuffer:Ke,unreadMessagesBufferRef:ve}=zt({activeChannel:o}),{isScrolledToBottom:we,setIsScrolledToBottom:Be,showScrollButton:Xe,setShowScrollButton:Ye,showDateLabel:Ue,setShowDateLabel:Ze,currentDateLabel:$e,setCurrentDateLabel:et,setDisableAutoScroll:Q,scrollToBottom:j,scrollToMessage:tt}=qt({messagesContainerRef:R,messages:g,activeChannel:o,onMarkAllAsRead:X}),st=r.useRef(null),te=r.useRef(null),se=r.useRef(0),Y=r.useRef(null),[nt,ye]=r.useState(!1),[H,Te]=r.useState(null),[Ee,ge]=r.useState(!1),Ae=r.useRef(null),[fe,_e]=r.useState(null),{searchQuery:Fe,setSearchQuery:at,debouncedSearchQuery:rt,searchMode:U,setSearchMode:Ne,showSearchResults:Re,setShowSearchResults:ke,searchResults:ot,isSearching:lt,handleSearchInputChange:it,clearSearch:Z,highlightedMessages:dt,setHighlightedMessages:b,focusedMessageId:ut,setFocusedMessageId:y,searchInputRef:ne,searchResultsRef:Le,loadMore:ct,hasMore:gt,isLoadingMore:ft}=Wt({channelId:o==null?void 0:o.id,onSearchResultClick:e=>{g.some(a=>a.id===e)?(Y.current=e,b(new Set),y(null),b(a=>{const l=new Set(a);return l.add(e),l}),y(e),setTimeout(()=>{b(a=>{const l=new Set(a);return l.delete(e),l}),y(null)},1500)):(t.setIsJumpingToMessage(!0),t.setSkipMainQuery(!0),p([]),E(new Map),t.setBeforeId(null),t.setAfterId(null),t.setHasMoreMessages(!0),t.setHasMoreMessagesAfter(!0),t.setEnableAfterPagination(!0),J(e),t.setAroundMessageId(e),t.setLoadingMode("around"))}}),[z,J]=r.useState(null),[Je,Me]=r.useState(null);Vt(o,d,{onMessageCreate:r.useCallback(e=>{D(e)},[D]),onMessageUpdate:r.useCallback(e=>{de(e)},[de]),onMessageDelete:r.useCallback(e=>{ie(e)},[ie]),onMessageReadStatus:r.useCallback(e=>{le(e,d.id)},[le,d.id]),onHighlightMessage:r.useCallback((e,n=1500)=>{b(a=>{const l=new Set(a);return l.add(e),l}),setTimeout(()=>{b(a=>{const l=new Set(a);return l.delete(e),l})},n)},[b]),onUnreadMessage:r.useCallback(e=>{Pe(e)},[Pe]),onMarkMessageAsRead:r.useCallback(e=>{oe(e,d.id),je(e),He(e)},[oe,je,d.id,He]),onNewMessageIndicator:r.useCallback(()=>{},[]),onScrollToBottom:r.useCallback(()=>{j()},[j]),onMarkAllAsRead:r.useCallback(()=>{ee(d.id),X()},[ee,d.id,X]),onUnreadCountChange:r.useCallback(e=>{ue(e)},[ue])},{messagesContainerRef:R,convertToExtendedMessage:w,isScrolledToBottom:we,isJumpingToMessage:s.isJumpingToMessage,loadingMode:s.loadingMode,unreadMessagesBufferRef:ve,addToReadBuffer:Ke});const q=50,Ce=(o==null?void 0:o.type)===ae.PRIVATE&&!s.skipMainQuery&&(s.loadingMode==="initial"||s.loadingMode==="pagination"||s.loadingMode===null&&(s.beforeId!==null||s.afterId!==null)),Mt=Ce?{channelId:(o==null?void 0:o.id)??0,params:{size:q,...s.loadingMode!=="initial"&&s.beforeId?{before:s.beforeId}:{},...s.loadingMode!=="initial"&&s.afterId?{after:s.afterId}:{}}}:{channelId:0,params:{}},{data:S=[],isLoading:C,isFetching:W}=Ve(Mt,{skip:!Ce,refetchOnMountOrArgChange:!0,refetchOnReconnect:!0,refetchOnFocus:!1}),{data:pe,isLoading:me}=Ve((o==null?void 0:o.type)===ae.PRIVATE&&s.aroundMessageId&&s.loadingMode==="around"?{channelId:(o==null?void 0:o.id)??0,params:{size:q,around:s.aroundMessageId}}:{channelId:0,params:{}},{skip:!o||o.type!==ae.PRIVATE||!s.aroundMessageId||s.loadingMode!=="around"}),[Oe]=Lt(),[Qe]=Dt(),[ze]=Pt(),{notify:V}=jt(),pt=!0,mt=!0;r.useEffect(()=>{re(),t.setHasMoreMessages(!0),t.setHasMoreMessagesAfter(!0),t.setEnableAfterPagination(!1),t.setBeforeId(null),t.setAfterId(null),k(null),et(null),Ze(!1),Ye(!1),Be(!0),h(!1),O.current=null,ce.current=null,Z(),J(null),t.setAroundMessageId(null),t.setLoadingMode("initial"),t.setIsJumpingToMessage(!1),t.setInitialLoadComplete(!1),Me(null),t.setSkipMainQuery(!1),o&&X()},[o==null?void 0:o.id,X,re]);const ht=r.useCallback(()=>{p([]),E(new Map),se.current=0,t.setLoadingMode("initial"),t.setIsJumpingToMessage(!1),t.setBeforeId(null),t.setAfterId(null),t.setAroundMessageId(null),t.setSkipMainQuery(!1),t.setHasMoreMessages(!0),t.setHasMoreMessagesAfter(!1),t.setEnableAfterPagination(!1),ce.current=null,O.current=null,J(null),Me(null),L(new Set),P(),h(!0),Q(!1),setTimeout(()=>{t.setLoadingMode("initial")},50)},[t,p,E,L,P,J,Me,h]);r.useEffect(()=>{if(pe&&pe.length>0&&s.loadingMode==="around"){h(!0);const e=pe.map(w);p(e),se.current=e.length,Me(s.aroundMessageId),O.current=null,ce.current=null;const n=e.filter(a=>a.status===K.NEW&&a.author.id!==d.id);n.length>0&&(L(new Set(n.map(a=>a.id))),P(),ue(n.length)),t.setEnableAfterPagination(!0),e.length>5&&(t.setHasMoreMessages(!0),t.setHasMoreMessagesAfter(!0))}},[pe,s.loadingMode,w,d.id,t]),r.useEffect(()=>{if(!(!o||o.type!==ae.PRIVATE)&&s.loadingMode!=="around"&&!(C||W)&&!s.isJumpingToMessage&&!(s.beforeId!==null||s.afterId!==null)&&!(Je!==null&&g.length>0)){if(!S||S.length===0){p([]),s.loadingMode==="initial"&&setTimeout(()=>{j()},50);return}if(s.loadingMode==="initial"){const e=S.map(w);p(e),se.current=e.length,S.length<q&&t.setHasMoreMessagesAfter(!1),t.setEnableAfterPagination(!1);const n=e.filter(a=>a.status===K.NEW&&a.author.id!==d.id);n.length>0&&(L(new Set(n.map(a=>a.id))),P(),ue(n.length)),setTimeout(()=>{j(),t.setLoadingMode(null),t.setInitialLoadComplete(!0),h(!1)},100)}}},[o,S,C,W,w,d.id,j,s.loadingMode,s.isJumpingToMessage,s.beforeId,s.afterId,t,Je,g.length]);const St=r.useRef(null);r.useLayoutEffect(()=>{if(s.loadingMode==="initial"&&g.length>0&&R.current){const e=R.current,n=e.style.scrollBehavior;e.style.scrollBehavior="auto",e.scrollTop=e.scrollHeight,requestAnimationFrame(()=>{e.scrollTop<e.scrollHeight-e.clientHeight-10&&(e.scrollTop=e.scrollHeight),e.style.scrollBehavior=n})}},[g,s.loadingMode]),r.useEffect(()=>{z&&g.length>0&&s.loadingMode==="around"&&!me&&g.some(n=>n.id===z)&&(h(!0),requestAnimationFrame(()=>{Y.current=z,p(n=>[...n])}),b(n=>{const a=new Set(n);return a.add(z),a}),y(z),setTimeout(()=>{b(n=>{const a=new Set(n);return a.delete(z),a}),y(null)},1500),setTimeout(()=>{J(null),St.current=null,t.setAroundMessageId(null),g.length>0&&(ce.current=null,O.current=null,t.setHasMoreMessages(!0),t.setHasMoreMessagesAfter(!0),t.setEnableAfterPagination(!0)),setTimeout(()=>{t.setLoadingMode(null),t.setIsJumpingToMessage(!1),t.setSkipMainQuery(!1),Q(!1),h(!1)},300)},200))},[g.length,z,s.loadingMode,me,t,b,y,p]),r.useEffect(()=>{if(!o)return;const e=n=>{(n.ctrlKey||n.metaKey)&&n.key==="f"&&(n.preventDefault(),Ne(!0),setTimeout(()=>{ne.current&&ne.current.focus()},100)),n.key==="Escape"&&U&&(Z(),b(new Set),y(null))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[o,U]),r.useEffect(()=>{if(m&&te.current){te.current.focus();const e=te.current.value.length;te.current.setSelectionRange(e,e)}},[m]),r.useEffect(()=>{x.current=F},[F]);const It=r.useCallback(async(e,{resetForm:n})=>{if(!o||!d)return;const a=e.content.trim(),l=e.images&&e.images.length>0;if(!a&&!l)return;n();const I=Date.now(),i=x.current;N(null);try{const u={id:-1,content:e.content,author:d,created_at:new Date().toISOString(),last_modified_at:void 0,attachments:[],status:K.SENT,read_by_count:0,channel_id:o.id,reply:i?{...i,status:i.status||K.SENT}:void 0};E(B=>{const G=new Map(B);return G.set(String(I),u),G}),setTimeout(()=>{j()},10),n();const M={channelId:o.id,content:e.content,...l?{attachments:e.images}:{},...i!=null&&i.id?{replyId:i.id}:{}},f=await Oe(M).unwrap();E(B=>{const G=new Map(B);return G.delete(String(I)),G});const he={...f,status:K.SENT,channel_id:o.id,reply:f.reply?{...f.reply,status:f.reply.status||K.SENT}:void 0};p(B=>[...B,he])}catch(u){console.error("Failed to send message:",u),E(M=>{const f=new Map(M);return f.delete(String(I)),f}),typeof u=="object"&&u!==null&&"status"in u&&u.status===403&&"data"in u&&typeof u.data=="object"&&u.data!==null&&"type"in u.data&&u.data.type==="ACCESS_DENIED"?V("Недостаточно прав для отправки сообщения","error"):V("Ошибка при отправке сообщения","error")}},[o,d,Oe,V,j]),bt=r.useCallback(async(e,{resetForm:n})=>{if(!m||!o)return;const a=e.content.trim();if(!a)return;const l=g.find(i=>i.id===m);if(!l)return;if(a===l.content){k(null),n();return}const I={...l,content:a,last_modified_at:new Date().toISOString()};p(i=>i.map(u=>u.id===m?I:u)),k(null),n();try{const i=await Qe({channelId:o.id,messageId:m,content:a}).unwrap();p(u=>u.map(M=>M.id===m?w(i):M))}catch(i){console.error("Failed to edit message:",i),p(u=>u.map(M=>M.id===m?l:M)),V("Ошибка при обновлении сообщения","error")}},[m,o,Qe,g,V]),xt=r.useCallback(e=>{Te(e),ye(!0),ge(!1)},[g]),wt=r.useCallback(async()=>{if(!o||!H)return;const e=g.find(n=>n.id===H);if(e){ye(!1),p(n=>n.filter(l=>l.id!==H).map(l=>l.reply&&l.reply.id===H?{...l,reply:void 0}:l));try{await ze({channelId:o.id,messageId:H,forEveryone:Ee}).unwrap()}catch(n){console.error("Ошибка при удалении сообщения",n),p(a=>{if(!a.some(l=>l.id===H)){const l=[...a],I=l.findIndex(i=>new Date(i.created_at)>new Date(e.created_at));return I===-1?l.push(e):l.splice(I,0,e),l.map(i=>i.reply&&i.reply.id===H?{...i,reply:e}:i)}return a}),V("Ошибка при удалении сообщения","error")}Te(null),ge(!1)}},[o,ze,g,V,H,Ee]),yt=r.useCallback(e=>{g.some(a=>a.id===e.id)?(Z(),_e(e.id),requestAnimationFrame(()=>{Y.current=e.id}),b(new Set),y(null),b(a=>{const l=new Set(a);return l.add(e.id),l}),y(e.id),setTimeout(()=>{b(a=>{const l=new Set(a);return l.delete(e.id),l}),y(null)},1500)):(t.setLoadingMode("around"),t.setSkipMainQuery(!0),t.setIsJumpingToMessage(!0),Z(),Q(!0),h(!0),t.setBeforeId(null),p([]),E(new Map),se.current=0,L(new Set),P(),J(e.id),t.setAroundMessageId(e.id))},[g,Z,t,Q,h,p,E,se,L,P,J,Y,b,y]);r.useEffect(()=>{var e;if(S&&S.length>0&&s.beforeId!==null&&s.afterId===null&&s.loadingMode==="pagination"&&!C&&!W)try{const n=(e=S[0])==null?void 0:e.id;if(n&&n>=s.beforeId){h(!1),t.setLoadingMode(null),t.setBeforeId(null);return}if(!R.current)return;v.current&&(v.current.prepareScrollCorrection(),v.current.setDisableSmoothScroll(!0)),S.length<q&&t.setHasMoreMessages(!1),Q(!0);const l=S.map(w);p(I=>{const i=new Map;return I.forEach(M=>{typeof M.id=="number"&&M.id>0&&i.set(M.id,M)}),l.forEach(M=>{typeof M.id=="number"&&M.id>0&&i.set(M.id,M)}),Array.from(i.values()).sort((M,f)=>new Date(M.created_at).getTime()-new Date(f.created_at).getTime())}),setTimeout(()=>{v.current&&v.current.setDisableSmoothScroll(!1),h(!1),t.setLoadingMode(null)},100)}catch(n){console.error("Error in pagination loading (before):",n),h(!1),t.setLoadingMode(null)}},[S,s.beforeId,w,s.loadingMode,C,W,t,h]),r.useEffect(()=>{var e;if(S&&S.length>0&&s.afterId!==null&&s.beforeId===null&&s.loadingMode==="pagination"&&!C&&!W)try{let n=S;const a=(e=S[0])==null?void 0:e.id;if(a&&a<=s.afterId){const i=S.filter(u=>u.id>s.afterId);if(i.length===0){t.setHasMoreMessagesAfter(!1),t.setEnableAfterPagination(!1),h(!1),t.setLoadingMode(null),t.setAfterId(null),O.current=null;return}n=i}if(!R.current){h(!1),t.setLoadingMode(null);return}n.length<q&&(t.setHasMoreMessagesAfter(!1),t.setEnableAfterPagination(!1)),Q(!0);const I=n.map(w);p(i=>{const u=new Map;return i.forEach(f=>{typeof f.id=="number"&&f.id>0&&u.set(f.id,f)}),I.forEach(f=>{typeof f.id=="number"&&f.id>0&&u.set(f.id,f)}),Array.from(u.values()).sort((f,he)=>new Date(f.created_at).getTime()-new Date(he.created_at).getTime())}),requestAnimationFrame(()=>{h(!1),t.setLoadingMode(null),s.hasMoreMessagesAfter||(t.setAfterId(null),O.current=null),setTimeout(()=>{t.clearAfterPaginationCooldown()},500)})}catch(n){console.error("Error in pagination loading (after):",n),h(!1),t.setLoadingMode(null),t.clearAfterPaginationCooldown()}},[S,s.afterId,w,s.loadingMode,C,W,t,s.hasMoreMessagesAfter,O,h]),r.useEffect(()=>{const e=R.current;if(!e)return;let n=e.scrollTop,a=!1,l=0,I=null,i=!1,u=0;const M=()=>{i||(i=!0,requestAnimationFrame(()=>{I&&clearTimeout(I);const f=e.scrollTop,B=e.scrollHeight-f-e.clientHeight<100;f<n?a||(a=!0,l=Date.now()):f>n&&B&&(a=!1),n=f;const G=Date.now()-l;if((!a||G>1e3)&&Be(B),B&&o){Q(!1);const qe=Date.now();qe-u>1e3&&(u=qe,X()),p(At=>At.map(De=>De.author.id!==d.id?{...De,status:K.READ}:De)),L(new Set),P()}I=setTimeout(()=>{I=null},150),i=!1}))};return e.addEventListener("scroll",M,{passive:!0}),()=>e.removeEventListener("scroll",M)},[o,s.enableAfterPagination,s.hasMoreMessagesAfter,g]),r.useEffect(()=>()=>{Ae.current&&clearTimeout(Ae.current)},[]),r.useEffect(()=>{we&&$>0&&P()},[we,$,P]),r.useEffect(()=>{fe!==null&&(Y.current=fe,setTimeout(()=>{_e(null)},100))},[fe]),r.useEffect(()=>{U||(at(""),ke(!1),setTimeout(()=>{if(R.current&&s.loadingMode!=="around"&&!s.isJumpingToMessage){const{scrollHeight:e,scrollTop:n,clientHeight:a}=R.current;e-n-a<200&&j()}},100))},[U,j,s.loadingMode,s.isJumpingToMessage]),r.useEffect(()=>{const e=n=>{Re&&Le.current&&ne.current&&!Le.current.contains(n.target)&&!ne.current.contains(n.target)&&ke(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[Re]);const Tt=()=>c.jsx(T,{sx:{flex:1,height:"100%",p:3,display:"flex",flexDirection:"column",gap:2,overflowY:"auto",overflowX:"hidden"},children:[...Array(q)].map((e,n)=>c.jsxs(T,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[c.jsx(Se,{variant:"circular",width:40,height:40,animation:"wave",sx:{bgcolor:"rgba(255,255,255,0.1)",flexShrink:0}}),c.jsxs(T,{sx:{flex:1},children:[c.jsx(Se,{variant:"text",width:120,height:24,animation:"wave",sx:{bgcolor:"rgba(255,255,255,0.1)",mb:1}}),c.jsx(Se,{variant:"text",width:"80%",height:20,animation:"wave",sx:{bgcolor:"rgba(255,255,255,0.1)"}}),c.jsx(Se,{variant:"text",width:"60%",height:20,animation:"wave",sx:{bgcolor:"rgba(255,255,255,0.1)"}})]})]},n))}),Et=()=>c.jsx(Xt,{activeChannel:o,messages:g,tempMessages:Ie,searchMode:U,searchQuery:Fe,highlightedMessages:dt,focusedMessageId:ut,unreadMessages:be,isLoadingMore:Ge.current,isLoadingAround:me,editingMessageId:m,user:d,otherUser:A,paginationState:s,messagesPerPage:q,showDateLabel:Ue,currentDateLabel:$e,messagesContainerRef:R,messagesEndRef:st,editInputRef:te,highlightTimeoutRef:Ae,scrollToMessageIdRef:Y,setHighlightedMessages:b,setFocusedMessageId:y,setEditingMessageId:k,setMessages:p,setTempMessages:E,setReplyingToMessage:N,setTargetMessageId:J,paginationActions:t,handleEditMessage:bt,handleDeleteMessage:xt,scrollCorrectionRef:v,forceScrollToMessageId:fe});return c.jsxs(T,{sx:{flex:1,display:"flex",flexDirection:"column",background:"rgba(30,30,47,0.95)",backdropFilter:"blur(10px)",position:"relative"},children:[c.jsx(Gt,{open:nt,messageToDelete:H,deleteForEveryone:Ee,canManageMessages:mt,messages:g,userId:d.id,onClose:()=>{ye(!1),Te(null),ge(!1)},onConfirm:wt,onDeleteForEveryoneChange:e=>ge(e)}),c.jsx(Yt,{activeChannel:o,otherUser:A,searchMode:U,setSearchMode:Ne,searchQuery:Fe,searchInputRef:ne,searchResultsRef:Le,showSearchResults:Re,setShowSearchResults:ke,searchResults:ot||[],isSearching:lt,debouncedSearchQuery:rt,handleSearchInputChange:e=>it(e.target.value),clearSearch:Z,onSearchResultClick:yt,onLoadMore:ct,hasMore:gt,isLoadingMore:ft,isLoadingMessages:C||W,isLoadingAround:me,paginationState:{loadingMode:s.loadingMode,beforeId:s.beforeId,afterId:s.afterId,isJumpingToMessage:s.isJumpingToMessage}}),C&&!s.beforeId?Tt():Et(),c.jsx(Kt,{showScrollButton:Xe,newMessagesCount:$,unreadCount:xe,replyingToMessage:!!F,onScrollToBottom:ht}),c.jsx(vt,{activeChannel:o,canSendMessages:pt,sending:_,replyingToMessage:F,onSendMessage:It,onReplyCancel:()=>N(null),onReplyClick:tt})]})},ss=()=>{var N;const{channelId:o}=Ht(),d=Bt(),A=_t(x=>x.user.currentUser),_=o?parseInt(o):null;if(!A||!_)return c.jsx(Ft,{to:"/",replace:!0});let m=(N=d.state)==null?void 0:N.otherUser;const{data:k}=Nt(void 0,{skip:!!m});if(!m&&k){const x=k.find(g=>g.id===_);(x==null?void 0:x.type)===2&&x.members&&x.members.length>0&&(m=x.members.find(g=>g.id!==A.id)||x.members[0])}const F=r.useMemo(()=>({id:_,name:(m==null?void 0:m.login)||"Private Chat",type:ae.PRIVATE,categoryId:0}),[_,m]);return c.jsx(T,{sx:{display:"flex",height:"100vh"},children:c.jsx(Ut,{activeChannel:F,user:A,otherUser:m})})};export{ss as default};
