import{j as d,B as y,U as Fs,T as Ke,bq as Js,r,C as se,m as Ue,n as Qs,o as _s,p as qs,q as Ns,t as Me,z as Os,b9 as Cs,a as zs,br as Ws,bs as Vs}from"./index-aQ4zL47U.js";import{g as Gs,S as Ks,u as Us,a as Xs,b as Ys,c as Zs,d as $s,e as vs,M as pe,f as et,D as st,N as tt,C as nt}from"./useMessageQueue-e3Avh3RW.js";import"./Dialog-QW_xAq5S.js";import"./Input-DLCesp6X.js";const at=o=>{const{otherUser:i,...A}=o;return d.jsx(Gs,{...A})},rt=({activeChannel:o,otherUser:i,searchMode:A,setSearchMode:B,searchQuery:f,searchInputRef:k,searchResultsRef:F,showSearchResults:J,setShowSearchResults:b,searchResults:N,isSearching:E,debouncedSearchQuery:g,handleSearchInputChange:c,clearSearch:me,onSearchResultClick:Q,onLoadMore:he,hasMore:L,isLoadingMore:Se,isLoadingMessages:Y,isLoadingAround:T,paginationState:Z})=>{const te=Y||T||Z.loadingMode==="around"||Z.isJumpingToMessage,ne=()=>i?i.login:"Private Chat",ae=()=>i!=null&&i.presence?i.presence.toLowerCase():"offline";return d.jsxs(y,{sx:{display:"flex",alignItems:"center",padding:"12px 24px",background:"linear-gradient(135deg, rgba(25,25,40,0.95) 0%, rgba(35,35,55,0.95) 100%)",backdropFilter:"blur(20px)",borderBottom:"1px solid rgba(255,255,255,0.1)",position:"relative",minHeight:"64px",zIndex:1},children:[d.jsxs(y,{sx:{display:"flex",alignItems:"center",flex:1},children:[i&&d.jsxs(y,{sx:{position:"relative",mr:2},children:[d.jsx(Fs,{userId:i.id,src:i.avatar||void 0,alt:i.login,sx:{width:40,height:40}}),i.presence==="ONLINE"&&d.jsx(y,{sx:{position:"absolute",bottom:0,right:0,width:12,height:12,backgroundColor:"#44b700",borderRadius:"50%",border:"2px solid rgba(25,25,40,0.95)"}})]}),d.jsxs(y,{sx:{display:"flex",flexDirection:"column"},children:[d.jsxs(y,{sx:{display:"flex",alignItems:"center",gap:1},children:[d.jsx(Ke,{variant:"h6",sx:{color:"white",fontWeight:600,fontSize:"18px"},children:ne()}),te&&d.jsx(Js,{size:16,thickness:4,sx:{color:"rgba(255,255,255,0.6)","& .MuiCircularProgress-circle":{strokeLinecap:"round"}}})]}),i&&d.jsx(Ke,{variant:"body2",sx:{color:"rgba(255,255,255,0.7)",fontSize:"14px",lineHeight:1.2},children:(()=>{const P=ae();return P==="online"?"В сети":P==="away"?"Отошел":P==="busy"?"Занят":P==="offline"?"Не в сети":"Был недавно"})()})]})]}),d.jsx(y,{sx:{display:"flex",alignItems:"center",gap:1,position:"relative",zIndex:1e4},children:d.jsx(Ks,{searchMode:A,setSearchMode:B,searchQuery:f,searchInputRef:k,searchResultsRef:F,showSearchResults:J,setShowSearchResults:b,searchResults:N,isSearching:E,debouncedSearchQuery:g,handleSearchInputChange:P=>c({target:{value:P}}),clearSearch:me,onSearchResultClick:Q,onLoadMore:he,hasMore:L,isLoadingMore:Se})})]})},ot=({activeChannel:o,user:i,otherUser:A})=>{const[B]=r.useState(!1),[f,k]=r.useState(null),[F,J]=r.useState(null),b=r.useRef(null),[N,E]=r.useState(!1),{messages:g,setMessages:c,tempMessages:me,setTempMessages:Q,unreadMessages:he,setUnreadMessages:L,unreadCount:Se,newMessagesCount:Y,convertToExtendedMessage:T,resetMessageStates:Z,updateMessageReadStatus:te,markAllMessagesAsReadInState:ne,updateMessageReadByCount:ae,deleteMessageFromState:P,updateMessageInState:Pe,addMessageToState:De,addUnreadMessage:je,removeUnreadMessage:He,updateUnreadCount:re,resetUnreadCounts:D,addTempMessage:Xe,removeTempMessage:Ye,updateTempMessage:Ze}=Us(),{state:n,actions:s,isLoadingMoreRef:$e,lastBeforeIdRef:oe,lastAfterIdRef:O,setLoadingWithTimeout:p}=Xs(),R=r.useRef(null),K=r.useRef(null),{markMessageAsRead:Be,markAllMessagesAsRead:Ie,addToReadBuffer:ve,unreadMessagesBufferRef:es}=Ys({activeChannel:o}),le=r.useRef(Ie);le.current=Ie;const{isScrolledToBottom:xe,setIsScrolledToBottom:Fe,showScrollButton:ss,setShowScrollButton:ts,showDateLabel:ns,setShowDateLabel:as,currentDateLabel:rs,setCurrentDateLabel:os,setDisableAutoScroll:C,scrollToBottom:j,scrollToMessage:ls}=Zs({messagesContainerRef:R,messages:g,activeChannel:o,onMarkAllAsRead:Ie,isUpdatingFromRequest:N}),is=r.useRef(null),$=r.useRef(null),v=r.useRef(0),U=r.useRef(null),[us,be]=r.useState(!1),[H,Te]=r.useState(null),[we,ie]=r.useState(!1),ye=r.useRef(null),[ue,Je]=r.useState(null),{searchQuery:Qe,setSearchQuery:ds,debouncedSearchQuery:cs,searchMode:X,setSearchMode:_e,showSearchResults:Ae,setShowSearchResults:Ee,searchResults:gs,isSearching:fs,handleSearchInputChange:Ms,clearSearch:z,highlightedMessages:ps,setHighlightedMessages:x,focusedMessageId:ms,setFocusedMessageId:w,searchInputRef:ee,searchResultsRef:Re,loadMore:hs,hasMore:Ss,isLoadingMore:Is}=$s({channelId:o==null?void 0:o.id,onSearchResultClick:e=>{g.some(a=>a.id===e)?(U.current=e,x(new Set),w(null),x(a=>{const l=new Set(a);return l.add(e),l}),w(e),setTimeout(()=>{x(a=>{const l=new Set(a);return l.delete(e),l}),w(null)},1500)):(s.setIsJumpingToMessage(!0),s.setSkipMainQuery(!0),c([]),Q(new Map),s.setBeforeId(null),s.setAfterId(null),s.setHasMoreMessages(!0),s.setHasMoreMessagesAfter(!0),s.setEnableAfterPagination(!0),_(e),s.setAroundMessageId(e),s.setLoadingMode("around"))}}),[W,_]=r.useState(null),[qe,de]=r.useState(null);vs(o,i,{onMessageCreate:r.useCallback(e=>{De(e)},[De]),onMessageUpdate:r.useCallback(e=>{Pe(e)},[Pe]),onMessageDelete:r.useCallback(e=>{P(e)},[P]),onMessageReadStatus:r.useCallback(e=>{ae(e,i.id)},[ae,i.id]),onHighlightMessage:r.useCallback((e,t=1500)=>{x(a=>{const l=new Set(a);return l.add(e),l}),setTimeout(()=>{x(a=>{const l=new Set(a);return l.delete(e),l})},t)},[x]),onUnreadMessage:r.useCallback(e=>{je(e)},[je]),onMarkMessageAsRead:r.useCallback(e=>{te(e,i.id),He(e),Be(e)},[te,He,i.id,Be]),onNewMessageIndicator:r.useCallback(()=>{},[]),onScrollToBottom:r.useCallback(()=>{j()},[j]),onMarkAllAsRead:r.useCallback(()=>{ne(i.id),le.current()},[ne,i.id]),onUnreadCountChange:r.useCallback(e=>{re(e)},[re])},{messagesContainerRef:R,convertToExtendedMessage:T,isScrolledToBottom:xe,isJumpingToMessage:n.isJumpingToMessage,loadingMode:n.loadingMode,unreadMessagesBufferRef:es,addToReadBuffer:ve});const V=50,Ne=(o==null?void 0:o.type)===se.PRIVATE&&!n.skipMainQuery&&(n.loadingMode==="initial"||n.loadingMode==="pagination"||n.loadingMode===null&&(n.beforeId!==null||n.afterId!==null)),xs=Ne?{channelId:(o==null?void 0:o.id)??0,params:{size:V,...n.loadingMode!=="initial"&&n.beforeId?{before:n.beforeId}:{},...n.loadingMode!=="initial"&&n.afterId?{after:n.afterId}:{}}}:{channelId:0,params:{}},{data:h=[],isLoading:q,isFetching:G}=Ue(xs,{skip:!Ne,refetchOnMountOrArgChange:!0,refetchOnReconnect:!0,refetchOnFocus:!1}),{data:ce,isLoading:ge}=Ue((o==null?void 0:o.type)===se.PRIVATE&&n.aroundMessageId&&n.loadingMode==="around"?{channelId:(o==null?void 0:o.id)??0,params:{size:V,around:n.aroundMessageId}}:{channelId:0,params:{}},{skip:!o||o.type!==se.PRIVATE||!n.aroundMessageId||n.loadingMode!=="around"}),[Oe]=Qs(),[Ce]=_s(),[ze]=qs(),{notify:fe}=Ns(),bs=!0,Ts=!0;r.useEffect(()=>{Z(),s.setHasMoreMessages(!0),s.setHasMoreMessagesAfter(!0),s.setEnableAfterPagination(!1),s.setBeforeId(null),s.setAfterId(null),k(null),os(null),as(!1),ts(!1),Fe(!0),p(!1),O.current=null,oe.current=null,z(),_(null),s.setAroundMessageId(null),s.setLoadingMode("initial"),s.setIsJumpingToMessage(!1),s.setInitialLoadComplete(!1),de(null),s.setSkipMainQuery(!1)},[o==null?void 0:o.id,Z,z]);const ws=r.useCallback(()=>{c([]),Q(new Map),v.current=0,s.setLoadingMode("initial"),s.setIsJumpingToMessage(!1),s.setBeforeId(null),s.setAfterId(null),s.setAroundMessageId(null),s.setSkipMainQuery(!1),s.setHasMoreMessages(!0),s.setHasMoreMessagesAfter(!1),s.setEnableAfterPagination(!1),oe.current=null,O.current=null,_(null),de(null),L(new Set),D(),p(!0),C(!1),setTimeout(()=>{s.setLoadingMode("initial")},50)},[s,c,Q,L,D,_,de,p]);r.useEffect(()=>{if(ce&&ce.length>0&&n.loadingMode==="around"){p(!0);const e=ce.map(T);E(!0),c(e),setTimeout(()=>E(!1),100),v.current=e.length,de(n.aroundMessageId),O.current=null,oe.current=null;const t=e.filter(a=>a.status===pe.NEW&&a.author.id!==i.id);t.length>0&&(L(new Set(t.map(a=>a.id))),D(),re(t.length)),s.setEnableAfterPagination(!0),e.length>5&&(s.setHasMoreMessages(!0),s.setHasMoreMessagesAfter(!0))}},[ce,n.loadingMode,T,i.id,s]),r.useEffect(()=>{if(!(!o||o.type!==se.PRIVATE)&&n.loadingMode!=="around"&&!(q||G)&&!n.isJumpingToMessage&&!(n.beforeId!==null||n.afterId!==null)&&!(qe!==null&&g.length>0)){if(!h||h.length===0){c([]),n.loadingMode==="initial"&&setTimeout(()=>{j()},50);return}if(n.loadingMode==="initial"){const e=h.map(T);E(!0),c(e),setTimeout(()=>E(!1),100),v.current=e.length,h.length<V&&s.setHasMoreMessagesAfter(!1),s.setEnableAfterPagination(!1);const t=e.filter(a=>a.status===pe.NEW&&a.author.id!==i.id);t.length>0&&(L(new Set(t.map(a=>a.id))),D(),re(t.length)),setTimeout(()=>{j(!1,()=>{le.current()}),s.setLoadingMode(null),s.setInitialLoadComplete(!0),p(!1)},100)}}},[o,h,q,G,T,i.id,j,n.loadingMode,n.isJumpingToMessage,n.beforeId,n.afterId,s,qe,g.length]);const ys=r.useRef(null);r.useLayoutEffect(()=>{if(n.loadingMode==="initial"&&g.length>0&&R.current){const e=R.current,t=e.style.scrollBehavior;e.style.scrollBehavior="auto",e.scrollTop=e.scrollHeight,requestAnimationFrame(()=>{e.scrollTop<e.scrollHeight-e.clientHeight-10&&(e.scrollTop=e.scrollHeight),e.style.scrollBehavior=t})}},[g,n.loadingMode]),r.useEffect(()=>{W&&g.length>0&&n.loadingMode==="around"&&!ge&&g.some(t=>t.id===W)&&(p(!0),requestAnimationFrame(()=>{U.current=W,c(t=>[...t])}),x(t=>{const a=new Set(t);return a.add(W),a}),w(W),setTimeout(()=>{x(t=>{const a=new Set(t);return a.delete(W),a}),w(null)},1500),setTimeout(()=>{_(null),ys.current=null,s.setAroundMessageId(null),g.length>0&&(oe.current=null,O.current=null,s.setHasMoreMessages(!0),s.setHasMoreMessagesAfter(!0),s.setEnableAfterPagination(!0)),setTimeout(()=>{s.setLoadingMode(null),s.setIsJumpingToMessage(!1),s.setSkipMainQuery(!1),C(!1),p(!1)},300)},200))},[g.length,W,n.loadingMode,ge,s,x,w,c]),r.useEffect(()=>{if(!o)return;const e=t=>{(t.ctrlKey||t.metaKey)&&t.key==="f"&&(t.preventDefault(),_e(!0),setTimeout(()=>{ee.current&&ee.current.focus()},100)),t.key==="Escape"&&X&&(z(),x(new Set),w(null))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[o,X]),r.useEffect(()=>{if(f&&$.current){$.current.focus();const e=$.current.value.length;$.current.setSelectionRange(e,e)}},[f]),r.useEffect(()=>{b.current=F},[F]);const As=r.useCallback(async(e,t)=>{if(!o)return;const a={channelId:o.id,content:e.content,...e.images&&e.images.length>0?{attachments:e.images}:{},...t!=null&&t.id?{replyId:t.id}:{}},l=await Oe(a).unwrap(),S={...l,status:pe.SENT,channel_id:o.id,reply:l.reply?T(l.reply):null};return c(u=>[...u,S]),l},[o,Oe,T,c]),{queueMessage:We}=et({onSendMessage:As,onAddTempMessage:Xe,onRemoveTempMessage:Ye,onUpdateTempMessage:Ze,activeChannel:o,user:i}),Es=r.useCallback(async(e,{resetForm:t})=>{if(!o||!i)return;const a=e.content.trim(),l=e.images&&e.images.length>0;if(!a&&!l)return;const S=b.current;J(null),We(e,{resetForm:t},S),setTimeout(()=>{j()},50)},[o,i,We,j]),Rs=r.useCallback(async(e,{resetForm:t})=>{if(!f||!o)return;const a=e.content.trim();if(!a)return;const l=g.find(u=>u.id===f);if(!l)return;if(a===l.content){k(null),t();return}const S={...l,content:a,last_modified_at:new Date().toISOString()};c(u=>u.map(I=>I.id===f?S:I)),k(null),t();try{const u=await Ce({channelId:o.id,messageId:f,content:a}).unwrap();c(I=>I.map(M=>M.id===f?T(u):M))}catch(u){console.error("Failed to edit message:",u),c(I=>I.map(M=>M.id===f?l:M)),fe("Ошибка при обновлении сообщения","error")}},[f,o,Ce,g,fe]),ks=r.useCallback(e=>{Te(e),be(!0),ie(!1)},[g]),Ls=r.useCallback(async()=>{if(!o||!H)return;const e=g.find(t=>t.id===H);if(e){be(!1),c(t=>t.filter(l=>l.id!==H).map(l=>l.reply&&l.reply.id===H?{...l,reply:void 0}:l));try{await ze({channelId:o.id,messageId:H,forEveryone:we}).unwrap()}catch(t){console.error("Ошибка при удалении сообщения",t),c(a=>{if(!a.some(l=>l.id===H)){const l=[...a],S=l.findIndex(u=>new Date(u.created_at)>new Date(e.created_at));return S===-1?l.push(e):l.splice(S,0,e),l.map(u=>u.reply&&u.reply.id===H?{...u,reply:e}:u)}return a}),fe("Ошибка при удалении сообщения","error")}Te(null),ie(!1)}},[o,ze,g,fe,H,we]),Ps=r.useCallback(e=>{g.some(a=>a.id===e.id)?(z(),Je(e.id),requestAnimationFrame(()=>{U.current=e.id}),x(new Set),w(null),x(a=>{const l=new Set(a);return l.add(e.id),l}),w(e.id),setTimeout(()=>{x(a=>{const l=new Set(a);return l.delete(e.id),l}),w(null)},1500)):(s.setLoadingMode("around"),s.setSkipMainQuery(!0),s.setIsJumpingToMessage(!0),z(),C(!0),p(!0),s.setBeforeId(null),c([]),Q(new Map),v.current=0,L(new Set),D(),_(e.id),s.setAroundMessageId(e.id))},[g,z,s,C,p,c,Q,v,L,D,_,U,x,w]);r.useEffect(()=>{var e;if(h&&h.length>0&&n.beforeId!==null&&n.afterId===null&&n.loadingMode==="pagination"&&!q&&!G)try{const t=(e=h[0])==null?void 0:e.id;if(t&&t>=n.beforeId){p(!1),s.setLoadingMode(null),s.setBeforeId(null);return}if(!R.current)return;K.current&&(K.current.prepareScrollCorrection(),K.current.setDisableSmoothScroll(!0)),h.length<V&&s.setHasMoreMessages(!1),C(!0);const l=h.map(T);E(!0),c(S=>{const u=new Map;return S.forEach(M=>{typeof M.id=="number"&&M.id>0&&u.set(M.id,M)}),l.forEach(M=>{typeof M.id=="number"&&M.id>0&&u.set(M.id,M)}),Array.from(u.values()).sort((M,m)=>new Date(M.created_at).getTime()-new Date(m.created_at).getTime())}),setTimeout(()=>E(!1),100),setTimeout(()=>{K.current&&K.current.setDisableSmoothScroll(!1),p(!1),s.setLoadingMode(null)},100)}catch(t){console.error("Error in pagination loading (before):",t),p(!1),s.setLoadingMode(null)}},[h,n.beforeId,T,n.loadingMode,q,G,s,p]),r.useEffect(()=>{var e;if(h&&h.length>0&&n.afterId!==null&&n.beforeId===null&&n.loadingMode==="pagination"&&!q&&!G)try{let t=h;const a=(e=h[0])==null?void 0:e.id;if(a&&a<=n.afterId){const u=h.filter(I=>I.id>n.afterId);if(u.length===0){s.setHasMoreMessagesAfter(!1),s.setEnableAfterPagination(!1),p(!1),s.setLoadingMode(null),s.setAfterId(null),O.current=null;return}t=u}if(!R.current){p(!1),s.setLoadingMode(null);return}t.length<V&&(s.setHasMoreMessagesAfter(!1),s.setEnableAfterPagination(!1)),C(!0);const S=t.map(T);E(!0),c(u=>{const I=new Map;return u.forEach(m=>{typeof m.id=="number"&&m.id>0&&I.set(m.id,m)}),S.forEach(m=>{typeof m.id=="number"&&m.id>0&&I.set(m.id,m)}),Array.from(I.values()).sort((m,Ve)=>new Date(m.created_at).getTime()-new Date(Ve.created_at).getTime())}),setTimeout(()=>E(!1),100),requestAnimationFrame(()=>{p(!1),s.setLoadingMode(null),n.hasMoreMessagesAfter||(s.setAfterId(null),O.current=null),setTimeout(()=>{s.clearAfterPaginationCooldown()},500)})}catch(t){console.error("Error in pagination loading (after):",t),p(!1),s.setLoadingMode(null),s.clearAfterPaginationCooldown()}},[h,n.afterId,T,n.loadingMode,q,G,s,n.hasMoreMessagesAfter,O,p]),r.useEffect(()=>{const e=R.current;if(!e)return;let t=e.scrollTop,a=!1,l=0,S=null,u=!1,I=0;const M=()=>{u||(u=!0,requestAnimationFrame(()=>{S&&clearTimeout(S);const m=e.scrollTop,ke=e.scrollHeight-m-e.clientHeight<100;m<t?a||(a=!0,l=Date.now()):m>t&&ke&&(a=!1),t=m;const Hs=Date.now()-l;if((!a||Hs>1e3)&&Fe(ke),ke&&o){C(!1);const Ge=Date.now();Ge-I>1e3&&(I=Ge,le.current()),c(Bs=>Bs.map(Le=>Le.author.id!==i.id?{...Le,status:pe.READ}:Le)),L(new Set),D()}S=setTimeout(()=>{S=null},150),u=!1}))};return e.addEventListener("scroll",M,{passive:!0}),()=>e.removeEventListener("scroll",M)},[o,n.enableAfterPagination,n.hasMoreMessagesAfter,g]),r.useEffect(()=>()=>{ye.current&&clearTimeout(ye.current)},[]),r.useEffect(()=>{xe&&Y>0&&D()},[xe,Y,D]),r.useEffect(()=>{ue!==null&&(U.current=ue,setTimeout(()=>{Je(null)},100))},[ue]),r.useEffect(()=>{X||(ds(""),Ee(!1),setTimeout(()=>{if(R.current&&n.loadingMode!=="around"&&!n.isJumpingToMessage){const{scrollHeight:e,scrollTop:t,clientHeight:a}=R.current;e-t-a<200&&j()}},100))},[X,j,n.loadingMode,n.isJumpingToMessage]),r.useEffect(()=>{const e=t=>{Ae&&Re.current&&ee.current&&!Re.current.contains(t.target)&&!ee.current.contains(t.target)&&Ee(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[Ae]);const Ds=()=>d.jsx(y,{sx:{flex:1,height:"100%",p:3,display:"flex",flexDirection:"column",gap:2,overflowY:"auto",overflowX:"hidden"},children:[...Array(V)].map((e,t)=>d.jsxs(y,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[d.jsx(Me,{variant:"circular",width:40,height:40,animation:"wave",sx:{bgcolor:"rgba(255,255,255,0.1)",flexShrink:0}}),d.jsxs(y,{sx:{flex:1},children:[d.jsx(Me,{variant:"text",width:120,height:24,animation:"wave",sx:{bgcolor:"rgba(255,255,255,0.1)",mb:1}}),d.jsx(Me,{variant:"text",width:"80%",height:20,animation:"wave",sx:{bgcolor:"rgba(255,255,255,0.1)"}}),d.jsx(Me,{variant:"text",width:"60%",height:20,animation:"wave",sx:{bgcolor:"rgba(255,255,255,0.1)"}})]})]},t))}),js=()=>d.jsx(at,{activeChannel:o,messages:g,tempMessages:me,searchMode:X,searchQuery:Qe,highlightedMessages:ps,focusedMessageId:ms,unreadMessages:he,isLoadingMore:$e.current,isLoadingAround:ge,editingMessageId:f,user:i,otherUser:A,paginationState:n,messagesPerPage:V,showDateLabel:ns,currentDateLabel:rs,messagesContainerRef:R,messagesEndRef:is,editInputRef:$,highlightTimeoutRef:ye,scrollToMessageIdRef:U,setHighlightedMessages:x,setFocusedMessageId:w,setEditingMessageId:k,setMessages:c,setTempMessages:Q,setReplyingToMessage:J,setTargetMessageId:_,paginationActions:s,handleEditMessage:Rs,handleDeleteMessage:ks,scrollCorrectionRef:K,forceScrollToMessageId:ue});return d.jsxs(y,{sx:{flex:1,display:"flex",flexDirection:"column",background:"rgba(30,30,47,0.95)",backdropFilter:"blur(10px)",position:"relative"},children:[d.jsx(st,{open:us,messageToDelete:H,deleteForEveryone:we,canManageMessages:Ts,messages:g,userId:i.id,onClose:()=>{be(!1),Te(null),ie(!1)},onConfirm:Ls,onDeleteForEveryoneChange:e=>ie(e)}),d.jsx(rt,{activeChannel:o,otherUser:A,searchMode:X,setSearchMode:_e,searchQuery:Qe,searchInputRef:ee,searchResultsRef:Re,showSearchResults:Ae,setShowSearchResults:Ee,searchResults:gs||[],isSearching:fs,debouncedSearchQuery:cs,handleSearchInputChange:e=>Ms(e.target.value),clearSearch:z,onSearchResultClick:Ps,onLoadMore:hs,hasMore:Ss,isLoadingMore:Is,isLoadingMessages:q||G,isLoadingAround:ge,paginationState:{loadingMode:n.loadingMode,beforeId:n.beforeId,afterId:n.afterId,isJumpingToMessage:n.isJumpingToMessage}}),q&&!n.beforeId?Ds():js(),d.jsx(tt,{showScrollButton:ss,newMessagesCount:Y,unreadCount:Se,replyingToMessage:!!F,onScrollToBottom:ws}),d.jsx(nt,{activeChannel:o,canSendMessages:bs,sending:B,replyingToMessage:F,onSendMessage:Es,onReplyCancel:()=>J(null),onReplyClick:ls})]})},ct=()=>{var J;const{channelId:o}=Os(),i=Cs(),A=zs(b=>b.user.currentUser),B=o?parseInt(o):null;if(!A||!B)return d.jsx(Ws,{to:"/",replace:!0});let f=(J=i.state)==null?void 0:J.otherUser;const{data:k}=Vs(void 0,{skip:!!f});if(!f&&k){const b=k.find(N=>N.id===B);(b==null?void 0:b.type)===2&&b.members&&b.members.length>0&&(f=b.members.find(N=>N.id!==A.id)||b.members[0])}const F=r.useMemo(()=>({id:B,name:(f==null?void 0:f.login)||"Private Chat",type:se.PRIVATE,categoryId:0}),[B,f]);return d.jsx(y,{sx:{display:"flex",height:"100vh"},children:d.jsx(ot,{activeChannel:F,user:A,otherUser:f})})};export{ct as default};
