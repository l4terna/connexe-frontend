import{i as Le,j as r,k as hr,r as s,R as Ce,l as yt,m as ht,n as qe,f as Gt,T as X,B as w,I as xe,A as wn,u as br,o as en,F as Ct,C as qt,p as Sn,P as ot,q as ve,t as xr,v as vt,w as mr,x as Yr,y as Te,b as Cn,z as gn,D as wt,g as pn,E as St,G as On,L as Kr,H as Bn,J as Fn,K as Qr,h as hn,M as yr,N as st,O as Jr,Q as Zr,U as Ln,d as zn,V as eo,W as to,X as no,Y as ro,Z as oo,_ as so,S as io,$ as ao,a0 as $t,a1 as et,a2 as ut,a3 as Nn,a4 as Pn,a5 as _n,a6 as Ht}from"./index-_IwMgO9w.js";import{S as jn,A as lo,a as co}from"./SearchModal-b_9iSDJP.js";import{L as tn}from"./ListItemButton-C-limiLW.js";import{u as vr,C as uo,a as fo,b as go}from"./roles-BhP7xq1K.js";import{I as $n}from"./Input-C9VLMywm.js";import{L as po}from"./ListItemAvatar-vXF5_eJa.js";import"./Tabs-TXamPSyv.js";const ho=Le(r.jsx("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2m6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1z"})),wr=Le(r.jsx("path",{d:"M21 6h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1m-4 6V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1"})),Sr=Le(r.jsx("path",{d:"M3 9v6h4l5 5V4L7 9zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02M14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77"})),bo=hr.injectEndpoints({endpoints:e=>({createCategory:e.mutation({query:({hubId:t,name:n})=>({url:`/api/v1/hubs/${t}/categories`,method:"POST",body:{name:n}}),invalidatesTags:["Category"]}),getCategories:e.query({query:t=>({url:`/api/v1/hubs/${t}/entities`}),keepUnusedDataFor:0,serializeQueryArgs:({queryArgs:t})=>t,merge:(t,n)=>n,forceRefetch({currentArg:t,previousArg:n}){return t!==n}}),updateCategoryPosition:e.mutation({query:({hubId:t,categoryId:n,data:o})=>({url:`/api/v1/hubs/${t}/categories/${n}`,method:"PUT",body:o}),invalidatesTags:["Category"]}),deleteCategory:e.mutation({query:({hubId:t,categoryId:n})=>({url:`/api/v1/hubs/${t}/categories/${n}`,method:"DELETE"}),invalidatesTags:["Category"]})})}),{useCreateCategoryMutation:xo,useGetCategoriesQuery:mo,useUpdateCategoryPositionMutation:yo,useDeleteCategoryMutation:vo}=bo;var Ie=(e=>(e[e.VOICE=0]="VOICE",e[e.TEXT=1]="TEXT",e))(Ie||{});const wo=hr.injectEndpoints({endpoints:e=>({createChannel:e.mutation({query:({hubId:t,data:n})=>({url:`/api/v1/hubs/${t}/channels`,method:"POST",body:{...n,category_id:n.categoryId}}),invalidatesTags:["Channel"]}),updateChannel:e.mutation({query:({channelId:t,data:n})=>{const o={...n};return"categoryId"in o&&(o.category_id=o.categoryId,delete o.categoryId),{url:`/api/v1/channels/${t}`,method:"PUT",body:o}},invalidatesTags:["Channel"]}),deleteChannel:e.mutation({query:({channelId:t})=>({url:`/api/v1/channels/${t}`,method:"DELETE"}),invalidatesTags:["Channel"]}),getMessages:e.query({query:({channelId:t,params:n})=>({url:`/api/v1/channels/${t}/messages`,params:n}),keepUnusedDataFor:0,serializeQueryArgs:({queryArgs:t})=>t.channelId,merge:(t,n)=>n,forceRefetch({currentArg:t,previousArg:n}){return t!==n}}),createMessage:e.mutation({query:({channelId:t,content:n,attachments:o=[]})=>{const i=new FormData;return i.append("content",n),o.forEach(a=>i.append("attachments",a)),{url:`/api/v1/channels/${t}/messages`,method:"POST",body:i,formData:!0}},invalidatesTags:["Channel"]}),updateMessage:e.mutation({query:({channelId:t,messageId:n,content:o})=>{const i=new FormData;return i.append("content",o),{url:`/api/v1/channels/${t}/messages/${n}`,method:"PUT",body:i,formData:!0}},invalidatesTags:["Channel"]}),deleteMessage:e.mutation({query:({channelId:t,messageId:n})=>({url:`/api/v1/channels/${t}/messages/${n}`,method:"DELETE"}),invalidatesTags:["Channel"]})})}),{useCreateChannelMutation:So,useUpdateChannelMutation:Co,useDeleteChannelMutation:jo,useGetMessagesQuery:ko,useCreateMessageMutation:Io,useUpdateMessageMutation:Eo,useDeleteMessageMutation:Mo}=wo;function Ro(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return s.useMemo(()=>o=>{t.forEach(i=>i(o))},t)}const nn=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function It(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function kn(e){return"nodeType"in e}function ze(e){var t,n;return e?It(e)?e:kn(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function In(e){const{Document:t}=ze(e);return e instanceof t}function Nt(e){return It(e)?!1:e instanceof ze(e).HTMLElement}function Cr(e){return e instanceof ze(e).SVGElement}function Et(e){return e?It(e)?e.document:kn(e)?In(e)?e:Nt(e)||Cr(e)?e.ownerDocument:document:document:document}const nt=nn?s.useLayoutEffect:s.useEffect;function En(e){const t=s.useRef(e);return nt(()=>{t.current=e}),s.useCallback(function(){for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return t.current==null?void 0:t.current(...o)},[])}function Do(){const e=s.useRef(null),t=s.useCallback((o,i)=>{e.current=setInterval(o,i)},[]),n=s.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function Ft(e,t){t===void 0&&(t=[e]);const n=s.useRef(e);return nt(()=>{n.current!==e&&(n.current=e)},t),n}function Pt(e,t){const n=s.useRef();return s.useMemo(()=>{const o=e(n.current);return n.current=o,o},[...t])}function Yt(e){const t=En(e),n=s.useRef(null),o=s.useCallback(i=>{i!==n.current&&(t==null||t(i,n.current)),n.current=i},[]);return[n,o]}function bn(e){const t=s.useRef();return s.useEffect(()=>{t.current=e},[e]),t.current}let an={};function _t(e,t){return s.useMemo(()=>{if(t)return t;const n=an[e]==null?0:an[e]+1;return an[e]=n,e+"-"+n},[e,t])}function jr(e){return function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];return o.reduce((a,l)=>{const c=Object.entries(l);for(const[f,d]of c){const p=a[f];p!=null&&(a[f]=p+e*d)}return a},{...t})}}const jt=jr(1),Lt=jr(-1);function To(e){return"clientX"in e&&"clientY"in e}function Mn(e){if(!e)return!1;const{KeyboardEvent:t}=ze(e.target);return t&&e instanceof t}function Ao(e){if(!e)return!1;const{TouchEvent:t}=ze(e.target);return t&&e instanceof t}function xn(e){if(Ao(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return To(e)?{x:e.clientX,y:e.clientY}:null}const kt=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[kt.Translate.toString(e),kt.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:o}=e;return t+" "+n+"ms "+o}}}),Hn="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Oo(e){return e.matches(Hn)?e:e.querySelector(Hn)}const Bo={display:"none"};function Fo(e){let{id:t,value:n}=e;return Ce.createElement("div",{id:t,style:Bo},n)}function Lo(e){let{id:t,announcement:n,ariaLiveType:o="assertive"}=e;const i={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return Ce.createElement("div",{id:t,style:i,role:"status","aria-live":o,"aria-atomic":!0},n)}function zo(){const[e,t]=s.useState("");return{announce:s.useCallback(o=>{o!=null&&t(o)},[]),announcement:e}}const kr=s.createContext(null);function No(e){const t=s.useContext(kr);s.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function Po(){const[e]=s.useState(()=>new Set),t=s.useCallback(o=>(e.add(o),()=>e.delete(o)),[e]);return[s.useCallback(o=>{let{type:i,event:a}=o;e.forEach(l=>{var c;return(c=l[i])==null?void 0:c.call(l,a)})},[e]),t]}const _o={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},$o={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function Ho(e){let{announcements:t=$o,container:n,hiddenTextDescribedById:o,screenReaderInstructions:i=_o}=e;const{announce:a,announcement:l}=zo(),c=_t("DndLiveRegion"),[f,d]=s.useState(!1);if(s.useEffect(()=>{d(!0)},[]),No(s.useMemo(()=>({onDragStart(g){let{active:h}=g;a(t.onDragStart({active:h}))},onDragMove(g){let{active:h,over:v}=g;t.onDragMove&&a(t.onDragMove({active:h,over:v}))},onDragOver(g){let{active:h,over:v}=g;a(t.onDragOver({active:h,over:v}))},onDragEnd(g){let{active:h,over:v}=g;a(t.onDragEnd({active:h,over:v}))},onDragCancel(g){let{active:h,over:v}=g;a(t.onDragCancel({active:h,over:v}))}}),[a,t])),!f)return null;const p=Ce.createElement(Ce.Fragment,null,Ce.createElement(Fo,{id:o,value:i.draggable}),Ce.createElement(Lo,{id:c,announcement:l}));return n?yt.createPortal(p,n):p}var ye;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(ye||(ye={}));function Kt(){}function Un(e,t){return s.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function Uo(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return s.useMemo(()=>[...t].filter(o=>o!=null),[...t])}const Je=Object.freeze({x:0,y:0});function Ir(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Er(e,t){let{data:{value:n}}=e,{data:{value:o}}=t;return n-o}function Wo(e,t){let{data:{value:n}}=e,{data:{value:o}}=t;return o-n}function Wn(e){let{left:t,top:n,height:o,width:i}=e;return[{x:t,y:n},{x:t+i,y:n},{x:t,y:n+o},{x:t+i,y:n+o}]}function Mr(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function Vn(e,t,n){return t===void 0&&(t=e.left),n===void 0&&(n=e.top),{x:t+e.width*.5,y:n+e.height*.5}}const Gn=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:o}=e;const i=Vn(t,t.left,t.top),a=[];for(const l of o){const{id:c}=l,f=n.get(c);if(f){const d=Ir(Vn(f),i);a.push({id:c,data:{droppableContainer:l,value:d}})}}return a.sort(Er)},Vo=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:o}=e;const i=Wn(t),a=[];for(const l of o){const{id:c}=l,f=n.get(c);if(f){const d=Wn(f),p=i.reduce((h,v,E)=>h+Ir(d[E],v),0),g=Number((p/4).toFixed(4));a.push({id:c,data:{droppableContainer:l,value:g}})}}return a.sort(Er)};function Go(e,t){const n=Math.max(t.top,e.top),o=Math.max(t.left,e.left),i=Math.min(t.left+t.width,e.left+e.width),a=Math.min(t.top+t.height,e.top+e.height),l=i-o,c=a-n;if(o<i&&n<a){const f=t.width*t.height,d=e.width*e.height,p=l*c,g=p/(f+d-p);return Number(g.toFixed(4))}return 0}const Xo=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:o}=e;const i=[];for(const a of o){const{id:l}=a,c=n.get(l);if(c){const f=Go(c,t);f>0&&i.push({id:l,data:{droppableContainer:a,value:f}})}}return i.sort(Wo)};function qo(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function Rr(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:Je}function Yo(e){return function(n){for(var o=arguments.length,i=new Array(o>1?o-1:0),a=1;a<o;a++)i[a-1]=arguments[a];return i.reduce((l,c)=>({...l,top:l.top+e*c.y,bottom:l.bottom+e*c.y,left:l.left+e*c.x,right:l.right+e*c.x}),{...n})}}const Ko=Yo(1);function Qo(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function Jo(e,t,n){const o=Qo(t);if(!o)return e;const{scaleX:i,scaleY:a,x:l,y:c}=o,f=e.left-l-(1-i)*parseFloat(n),d=e.top-c-(1-a)*parseFloat(n.slice(n.indexOf(" ")+1)),p=i?e.width/i:e.width,g=a?e.height/a:e.height;return{width:p,height:g,top:d,right:f+p,bottom:d+g,left:f}}const Zo={ignoreTransform:!1};function Mt(e,t){t===void 0&&(t=Zo);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:d,transformOrigin:p}=ze(e).getComputedStyle(e);d&&(n=Jo(n,d,p))}const{top:o,left:i,width:a,height:l,bottom:c,right:f}=n;return{top:o,left:i,width:a,height:l,bottom:c,right:f}}function Xn(e){return Mt(e,{ignoreTransform:!0})}function es(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function ts(e,t){return t===void 0&&(t=ze(e).getComputedStyle(e)),t.position==="fixed"}function ns(e,t){t===void 0&&(t=ze(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(i=>{const a=t[i];return typeof a=="string"?n.test(a):!1})}function rn(e,t){const n=[];function o(i){if(t!=null&&n.length>=t||!i)return n;if(In(i)&&i.scrollingElement!=null&&!n.includes(i.scrollingElement))return n.push(i.scrollingElement),n;if(!Nt(i)||Cr(i)||n.includes(i))return n;const a=ze(e).getComputedStyle(i);return i!==e&&ns(i,a)&&n.push(i),ts(i,a)?n:o(i.parentNode)}return e?o(e):n}function Dr(e){const[t]=rn(e,1);return t??null}function ln(e){return!nn||!e?null:It(e)?e:kn(e)?In(e)||e===Et(e).scrollingElement?window:Nt(e)?e:null:null}function Tr(e){return It(e)?e.scrollX:e.scrollLeft}function Ar(e){return It(e)?e.scrollY:e.scrollTop}function mn(e){return{x:Tr(e),y:Ar(e)}}var Se;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(Se||(Se={}));function Or(e){return!nn||!e?!1:e===document.scrollingElement}function Br(e){const t={x:0,y:0},n=Or(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},o={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},i=e.scrollTop<=t.y,a=e.scrollLeft<=t.x,l=e.scrollTop>=o.y,c=e.scrollLeft>=o.x;return{isTop:i,isLeft:a,isBottom:l,isRight:c,maxScroll:o,minScroll:t}}const rs={x:.2,y:.2};function os(e,t,n,o,i){let{top:a,left:l,right:c,bottom:f}=n;o===void 0&&(o=10),i===void 0&&(i=rs);const{isTop:d,isBottom:p,isLeft:g,isRight:h}=Br(e),v={x:0,y:0},E={x:0,y:0},C={height:t.height*i.y,width:t.width*i.x};return!d&&a<=t.top+C.height?(v.y=Se.Backward,E.y=o*Math.abs((t.top+C.height-a)/C.height)):!p&&f>=t.bottom-C.height&&(v.y=Se.Forward,E.y=o*Math.abs((t.bottom-C.height-f)/C.height)),!h&&c>=t.right-C.width?(v.x=Se.Forward,E.x=o*Math.abs((t.right-C.width-c)/C.width)):!g&&l<=t.left+C.width&&(v.x=Se.Backward,E.x=o*Math.abs((t.left+C.width-l)/C.width)),{direction:v,speed:E}}function ss(e){if(e===document.scrollingElement){const{innerWidth:a,innerHeight:l}=window;return{top:0,left:0,right:a,bottom:l,width:a,height:l}}const{top:t,left:n,right:o,bottom:i}=e.getBoundingClientRect();return{top:t,left:n,right:o,bottom:i,width:e.clientWidth,height:e.clientHeight}}function Fr(e){return e.reduce((t,n)=>jt(t,mn(n)),Je)}function is(e){return e.reduce((t,n)=>t+Tr(n),0)}function as(e){return e.reduce((t,n)=>t+Ar(n),0)}function ls(e,t){if(t===void 0&&(t=Mt),!e)return;const{top:n,left:o,bottom:i,right:a}=t(e);Dr(e)&&(i<=0||a<=0||n>=window.innerHeight||o>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const cs=[["x",["left","right"],is],["y",["top","bottom"],as]];class Rn{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const o=rn(n),i=Fr(o);this.rect={...t},this.width=t.width,this.height=t.height;for(const[a,l,c]of cs)for(const f of l)Object.defineProperty(this,f,{get:()=>{const d=c(o),p=i[a]-d;return this.rect[f]+p},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Tt{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var o;return(o=this.target)==null?void 0:o.removeEventListener(...n)})},this.target=t}add(t,n,o){var i;(i=this.target)==null||i.addEventListener(t,n,o),this.listeners.push([t,n,o])}}function ds(e){const{EventTarget:t}=ze(e);return e instanceof t?e:Et(e)}function cn(e,t){const n=Math.abs(e.x),o=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+o**2)>t:"x"in t&&"y"in t?n>t.x&&o>t.y:"x"in t?n>t.x:"y"in t?o>t.y:!1}var Xe;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(Xe||(Xe={}));function qn(e){e.preventDefault()}function us(e){e.stopPropagation()}var J;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(J||(J={}));const Lr={start:[J.Space,J.Enter],cancel:[J.Esc],end:[J.Space,J.Enter,J.Tab]},fs=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case J.Right:return{...n,x:n.x+25};case J.Left:return{...n,x:n.x-25};case J.Down:return{...n,y:n.y+25};case J.Up:return{...n,y:n.y-25}}};class Dn{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new Tt(Et(n)),this.windowListeners=new Tt(ze(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Xe.Resize,this.handleCancel),this.windowListeners.add(Xe.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Xe.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,o=t.node.current;o&&ls(o),n(Je)}handleKeyDown(t){if(Mn(t)){const{active:n,context:o,options:i}=this.props,{keyboardCodes:a=Lr,coordinateGetter:l=fs,scrollBehavior:c="smooth"}=i,{code:f}=t;if(a.end.includes(f)){this.handleEnd(t);return}if(a.cancel.includes(f)){this.handleCancel(t);return}const{collisionRect:d}=o.current,p=d?{x:d.left,y:d.top}:Je;this.referenceCoordinates||(this.referenceCoordinates=p);const g=l(t,{active:n,context:o.current,currentCoordinates:p});if(g){const h=Lt(g,p),v={x:0,y:0},{scrollableAncestors:E}=o.current;for(const C of E){const D=t.code,{isTop:I,isRight:k,isLeft:M,isBottom:T,maxScroll:z,minScroll:O}=Br(C),B=ss(C),A={x:Math.min(D===J.Right?B.right-B.width/2:B.right,Math.max(D===J.Right?B.left:B.left+B.width/2,g.x)),y:Math.min(D===J.Down?B.bottom-B.height/2:B.bottom,Math.max(D===J.Down?B.top:B.top+B.height/2,g.y))},Z=D===J.Right&&!k||D===J.Left&&!M,V=D===J.Down&&!T||D===J.Up&&!I;if(Z&&A.x!==g.x){const F=C.scrollLeft+h.x,P=D===J.Right&&F<=z.x||D===J.Left&&F>=O.x;if(P&&!h.y){C.scrollTo({left:F,behavior:c});return}P?v.x=C.scrollLeft-F:v.x=D===J.Right?C.scrollLeft-z.x:C.scrollLeft-O.x,v.x&&C.scrollBy({left:-v.x,behavior:c});break}else if(V&&A.y!==g.y){const F=C.scrollTop+h.y,P=D===J.Down&&F<=z.y||D===J.Up&&F>=O.y;if(P&&!h.x){C.scrollTo({top:F,behavior:c});return}P?v.y=C.scrollTop-F:v.y=D===J.Down?C.scrollTop-z.y:C.scrollTop-O.y,v.y&&C.scrollBy({top:-v.y,behavior:c});break}}this.handleMove(t,jt(Lt(g,this.referenceCoordinates),v))}}}handleMove(t,n){const{onMove:o}=this.props;t.preventDefault(),o(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Dn.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:o=Lr,onActivation:i}=t,{active:a}=n;const{code:l}=e.nativeEvent;if(o.start.includes(l)){const c=a.activatorNode.current;return c&&e.target!==c?!1:(e.preventDefault(),i==null||i({event:e.nativeEvent}),!0)}return!1}}];function Yn(e){return!!(e&&"distance"in e)}function Kn(e){return!!(e&&"delay"in e)}class Tn{constructor(t,n,o){var i;o===void 0&&(o=ds(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:a}=t,{target:l}=a;this.props=t,this.events=n,this.document=Et(l),this.documentListeners=new Tt(this.document),this.listeners=new Tt(o),this.windowListeners=new Tt(ze(l)),this.initialCoordinates=(i=xn(a))!=null?i:Je,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:o}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(Xe.Resize,this.handleCancel),this.windowListeners.add(Xe.DragStart,qn),this.windowListeners.add(Xe.VisibilityChange,this.handleCancel),this.windowListeners.add(Xe.ContextMenu,qn),this.documentListeners.add(Xe.Keydown,this.handleKeydown),n){if(o!=null&&o({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Kn(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(Yn(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:o,onPending:i}=this.props;i(o,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(Xe.Click,us,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Xe.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:o,initialCoordinates:i,props:a}=this,{onMove:l,options:{activationConstraint:c}}=a;if(!i)return;const f=(n=xn(t))!=null?n:Je,d=Lt(i,f);if(!o&&c){if(Yn(c)){if(c.tolerance!=null&&cn(d,c.tolerance))return this.handleCancel();if(cn(d,c.distance))return this.handleStart()}if(Kn(c)&&cn(d,c.tolerance))return this.handleCancel();this.handlePending(c,d);return}t.cancelable&&t.preventDefault(),l(f)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===J.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const gs={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class An extends Tn{constructor(t){const{event:n}=t,o=Et(n.target);super(t,gs,o)}}An.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:o}=t;return!n.isPrimary||n.button!==0?!1:(o==null||o({event:n}),!0)}}];const ps={move:{name:"mousemove"},end:{name:"mouseup"}};var yn;(function(e){e[e.RightClick=2]="RightClick"})(yn||(yn={}));class hs extends Tn{constructor(t){super(t,ps,Et(t.event.target))}}hs.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:o}=t;return n.button===yn.RightClick?!1:(o==null||o({event:n}),!0)}}];const dn={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class bs extends Tn{constructor(t){super(t,dn)}static setup(){return window.addEventListener(dn.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(dn.move.name,t)};function t(){}}}bs.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:o}=t;const{touches:i}=n;return i.length>1?!1:(o==null||o({event:n}),!0)}}];var At;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(At||(At={}));var Qt;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(Qt||(Qt={}));function xs(e){let{acceleration:t,activator:n=At.Pointer,canScroll:o,draggingRect:i,enabled:a,interval:l=5,order:c=Qt.TreeOrder,pointerCoordinates:f,scrollableAncestors:d,scrollableAncestorRects:p,delta:g,threshold:h}=e;const v=ys({delta:g,disabled:!a}),[E,C]=Do(),D=s.useRef({x:0,y:0}),I=s.useRef({x:0,y:0}),k=s.useMemo(()=>{switch(n){case At.Pointer:return f?{top:f.y,bottom:f.y,left:f.x,right:f.x}:null;case At.DraggableRect:return i}},[n,i,f]),M=s.useRef(null),T=s.useCallback(()=>{const O=M.current;if(!O)return;const B=D.current.x*I.current.x,A=D.current.y*I.current.y;O.scrollBy(B,A)},[]),z=s.useMemo(()=>c===Qt.TreeOrder?[...d].reverse():d,[c,d]);s.useEffect(()=>{if(!a||!d.length||!k){C();return}for(const O of z){if((o==null?void 0:o(O))===!1)continue;const B=d.indexOf(O),A=p[B];if(!A)continue;const{direction:Z,speed:V}=os(O,A,k,t,h);for(const F of["x","y"])v[F][Z[F]]||(V[F]=0,Z[F]=0);if(V.x>0||V.y>0){C(),M.current=O,E(T,l),D.current=V,I.current=Z;return}}D.current={x:0,y:0},I.current={x:0,y:0},C()},[t,T,o,C,a,l,JSON.stringify(k),JSON.stringify(v),E,d,z,p,JSON.stringify(h)])}const ms={x:{[Se.Backward]:!1,[Se.Forward]:!1},y:{[Se.Backward]:!1,[Se.Forward]:!1}};function ys(e){let{delta:t,disabled:n}=e;const o=bn(t);return Pt(i=>{if(n||!o||!i)return ms;const a={x:Math.sign(t.x-o.x),y:Math.sign(t.y-o.y)};return{x:{[Se.Backward]:i.x[Se.Backward]||a.x===-1,[Se.Forward]:i.x[Se.Forward]||a.x===1},y:{[Se.Backward]:i.y[Se.Backward]||a.y===-1,[Se.Forward]:i.y[Se.Forward]||a.y===1}}},[n,t,o])}function vs(e,t){const n=t!=null?e.get(t):void 0,o=n?n.node.current:null;return Pt(i=>{var a;return t==null?null:(a=o??i)!=null?a:null},[o,t])}function ws(e,t){return s.useMemo(()=>e.reduce((n,o)=>{const{sensor:i}=o,a=i.activators.map(l=>({eventName:l.eventName,handler:t(l.handler,o)}));return[...n,...a]},[]),[e,t])}var zt;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(zt||(zt={}));var vn;(function(e){e.Optimized="optimized"})(vn||(vn={}));const Qn=new Map;function Ss(e,t){let{dragging:n,dependencies:o,config:i}=t;const[a,l]=s.useState(null),{frequency:c,measure:f,strategy:d}=i,p=s.useRef(e),g=D(),h=Ft(g),v=s.useCallback(function(I){I===void 0&&(I=[]),!h.current&&l(k=>k===null?I:k.concat(I.filter(M=>!k.includes(M))))},[h]),E=s.useRef(null),C=Pt(I=>{if(g&&!n)return Qn;if(!I||I===Qn||p.current!==e||a!=null){const k=new Map;for(let M of e){if(!M)continue;if(a&&a.length>0&&!a.includes(M.id)&&M.rect.current){k.set(M.id,M.rect.current);continue}const T=M.node.current,z=T?new Rn(f(T),T):null;M.rect.current=z,z&&k.set(M.id,z)}return k}return I},[e,a,n,g,f]);return s.useEffect(()=>{p.current=e},[e]),s.useEffect(()=>{g||v()},[n,g]),s.useEffect(()=>{a&&a.length>0&&l(null)},[JSON.stringify(a)]),s.useEffect(()=>{g||typeof c!="number"||E.current!==null||(E.current=setTimeout(()=>{v(),E.current=null},c))},[c,g,v,...o]),{droppableRects:C,measureDroppableContainers:v,measuringScheduled:a!=null};function D(){switch(d){case zt.Always:return!1;case zt.BeforeDragging:return n;default:return!n}}}function zr(e,t){return Pt(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function Cs(e,t){return zr(e,t)}function js(e){let{callback:t,disabled:n}=e;const o=En(t),i=s.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:a}=window;return new a(o)},[o,n]);return s.useEffect(()=>()=>i==null?void 0:i.disconnect(),[i]),i}function on(e){let{callback:t,disabled:n}=e;const o=En(t),i=s.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:a}=window;return new a(o)},[n]);return s.useEffect(()=>()=>i==null?void 0:i.disconnect(),[i]),i}function ks(e){return new Rn(Mt(e),e)}function Jn(e,t,n){t===void 0&&(t=ks);const[o,i]=s.useState(null);function a(){i(f=>{if(!e)return null;if(e.isConnected===!1){var d;return(d=f??n)!=null?d:null}const p=t(e);return JSON.stringify(f)===JSON.stringify(p)?f:p})}const l=js({callback(f){if(e)for(const d of f){const{type:p,target:g}=d;if(p==="childList"&&g instanceof HTMLElement&&g.contains(e)){a();break}}}}),c=on({callback:a});return nt(()=>{a(),e?(c==null||c.observe(e),l==null||l.observe(document.body,{childList:!0,subtree:!0})):(c==null||c.disconnect(),l==null||l.disconnect())},[e]),o}function Is(e){const t=zr(e);return Rr(e,t)}const Zn=[];function Es(e){const t=s.useRef(e),n=Pt(o=>e?o&&o!==Zn&&e&&t.current&&e.parentNode===t.current.parentNode?o:rn(e):Zn,[e]);return s.useEffect(()=>{t.current=e},[e]),n}function Ms(e){const[t,n]=s.useState(null),o=s.useRef(e),i=s.useCallback(a=>{const l=ln(a.target);l&&n(c=>c?(c.set(l,mn(l)),new Map(c)):null)},[]);return s.useEffect(()=>{const a=o.current;if(e!==a){l(a);const c=e.map(f=>{const d=ln(f);return d?(d.addEventListener("scroll",i,{passive:!0}),[d,mn(d)]):null}).filter(f=>f!=null);n(c.length?new Map(c):null),o.current=e}return()=>{l(e),l(a)};function l(c){c.forEach(f=>{const d=ln(f);d==null||d.removeEventListener("scroll",i)})}},[i,e]),s.useMemo(()=>e.length?t?Array.from(t.values()).reduce((a,l)=>jt(a,l),Je):Fr(e):Je,[e,t])}function er(e,t){t===void 0&&(t=[]);const n=s.useRef(null);return s.useEffect(()=>{n.current=null},t),s.useEffect(()=>{const o=e!==Je;o&&!n.current&&(n.current=e),!o&&n.current&&(n.current=null)},[e]),n.current?Lt(e,n.current):Je}function Rs(e){s.useEffect(()=>{if(!nn)return;const t=e.map(n=>{let{sensor:o}=n;return o.setup==null?void 0:o.setup()});return()=>{for(const n of t)n==null||n()}},e.map(t=>{let{sensor:n}=t;return n}))}function Ds(e,t){return s.useMemo(()=>e.reduce((n,o)=>{let{eventName:i,handler:a}=o;return n[i]=l=>{a(l,t)},n},{}),[e,t])}function Nr(e){return s.useMemo(()=>e?es(e):null,[e])}const tr=[];function Ts(e,t){t===void 0&&(t=Mt);const[n]=e,o=Nr(n?ze(n):null),[i,a]=s.useState(tr);function l(){a(()=>e.length?e.map(f=>Or(f)?o:new Rn(t(f),f)):tr)}const c=on({callback:l});return nt(()=>{c==null||c.disconnect(),l(),e.forEach(f=>c==null?void 0:c.observe(f))},[e]),i}function As(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return Nt(t)?t:e}function Os(e){let{measure:t}=e;const[n,o]=s.useState(null),i=s.useCallback(d=>{for(const{target:p}of d)if(Nt(p)){o(g=>{const h=t(p);return g?{...g,width:h.width,height:h.height}:h});break}},[t]),a=on({callback:i}),l=s.useCallback(d=>{const p=As(d);a==null||a.disconnect(),p&&(a==null||a.observe(p)),o(p?t(p):null)},[t,a]),[c,f]=Yt(l);return s.useMemo(()=>({nodeRef:c,rect:n,setRef:f}),[n,c,f])}const Bs=[{sensor:An,options:{}},{sensor:Dn,options:{}}],Fs={current:{}},Xt={draggable:{measure:Xn},droppable:{measure:Xn,strategy:zt.WhileDragging,frequency:vn.Optimized},dragOverlay:{measure:Mt}};class Ot extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,o;return(n=(o=this.get(t))==null?void 0:o.node.current)!=null?n:void 0}}const Ls={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Ot,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Kt},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Xt,measureDroppableContainers:Kt,windowRect:null,measuringScheduled:!1},zs={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Kt,draggableNodes:new Map,over:null,measureDroppableContainers:Kt},sn=s.createContext(zs),Pr=s.createContext(Ls);function Ns(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Ot}}}function Ps(e,t){switch(t.type){case ye.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case ye.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case ye.DragEnd:case ye.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case ye.RegisterDroppable:{const{element:n}=t,{id:o}=n,i=new Ot(e.droppable.containers);return i.set(o,n),{...e,droppable:{...e.droppable,containers:i}}}case ye.SetDroppableDisabled:{const{id:n,key:o,disabled:i}=t,a=e.droppable.containers.get(n);if(!a||o!==a.key)return e;const l=new Ot(e.droppable.containers);return l.set(n,{...a,disabled:i}),{...e,droppable:{...e.droppable,containers:l}}}case ye.UnregisterDroppable:{const{id:n,key:o}=t,i=e.droppable.containers.get(n);if(!i||o!==i.key)return e;const a=new Ot(e.droppable.containers);return a.delete(n),{...e,droppable:{...e.droppable,containers:a}}}default:return e}}function _s(e){let{disabled:t}=e;const{active:n,activatorEvent:o,draggableNodes:i}=s.useContext(sn),a=bn(o),l=bn(n==null?void 0:n.id);return s.useEffect(()=>{if(!t&&!o&&a&&l!=null){if(!Mn(a)||document.activeElement===a.target)return;const c=i.get(l);if(!c)return;const{activatorNode:f,node:d}=c;if(!f.current&&!d.current)return;requestAnimationFrame(()=>{for(const p of[f.current,d.current]){if(!p)continue;const g=Oo(p);if(g){g.focus();break}}})}},[o,t,i,l,a]),null}function $s(e,t){let{transform:n,...o}=t;return e!=null&&e.length?e.reduce((i,a)=>a({transform:i,...o}),n):n}function Hs(e){return s.useMemo(()=>({draggable:{...Xt.draggable,...e==null?void 0:e.draggable},droppable:{...Xt.droppable,...e==null?void 0:e.droppable},dragOverlay:{...Xt.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function Us(e){let{activeNode:t,measure:n,initialRect:o,config:i=!0}=e;const a=s.useRef(!1),{x:l,y:c}=typeof i=="boolean"?{x:i,y:i}:i;nt(()=>{if(!l&&!c||!t){a.current=!1;return}if(a.current||!o)return;const d=t==null?void 0:t.node.current;if(!d||d.isConnected===!1)return;const p=n(d),g=Rr(p,o);if(l||(g.x=0),c||(g.y=0),a.current=!0,Math.abs(g.x)>0||Math.abs(g.y)>0){const h=Dr(d);h&&h.scrollBy({top:g.y,left:g.x})}},[t,l,c,o,n])}const _r=s.createContext({...Je,scaleX:1,scaleY:1});var ft;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(ft||(ft={}));const nr=s.memo(function(t){var n,o,i,a;let{id:l,accessibility:c,autoScroll:f=!0,children:d,sensors:p=Bs,collisionDetection:g=Xo,measuring:h,modifiers:v,...E}=t;const C=s.useReducer(Ps,void 0,Ns),[D,I]=C,[k,M]=Po(),[T,z]=s.useState(ft.Uninitialized),O=T===ft.Initialized,{draggable:{active:B,nodes:A,translate:Z},droppable:{containers:V}}=D,F=B!=null?A.get(B):null,P=s.useRef({initial:null,translated:null}),ee=s.useMemo(()=>{var b;return B!=null?{id:B,data:(b=F==null?void 0:F.data)!=null?b:Fs,rect:P}:null},[B,F]),ne=s.useRef(null),[pe,le]=s.useState(null),[de,Ye]=s.useState(null),ce=Ft(E,Object.values(E)),$=_t("DndDescribedBy",l),se=s.useMemo(()=>V.getEnabled(),[V]),ie=Hs(h),{droppableRects:he,measureDroppableContainers:Q,measuringScheduled:ue}=Ss(se,{dragging:O,dependencies:[Z.x,Z.y],config:ie.droppable}),ae=vs(A,B),De=s.useMemo(()=>de?xn(de):null,[de]),Ee=x(),Me=Cs(ae,ie.draggable.measure);Us({activeNode:B!=null?A.get(B):null,config:Ee.layoutShiftCompensation,initialRect:Me,measure:ie.draggable.measure});const q=Jn(ae,ie.draggable.measure,Me),Ue=Jn(ae?ae.parentElement:null),we=s.useRef({activatorEvent:null,active:null,activeNode:ae,collisionRect:null,collisions:null,droppableRects:he,draggableNodes:A,draggingNode:null,draggingNodeRect:null,droppableContainers:V,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Ne=V.getNodeFor((n=we.current.over)==null?void 0:n.id),je=Os({measure:ie.dragOverlay.measure}),Pe=(o=je.nodeRef.current)!=null?o:ae,fe=O?(i=je.rect)!=null?i:q:null,Ze=!!(je.nodeRef.current&&je.rect),gt=Is(Ze?null:q),pt=Nr(Pe?ze(Pe):null),_e=Es(O?Ne??ae:null),Ae=Ts(_e),it=$s(v,{transform:{x:Z.x-gt.x,y:Z.y-gt.y,scaleX:1,scaleY:1},activatorEvent:de,active:ee,activeNodeRect:q,containerNodeRect:Ue,draggingNodeRect:fe,over:we.current.over,overlayNodeRect:je.rect,scrollableAncestors:_e,scrollableAncestorRects:Ae,windowRect:pt}),Oe=De?jt(De,Z):null,be=Ms(_e),ge=er(be),rt=er(be,[q]),Be=jt(it,ge),We=fe?Ko(fe,it):null,$e=ee&&We?g({active:ee,collisionRect:We,droppableRects:he,droppableContainers:se,pointerCoordinates:Oe}):null,Ke=Mr($e,"id"),[Re,bt]=s.useState(null),Rt=Ze?it:jt(it,rt),xt=qo(Rt,(a=Re==null?void 0:Re.rect)!=null?a:null,q),at=s.useRef(null),lt=s.useCallback((b,m)=>{let{sensor:j,options:L}=m;if(ne.current==null)return;const N=A.get(ne.current);if(!N)return;const S=b.nativeEvent,re=new j({active:ne.current,activeNode:N,event:S,options:L,context:we,onAbort(te){if(!A.get(te))return;const{onDragAbort:Y}=ce.current,Fe={id:te};Y==null||Y(Fe),k({type:"onDragAbort",event:Fe})},onPending(te,H,Y,Fe){if(!A.get(te))return;const{onDragPending:Ve}=ce.current,ke={id:te,constraint:H,initialCoordinates:Y,offset:Fe};Ve==null||Ve(ke),k({type:"onDragPending",event:ke})},onStart(te){const H=ne.current;if(H==null)return;const Y=A.get(H);if(!Y)return;const{onDragStart:Fe}=ce.current,Qe={activatorEvent:S,active:{id:H,data:Y.data,rect:P}};yt.unstable_batchedUpdates(()=>{Fe==null||Fe(Qe),z(ft.Initializing),I({type:ye.DragStart,initialCoordinates:te,active:H}),k({type:"onDragStart",event:Qe}),le(at.current),Ye(S)})},onMove(te){I({type:ye.DragMove,coordinates:te})},onEnd:oe(ye.DragEnd),onCancel:oe(ye.DragCancel)});at.current=re;function oe(te){return async function(){const{active:Y,collisions:Fe,over:Qe,scrollAdjustedTranslate:Ve}=we.current;let ke=null;if(Y&&Ve){const{cancelDrop:y}=ce.current;ke={activatorEvent:S,active:Y,collisions:Fe,delta:Ve,over:Qe},te===ye.DragEnd&&typeof y=="function"&&await Promise.resolve(y(ke))&&(te=ye.DragCancel)}ne.current=null,yt.unstable_batchedUpdates(()=>{I({type:te}),z(ft.Uninitialized),bt(null),le(null),Ye(null),at.current=null;const y=te===ye.DragEnd?"onDragEnd":"onDragCancel";if(ke){const R=ce.current[y];R==null||R(ke),k({type:y,event:ke})}})}}},[A]),ct=s.useCallback((b,m)=>(j,L)=>{const N=j.nativeEvent,S=A.get(L);if(ne.current!==null||!S||N.dndKit||N.defaultPrevented)return;const re={active:S};b(j,m.options,re)===!0&&(N.dndKit={capturedBy:m.sensor},ne.current=L,lt(j,m))},[A,lt]),mt=ws(p,ct);Rs(p),nt(()=>{q&&T===ft.Initializing&&z(ft.Initialized)},[q,T]),s.useEffect(()=>{const{onDragMove:b}=ce.current,{active:m,activatorEvent:j,collisions:L,over:N}=we.current;if(!m||!j)return;const S={active:m,activatorEvent:j,collisions:L,delta:{x:Be.x,y:Be.y},over:N};yt.unstable_batchedUpdates(()=>{b==null||b(S),k({type:"onDragMove",event:S})})},[Be.x,Be.y]),s.useEffect(()=>{const{active:b,activatorEvent:m,collisions:j,droppableContainers:L,scrollAdjustedTranslate:N}=we.current;if(!b||ne.current==null||!m||!N)return;const{onDragOver:S}=ce.current,re=L.get(Ke),oe=re&&re.rect.current?{id:re.id,rect:re.rect.current,data:re.data,disabled:re.disabled}:null,te={active:b,activatorEvent:m,collisions:j,delta:{x:N.x,y:N.y},over:oe};yt.unstable_batchedUpdates(()=>{bt(oe),S==null||S(te),k({type:"onDragOver",event:te})})},[Ke]),nt(()=>{we.current={activatorEvent:de,active:ee,activeNode:ae,collisionRect:We,collisions:$e,droppableRects:he,draggableNodes:A,draggingNode:Pe,draggingNodeRect:fe,droppableContainers:V,over:Re,scrollableAncestors:_e,scrollAdjustedTranslate:Be},P.current={initial:fe,translated:We}},[ee,ae,$e,We,A,Pe,fe,he,V,Re,_e,Be]),xs({...Ee,delta:Z,draggingRect:We,pointerCoordinates:Oe,scrollableAncestors:_e,scrollableAncestorRects:Ae});const Dt=s.useMemo(()=>({active:ee,activeNode:ae,activeNodeRect:q,activatorEvent:de,collisions:$e,containerNodeRect:Ue,dragOverlay:je,draggableNodes:A,droppableContainers:V,droppableRects:he,over:Re,measureDroppableContainers:Q,scrollableAncestors:_e,scrollableAncestorRects:Ae,measuringConfiguration:ie,measuringScheduled:ue,windowRect:pt}),[ee,ae,q,de,$e,Ue,je,A,V,he,Re,Q,_e,Ae,ie,ue,pt]),u=s.useMemo(()=>({activatorEvent:de,activators:mt,active:ee,activeNodeRect:q,ariaDescribedById:{draggable:$},dispatch:I,draggableNodes:A,over:Re,measureDroppableContainers:Q}),[de,mt,ee,q,I,$,A,Re,Q]);return Ce.createElement(kr.Provider,{value:M},Ce.createElement(sn.Provider,{value:u},Ce.createElement(Pr.Provider,{value:Dt},Ce.createElement(_r.Provider,{value:xt},d)),Ce.createElement(_s,{disabled:(c==null?void 0:c.restoreFocus)===!1})),Ce.createElement(Ho,{...c,hiddenTextDescribedById:$}));function x(){const b=(pe==null?void 0:pe.autoScrollEnabled)===!1,m=typeof f=="object"?f.enabled===!1:f===!1,j=O&&!b&&!m;return typeof f=="object"?{...f,enabled:j}:{enabled:j}}}),Ws=s.createContext(null),rr="button",Vs="Draggable";function Gs(e){let{id:t,data:n,disabled:o=!1,attributes:i}=e;const a=_t(Vs),{activators:l,activatorEvent:c,active:f,activeNodeRect:d,ariaDescribedById:p,draggableNodes:g,over:h}=s.useContext(sn),{role:v=rr,roleDescription:E="draggable",tabIndex:C=0}=i??{},D=(f==null?void 0:f.id)===t,I=s.useContext(D?_r:Ws),[k,M]=Yt(),[T,z]=Yt(),O=Ds(l,t),B=Ft(n);nt(()=>(g.set(t,{id:t,key:a,node:k,activatorNode:T,data:B}),()=>{const Z=g.get(t);Z&&Z.key===a&&g.delete(t)}),[g,t]);const A=s.useMemo(()=>({role:v,tabIndex:C,"aria-disabled":o,"aria-pressed":D&&v===rr?!0:void 0,"aria-roledescription":E,"aria-describedby":p.draggable}),[o,v,C,D,E,p.draggable]);return{active:f,activatorEvent:c,activeNodeRect:d,attributes:A,isDragging:D,listeners:o?void 0:O,node:k,over:h,setNodeRef:M,setActivatorNodeRef:z,transform:I}}function Xs(){return s.useContext(Pr)}const qs="Droppable",Ys={timeout:25};function Ks(e){let{data:t,disabled:n=!1,id:o,resizeObserverConfig:i}=e;const a=_t(qs),{active:l,dispatch:c,over:f,measureDroppableContainers:d}=s.useContext(sn),p=s.useRef({disabled:n}),g=s.useRef(!1),h=s.useRef(null),v=s.useRef(null),{disabled:E,updateMeasurementsFor:C,timeout:D}={...Ys,...i},I=Ft(C??o),k=s.useCallback(()=>{if(!g.current){g.current=!0;return}v.current!=null&&clearTimeout(v.current),v.current=setTimeout(()=>{d(Array.isArray(I.current)?I.current:[I.current]),v.current=null},D)},[D]),M=on({callback:k,disabled:E||!l}),T=s.useCallback((A,Z)=>{M&&(Z&&(M.unobserve(Z),g.current=!1),A&&M.observe(A))},[M]),[z,O]=Yt(T),B=Ft(t);return s.useEffect(()=>{!M||!z.current||(M.disconnect(),g.current=!1,M.observe(z.current))},[z,M]),s.useEffect(()=>(c({type:ye.RegisterDroppable,element:{id:o,key:a,disabled:n,node:z,rect:h,data:B}}),()=>c({type:ye.UnregisterDroppable,key:a,id:o})),[o]),s.useEffect(()=>{n!==p.current.disabled&&(c({type:ye.SetDroppableDisabled,id:o,key:a,disabled:n}),p.current.disabled=n)},[o,a,n,c]),{active:l,rect:h,isOver:(f==null?void 0:f.id)===o,node:z,over:f,setNodeRef:O}}function Jt(e,t,n){const o=e.slice();return o.splice(n<0?o.length+n:n,0,o.splice(t,1)[0]),o}function Qs(e,t){return e.reduce((n,o,i)=>{const a=t.get(o);return a&&(n[i]=a),n},Array(e.length))}function Ut(e){return e!==null&&e>=0}function Js(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Zs(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const $r=e=>{let{rects:t,activeIndex:n,overIndex:o,index:i}=e;const a=Jt(t,o,n),l=t[i],c=a[i];return!c||!l?null:{x:c.left-l.left,y:c.top-l.top,scaleX:c.width/l.width,scaleY:c.height/l.height}},Wt={scaleX:1,scaleY:1},or=e=>{var t;let{activeIndex:n,activeNodeRect:o,index:i,rects:a,overIndex:l}=e;const c=(t=a[n])!=null?t:o;if(!c)return null;if(i===n){const d=a[l];return d?{x:0,y:n<l?d.top+d.height-(c.top+c.height):d.top-c.top,...Wt}:null}const f=ei(a,i,n);return i>n&&i<=l?{x:0,y:-c.height-f,...Wt}:i<n&&i>=l?{x:0,y:c.height+f,...Wt}:{x:0,y:0,...Wt}};function ei(e,t,n){const o=e[t],i=e[t-1],a=e[t+1];return o?n<t?i?o.top-(i.top+i.height):a?a.top-(o.top+o.height):0:a?a.top-(o.top+o.height):i?o.top-(i.top+i.height):0:0}const Hr="Sortable",Ur=Ce.createContext({activeIndex:-1,containerId:Hr,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:$r,disabled:{draggable:!1,droppable:!1}});function sr(e){let{children:t,id:n,items:o,strategy:i=$r,disabled:a=!1}=e;const{active:l,dragOverlay:c,droppableRects:f,over:d,measureDroppableContainers:p}=Xs(),g=_t(Hr,n),h=c.rect!==null,v=s.useMemo(()=>o.map(O=>typeof O=="object"&&"id"in O?O.id:O),[o]),E=l!=null,C=l?v.indexOf(l.id):-1,D=d?v.indexOf(d.id):-1,I=s.useRef(v),k=!Js(v,I.current),M=D!==-1&&C===-1||k,T=Zs(a);nt(()=>{k&&E&&p(v)},[k,v,E,p]),s.useEffect(()=>{I.current=v},[v]);const z=s.useMemo(()=>({activeIndex:C,containerId:g,disabled:T,disableTransforms:M,items:v,overIndex:D,useDragOverlay:h,sortedRects:Qs(v,f),strategy:i}),[C,g,T.draggable,T.droppable,M,v,D,f,h,i]);return Ce.createElement(Ur.Provider,{value:z},t)}const ti=e=>{let{id:t,items:n,activeIndex:o,overIndex:i}=e;return Jt(n,o,i).indexOf(t)},ni=e=>{let{containerId:t,isSorting:n,wasDragging:o,index:i,items:a,newIndex:l,previousItems:c,previousContainerId:f,transition:d}=e;return!d||!o||c!==a&&i===l?!1:n?!0:l!==i&&t===f},ri={duration:200,easing:"ease"},Wr="transform",oi=kt.Transition.toString({property:Wr,duration:0,easing:"linear"}),si={roleDescription:"sortable"};function ii(e){let{disabled:t,index:n,node:o,rect:i}=e;const[a,l]=s.useState(null),c=s.useRef(n);return nt(()=>{if(!t&&n!==c.current&&o.current){const f=i.current;if(f){const d=Mt(o.current,{ignoreTransform:!0}),p={x:f.left-d.left,y:f.top-d.top,scaleX:f.width/d.width,scaleY:f.height/d.height};(p.x||p.y)&&l(p)}}n!==c.current&&(c.current=n)},[t,n,o,i]),s.useEffect(()=>{a&&l(null)},[a]),a}function Vr(e){let{animateLayoutChanges:t=ni,attributes:n,disabled:o,data:i,getNewIndex:a=ti,id:l,strategy:c,resizeObserverConfig:f,transition:d=ri}=e;const{items:p,containerId:g,activeIndex:h,disabled:v,disableTransforms:E,sortedRects:C,overIndex:D,useDragOverlay:I,strategy:k}=s.useContext(Ur),M=ai(o,v),T=p.indexOf(l),z=s.useMemo(()=>({sortable:{containerId:g,index:T,items:p},...i}),[g,i,T,p]),O=s.useMemo(()=>p.slice(p.indexOf(l)),[p,l]),{rect:B,node:A,isOver:Z,setNodeRef:V}=Ks({id:l,data:z,disabled:M.droppable,resizeObserverConfig:{updateMeasurementsFor:O,...f}}),{active:F,activatorEvent:P,activeNodeRect:ee,attributes:ne,setNodeRef:pe,listeners:le,isDragging:de,over:Ye,setActivatorNodeRef:ce,transform:$}=Gs({id:l,data:z,attributes:{...si,...n},disabled:M.draggable}),se=Ro(V,pe),ie=!!F,he=ie&&!E&&Ut(h)&&Ut(D),Q=!I&&de,ue=Q&&he?$:null,De=he?ue??(c??k)({rects:C,activeNodeRect:ee,activeIndex:h,overIndex:D,index:T}):null,Ee=Ut(h)&&Ut(D)?a({id:l,items:p,activeIndex:h,overIndex:D}):T,Me=F==null?void 0:F.id,q=s.useRef({activeId:Me,items:p,newIndex:Ee,containerId:g}),Ue=p!==q.current.items,we=t({active:F,containerId:g,isDragging:de,isSorting:ie,id:l,index:T,items:p,newIndex:q.current.newIndex,previousItems:q.current.items,previousContainerId:q.current.containerId,transition:d,wasDragging:q.current.activeId!=null}),Ne=ii({disabled:!we,index:T,node:A,rect:B});return s.useEffect(()=>{ie&&q.current.newIndex!==Ee&&(q.current.newIndex=Ee),g!==q.current.containerId&&(q.current.containerId=g),p!==q.current.items&&(q.current.items=p)},[ie,Ee,g,p]),s.useEffect(()=>{if(Me===q.current.activeId)return;if(Me!=null&&q.current.activeId==null){q.current.activeId=Me;return}const Pe=setTimeout(()=>{q.current.activeId=Me},50);return()=>clearTimeout(Pe)},[Me]),{active:F,activeIndex:h,attributes:ne,data:z,rect:B,index:T,newIndex:Ee,items:p,isOver:Z,isSorting:ie,isDragging:de,listeners:le,node:A,overIndex:D,over:Ye,setNodeRef:se,setActivatorNodeRef:ce,setDroppableNodeRef:V,setDraggableNodeRef:pe,transform:Ne??De,transition:je()};function je(){if(Ne||Ue&&q.current.newIndex===T)return oi;if(!(Q&&!Mn(P)||!d)&&(ie||we))return kt.Transition.toString({...d,property:Wr})}}function ai(e,t){var n,o;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e==null?void 0:e.draggable)!=null?n:t.draggable,droppable:(o=e==null?void 0:e.droppable)!=null?o:t.droppable}}function Zt(e){if(!e)return!1;const t=e.data.current;return!!(t&&"sortable"in t&&typeof t.sortable=="object"&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const li=[J.Down,J.Right,J.Up,J.Left],ci=(e,t)=>{let{context:{active:n,collisionRect:o,droppableRects:i,droppableContainers:a,over:l,scrollableAncestors:c}}=t;if(li.includes(e.code)){if(e.preventDefault(),!n||!o)return;const f=[];a.getEnabled().forEach(g=>{if(!g||g!=null&&g.disabled)return;const h=i.get(g.id);if(h)switch(e.code){case J.Down:o.top<h.top&&f.push(g);break;case J.Up:o.top>h.top&&f.push(g);break;case J.Left:o.left>h.left&&f.push(g);break;case J.Right:o.left<h.left&&f.push(g);break}});const d=Vo({collisionRect:o,droppableRects:i,droppableContainers:f});let p=Mr(d,"id");if(p===(l==null?void 0:l.id)&&d.length>1&&(p=d[1].id),p!=null){const g=a.get(n.id),h=a.get(p),v=h?i.get(h.id):null,E=h==null?void 0:h.node.current;if(E&&v&&g&&h){const D=rn(E).some((O,B)=>c[B]!==O),I=Gr(g,h),k=di(g,h),M=D||!I?{x:0,y:0}:{x:k?o.width-v.width:0,y:k?o.height-v.height:0},T={x:v.left,y:v.top};return M.x&&M.y?T:Lt(T,M)}}}};function Gr(e,t){return!Zt(e)||!Zt(t)?!1:e.data.current.sortable.containerId===t.data.current.sortable.containerId}function di(e,t){return!Zt(e)||!Zt(t)||!Gr(e,t)?!1:e.data.current.sortable.index<t.data.current.sortable.index}function ui(e,t,n){const o={...e};return t.top+e.y<=n.top?o.y=n.top-t.top:t.bottom+e.y>=n.top+n.height&&(o.y=n.top+n.height-t.bottom),t.left+e.x<=n.left?o.x=n.left-t.left:t.right+e.x>=n.left+n.width&&(o.x=n.left+n.width-t.right),o}const ir=e=>{let{containerNodeRect:t,draggingNodeRect:n,transform:o}=e;return!n||!t?o:ui(o,n,t)},ar=e=>{let{transform:t}=e;return{...t,x:0}},fi=qe("div")(({isDragging:e})=>({position:"relative",transition:"transform 0.2s ease, opacity 0.2s ease, background-color 0.2s ease",opacity:e?.8:1,cursor:e?"grabbing":"pointer",transform:e?"scale(1.02)":"none","&:hover":{opacity:e?.8:.95,cursor:"pointer"}})),gi=qe(w)(({theme:e})=>({padding:"16px",marginBottom:"0",background:"rgba(30,30,47,0.3)",borderRadius:"8px",borderTop:"1px solid rgba(255,255,255,0.05)",width:"100%","&:hover":{borderColor:"rgba(255,105,180,0.2)",background:"rgba(30,30,47,0.4)"},transition:"all 0.2s ease-in-out",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"})),pi=qe(w)(({theme:e})=>({display:"flex",alignItems:"center",marginBottom:"8px",padding:"8px 0",borderBottom:"1px solid rgba(255,255,255,0.1)",position:"relative","& .category-actions":{opacity:0,transition:"opacity 0.2s ease",pointerEvents:"none",position:"absolute",right:0,top:"50%",transform:"translateY(-50%)",display:"flex",alignItems:"center",marginLeft:0},"&:hover .category-actions":{opacity:1,pointerEvents:"auto"},"& .drag-handle":{opacity:0,transition:"opacity 0.2s ease",cursor:"grab","&:active":{cursor:"grabbing"}},"&:hover .drag-handle":{opacity:1}})),hi=qe(w)(({theme:e})=>({display:"flex",alignItems:"center",gap:"8px",flex:1,cursor:"pointer",minWidth:0})),bi=({category:e,children:t,onAddChannel:n,onSettings:o,userPermissions:i,isOwner:a})=>{const l=a||ht(i,"MANAGE_CATEGORIES"),c=a||ht(i,"MANAGE_CHANNELS"),{attributes:f,listeners:d,setNodeRef:p,transform:g,transition:h,isDragging:v}=Vr({id:typeof e.id=="string"?parseInt(e.id):e.id,disabled:!l}),E=D=>{D.stopPropagation(),l&&o(e)},C=D=>{D.stopPropagation(),c&&n(e.id)};return r.jsx(fi,{ref:p,style:{transform:kt.Transform.toString(g),transition:h||"transform 0.2s ease",display:"flex",alignItems:"center"},isDragging:v,...l?{...f,...d}:{},children:r.jsxs(gi,{sx:{background:v?"rgba(30,30,47,0.95)":"rgba(30,30,47,0.3)",boxShadow:v?"0 8px 24px rgba(0,0,0,0.2), 0 0 12px rgba(255,105,180,0.1)":"0 2px 8px rgba(0,0,0,0.1)",mb:e.channels&&e.channels.length>0?2:.5,"&:hover":{background:"rgba(30,30,47,0.5)",borderColor:v?"rgba(255,105,180,0.4)":"rgba(255,105,180,0.2)"},transition:"all 0.2s ease-in-out",flex:1,minWidth:0},children:[r.jsx(pi,{children:r.jsxs(hi,{children:[r.jsx(Gt,{title:e.name,enterDelay:600,arrow:!0,children:r.jsx(X,{variant:"subtitle2",sx:{color:v?"rgba(255,105,180,0.9)":"rgba(255,255,255,0.7)",letterSpacing:1,fontWeight:700,transition:"all 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"calc(100% - 60px)",flex:1,minWidth:0},children:e.name})}),r.jsxs(w,{className:"category-actions",children:[l&&r.jsx(xe,{size:"small",sx:{color:"#B0B0B0","&:hover":{color:"#FF69B4"},p:"4px"},onClick:E,children:r.jsx(jn,{fontSize:"small",sx:{fontSize:20}})}),c&&r.jsx(xe,{size:"small",sx:{ml:.5,color:v?"rgba(255,105,180,0.9)":"#1976D2","&:hover":{background:v?"rgba(255,105,180,0.1)":"rgba(25,118,210,0.1)"},transition:"all 0.2s ease",p:"4px"},onClick:C,children:r.jsx(wn,{fontSize:"small"})})]})]})}),t]})})},xi=({channel:e,children:t,userPermissions:n,isOwner:o})=>{const i=o||ht(n,"MANAGE_CHANNELS"),{attributes:a,listeners:l,setNodeRef:c,transform:f,transition:d,isDragging:p}=Vr({id:e.id,disabled:!i});return r.jsx("div",{ref:c,style:{transform:kt.Transform.toString(f),transition:d,opacity:p?.7:1,cursor:i?"grab":"default"},...i?{...a,...l}:{},children:t})},mi=Le(r.jsx("path",{d:"m21.58 16.09-1.09-7.66C20.21 6.46 18.52 5 16.53 5H7.47C5.48 5 3.79 6.46 3.51 8.43l-1.09 7.66C2.2 17.63 3.39 19 4.94 19c.68 0 1.32-.27 1.8-.75L9 16h6l2.25 2.25c.48.48 1.13.75 1.8.75 1.56 0 2.75-1.37 2.53-2.91M11 11H9v2H8v-2H6v-1h2V8h1v2h2zm4-1c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m2 3c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1"})),yi=Le(r.jsx("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-7 9h-2V5h2zm0 4h-2v-2h2z"})),vi=e=>r.jsx(tn,{...e}),wi=e=>r.jsx(tn,{...e}),Si=qe(xe)(({theme:e})=>({opacity:0,transition:"opacity 0.2s ease",pointerEvents:"none",color:"#B0B0B0","&:hover":{opacity:1,pointerEvents:"auto",color:"#FF69B4",background:"transparent"}})),Ci=e=>e.type===Ie.VOICE?Sr:e.name.includes("announcement")?yi:e.name.includes("game")?mi:wr,ji=({categories:e,activeChannel:t,setActiveChannel:n,openChannelSettings:o,sensors:i,handleDragEnd:a,handleChannelDragEnd:l,openCategorySettings:c,setActiveCategoryId:f,setCreateChannelOpen:d,userPermissions:p,isOwner:g,hubId:h})=>{const v=br(),E=I=>{n(I),v(`/hub/${h}/channel/${I.id}`)},C=g||ht(p,"MANAGE_CHANNELS"),D=(I,k)=>{I.stopPropagation(),C&&o(k)};return r.jsx(nr,{sensors:i,collisionDetection:Gn,onDragEnd:a,modifiers:[ar,ir],children:r.jsx(sr,{items:e.map(I=>typeof I.id=="string"?parseInt(I.id):I.id),strategy:or,children:e.map(I=>r.jsx(bi,{category:I,onAddChannel:k=>{f(typeof k=="string"?parseInt(k):k),d(!0)},onSettings:c,userPermissions:p,isOwner:g,children:r.jsx(nr,{sensors:i,collisionDetection:Gn,onDragEnd:k=>l(k,I),modifiers:[ar,ir],children:r.jsx(sr,{items:I.channels.map(k=>k.id),strategy:or,children:r.jsx(w,{sx:{mb:2},children:I.channels.sort((k,M)=>(k.position??0)-(M.position??0)).map(k=>{const M=k.type===Ie.VOICE?wi:vi,T=Ci(k);return r.jsx(xi,{channel:k,userPermissions:p,isOwner:g,children:r.jsxs(M,{alignItems:"center",onClick:()=>E(k),selected:(t==null?void 0:t.id)===k.id,sx:{cursor:"pointer","&:hover .settings-button":{opacity:1,pointerEvents:"auto"}},children:[r.jsx("span",{style:{display:"flex",alignItems:"center",minWidth:40},children:r.jsx(T,{className:"channel-icon",style:{color:"rgba(255,255,255,0.5)",fontSize:"1.2rem"}})}),r.jsx(X,{sx:{color:(t==null?void 0:t.id)===k.id?"#fff":"rgba(255,255,255,0.7)",fontWeight:(t==null?void 0:t.id)===k.id?600:400,flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:k.name}),C&&r.jsx(Si,{className:"settings-button",size:"small",onClick:z=>D(z,k),children:r.jsx(jn,{fontSize:"small"})})]})},k.id)})})})})},I.id))})})},ki=Le(r.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M8.5 8c.83 0 1.5.67 1.5 1.5S9.33 11 8.5 11 7 10.33 7 9.5 7.67 8 8.5 8M12 18c-2.28 0-4.22-1.66-5-4h10c-.78 2.34-2.72 4-5 4m3.5-7c-.83 0-1.5-.67-1.5-1.5S14.67 8 15.5 8s1.5.67 1.5 1.5-.67 1.5-1.5 1.5"})),Ii=Le(r.jsx("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6z"})),lr=Le(r.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"})),Ei=Le(r.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"})),Mi=Le(r.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"})),Ri=Le(r.jsx("path",{d:"m18 7-1.41-1.41-6.34 6.34 1.41 1.41zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12zM.41 13.41 6 19l1.41-1.41L1.83 12z"})),cr=Le(r.jsx("path",{d:"M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11"})),dr=Le(r.jsx("path",{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6z"})),Di=({profile:e,hubId:t,presence:n})=>{const o=n||e.user.presence,i=a=>new Date(a).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"});return r.jsxs(w,{sx:{display:"flex",alignItems:"center",mb:2},children:[r.jsxs(w,{sx:{position:"relative"},children:[r.jsx(Bt,{src:e.user.avatar||void 0,alt:e.user.login,userId:e.user.id,hubId:t,sx:{width:40,height:40},onClick:a=>a.stopPropagation()}),o&&r.jsx(w,{sx:{position:"absolute",bottom:-2,right:-2,width:16,height:16,bgcolor:o==="ONLINE"?"#4CAF50":"#6B5B95",border:"3px solid rgba(30,30,47,1)",borderRadius:"50%"}})]}),r.jsxs(w,{sx:{ml:2},children:[r.jsx(X,{sx:{color:"#fff",fontWeight:700,fontSize:"1rem",letterSpacing:.2},children:e.user.login}),r.jsx(X,{sx:{color:"rgba(255,255,255,0.7)",fontSize:"0.75rem",fontWeight:400},children:i(e.hub_member.joined_at)})]})]})},Ti=Le(r.jsx("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"})),Ai=({roles:e,hubId:t,memberId:n,onShowAllRoles:o,allRolesButtonRef:i,onAddClick:a,addButtonRef:l,username:c})=>{const{notify:f}=en(),[d]=vr({fixedCacheKey:"removeRole"}),[p,g]=s.useState(e),[h,v]=s.useState(new Map),[E,C]=s.useState(new Set);s.useEffect(()=>{g(e)},[e]);const D=async(M,T)=>{M.preventDefault(),M.stopPropagation();const z=p.find(O=>O.id===T);if(z){C(O=>new Set(O).add(T)),setTimeout(()=>{g(O=>O.filter(B=>B.id!==T)),v(O=>new Map(O).set(T,z)),C(O=>{const B=new Set(O);return B.delete(T),B})},200);try{await d({hubId:t,memberId:n,roleId:T}).unwrap(),v(O=>{const B=new Map(O);return B.delete(T),B}),f(`Роль "${z.name}" удалена у пользователя "${c}"`,"success")}catch{g(B=>[...B,z]),v(B=>{const A=new Map(B);return A.delete(T),A})}}},I=p.slice(0,3),k=p.slice(3);return r.jsxs(w,{sx:{mt:2},children:[r.jsx(w,{sx:{display:"flex",flexWrap:"wrap",gap:.5,borderTop:"1px solid rgba(255,255,255,0.1)",pt:1},children:I.map(M=>r.jsx(uo,{in:!E.has(M.id),timeout:200,sx:{"& .MuiCollapse-wrapper":{display:"inline-block"}},children:r.jsx(Ct,{in:!E.has(M.id),timeout:200,children:r.jsxs(w,{sx:{display:"flex",alignItems:"center",backgroundColor:"rgba(255,255,255,0.1)",borderRadius:"16px",padding:"2px 8px",height:"24px",position:"relative",marginBottom:"4px","&:hover":{backgroundColor:"rgba(255,255,255,0.15)","& .delete-icon":{opacity:1,transform:"translate(0, 0)"}}},children:[r.jsx(w,{sx:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:M.color,marginRight:"6px",flexShrink:0}}),r.jsx(w,{sx:{color:"#fff",fontSize:"0.75rem",fontWeight:500,paddingRight:"4px"},children:M.name}),r.jsx(xe,{size:"small",onClick:T=>D(T,M.id),className:"delete-icon",sx:{position:"absolute",top:"-6px",right:"-6px",padding:"2px",color:"rgba(255,255,255,0.7)",opacity:0,transform:"translate(4px, -4px)",transition:"all 0.2s ease",backgroundColor:"rgba(30,30,47,0.95)",border:"1px solid rgba(255,255,255,0.1)",width:"16px",height:"16px","&:hover":{color:"#fff",backgroundColor:"rgba(255,105,180,0.2)",borderColor:"rgba(255,105,180,0.3)"}},children:r.jsx(qt,{sx:{fontSize:"0.75rem"}})})]})})},M.id))}),r.jsxs(w,{sx:{display:"flex",gap:.5,mt:1,pt:1,borderTop:"1px solid rgba(255,255,255,0.1)"},children:[a&&l&&r.jsx(xe,{ref:l,size:"small",onClick:a,sx:{color:"rgba(255,255,255,0.7)",backgroundColor:"rgba(255,255,255,0.1)",borderRadius:"16px",padding:"2px 8px",height:"24px","&:hover":{backgroundColor:"rgba(255,255,255,0.15)",color:"#fff"}},children:r.jsx(wn,{sx:{fontSize:"1rem"}})}),k.length>0&&r.jsx(xe,{ref:i,size:"small",onClick:o,sx:{color:"rgba(255,255,255,0.7)",backgroundColor:"rgba(255,255,255,0.1)",borderRadius:"16px",padding:"2px 8px",height:"24px","&:hover":{backgroundColor:"rgba(255,255,255,0.15)",color:"#fff"}},children:r.jsx(Ti,{sx:{fontSize:"1rem"}})})]})]})},Oi=({userId:e,hubId:t,anchorPoint:n,onClose:o,className:i,onAddClick:a,addButtonRef:l,isRolesPanelOpen:c,onShowAllRoles:f,allRolesButtonRef:d,isAllRolesPanelOpen:p})=>{var k;const g=s.useRef(null),[h,v]=s.useState(!1),{data:E,isLoading:C,isError:D}=Sn({userId:e,hubId:t});s.useEffect(()=>{v(!0)},[]),s.useEffect(()=>{const M=T=>{var Z,V,F;const z=T.target,O=(Z=g.current)==null?void 0:Z.contains(z),B=(V=l==null?void 0:l.current)==null?void 0:V.contains(z),A=(F=d==null?void 0:d.current)==null?void 0:F.contains(z);O||B||A||(c||p)&&O||(v(!1),setTimeout(o,300))};return document.addEventListener("mousedown",M),()=>{document.removeEventListener("mousedown",M)}},[o,l,d,c,p]);const I={p:2,position:"fixed",left:h?"0":"-300px",top:"50%",transform:"translateY(-50%)",transition:"all 0.3s ease-in-out",zIndex:9999,maxWidth:"250px",width:"100%",borderRadius:"0 8px 8px 0",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",backgroundColor:"rgba(30,30,47,1)",borderLeft:"none",border:"1px solid rgba(255,255,255,0.1)",borderRight:"1px solid rgba(255,255,255,0.1)",borderTop:"1px solid rgba(255,255,255,0.1)",borderBottom:"1px solid rgba(255,255,255,0.1)",opacity:h?1:0};return C?r.jsxs(ot,{ref:g,className:i,sx:I,children:[r.jsx(ve,{variant:"rectangular",width:"100%",height:60}),r.jsx(ve,{variant:"rectangular",width:"100%",height:20,sx:{mt:2}})]}):D||!E?null:r.jsxs(ot,{ref:g,className:i,sx:I,children:[r.jsx(Di,{profile:E,hubId:t,presence:E.user.presence||((k=E.hub_member.user)==null?void 0:k.presence)}),r.jsx(Ai,{roles:E.hub_member.roles||[],hubId:t,memberId:E.hub_member.id,onShowAllRoles:f,allRolesButtonRef:d,onAddClick:a,addButtonRef:l,username:E.user.login})]})},Bi=({hubId:e,onClose:t,anchorEl:n,open:o,memberId:i,profile:a})=>{const[l,c]=s.useState(0),[f]=s.useState(30),[d,p]=s.useState(""),[g,h]=s.useState(""),v=s.useRef(null),E=s.useRef(null),[C,D]=s.useState([]),[I,k]=s.useState(!0),[M,T]=s.useState(!1),z=s.useRef(null),O=s.useRef(null),{notify:B}=en(),{data:A,isLoading:Z,isFetching:V,error:F,refetch:P}=fo({hubId:e,page:l,size:f,excludedMemberRolesById:i,s:d},{skip:!o}),[ee]=go(),{refetch:ne}=Sn({userId:a.user.id,hubId:e}),pe=s.useCallback(()=>{M||!I||A!=null&&A.last||(T(!0),c($=>$+1))},[M,I,A==null?void 0:A.last]);s.useEffect(()=>{const $=()=>{if(!v.current||M||!I||A!=null&&A.last)return;const{scrollTop:ie,scrollHeight:he,clientHeight:Q}=v.current;(ie+Q)/he*100>=60&&(z.current&&clearTimeout(z.current),z.current=setTimeout(()=>{pe()},300))},se=v.current;if(se)return se.addEventListener("scroll",$),()=>{se.removeEventListener("scroll",$),z.current&&clearTimeout(z.current)}},[M,I,A,pe]),s.useEffect(()=>{A&&(D($=>{if(d||l===0)return A.content;const se=A.content.filter(ie=>!$.some(he=>he.id===ie.id));return[...$,...se]}),k(!A.last),T(!1))},[A,l,d]),s.useEffect(()=>{const $=se=>{var ue;const ie=se.target,he=(ue=v.current)==null?void 0:ue.contains(ie),Q=n==null?void 0:n.contains(ie);he||Q||t()};return o&&document.addEventListener("mousedown",$,!0),()=>{document.removeEventListener("mousedown",$,!0)}},[o,n,t]),s.useEffect(()=>{o||(c(0),k(!0),T(!1),z.current&&clearTimeout(z.current))},[o]),s.useEffect(()=>{o&&(c(0),k(!0),T(!1))},[o,i]);const le=C,de=async $=>{try{await ee({hubId:e,memberId:i,roleId:$.id}).unwrap(),await ne(),B(`Роль "${$.name}" добавлена пользователю "${a.user.login}"`,"success")}catch{}},Ye=()=>I?r.jsx(w,{ref:E,sx:{height:"40px",display:"flex",justifyContent:"center",alignItems:"center",padding:"10px 0"},children:M&&r.jsx(mr,{size:20,thickness:4})}):null,ce=$=>{const se=$.target.value;h(se),O.current&&clearTimeout(O.current),O.current=setTimeout(()=>{p(se.trim()),c(0),k(!0),T(!1)},300)};return s.useEffect(()=>()=>{O.current&&clearTimeout(O.current)},[]),r.jsx(xr,{open:o,anchorEl:n,placement:"right-start",transition:!0,sx:{zIndex:9999,position:"fixed"},onMouseDown:$=>$.stopPropagation(),children:({TransitionProps:$})=>r.jsx(Ct,{...$,timeout:200,children:r.jsxs(ot,{ref:v,sx:{position:"absolute",left:"100%",top:0,width:"240px",maxHeight:"300px",overflowY:"auto",backgroundColor:"rgba(30,30,47,0.95)",border:"2px solid rgba(255,255,255,0.1)",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",zIndex:1e4,p:2,display:"flex",flexDirection:"column",gap:1},onClick:se=>se.stopPropagation(),children:[r.jsx(w,{sx:{display:"flex",alignItems:"center",gap:.5,mb:1},children:r.jsx(X,{sx:{color:"rgba(255,255,255,0.7)",fontSize:"0.75rem"},children:"Добавить роль пользователю"})}),r.jsx(vt,{size:"small",placeholder:"Поиск ролей...",value:g,onChange:ce,sx:{mb:1,"& .MuiOutlinedInput-root":{backgroundColor:"rgba(255,255,255,0.1)","& fieldset":{borderColor:"rgba(255,255,255,0.1)"},"&:hover fieldset":{borderColor:"rgba(255,255,255,0.2)"},"&.Mui-focused fieldset":{borderColor:"rgba(255,255,255,0.3)"}},"& .MuiInputBase-input":{color:"#fff",fontSize:"0.875rem","&::placeholder":{color:"rgba(255,255,255,0.5)",opacity:1}}}}),Z&&l===0?r.jsx(w,{sx:{display:"flex",flexDirection:"column",gap:1},children:[...Array(3)].map((se,ie)=>r.jsx(ve,{variant:"rectangular",width:"100%",height:32},ie))}):F?r.jsx(X,{sx:{color:"error.main",fontSize:"0.75rem",textAlign:"center"},children:"Ошибка загрузки ролей"}):le.length>0?r.jsxs(r.Fragment,{children:[le.map(se=>r.jsxs(w,{onClick:()=>de(se),sx:{display:"flex",alignItems:"center",backgroundColor:"rgba(255,255,255,0.1)",borderRadius:"16px",padding:"2px 8px",height:"24px",marginBottom:"2px",cursor:"pointer","&:hover":{backgroundColor:"rgba(255,255,255,0.15)"}},children:[r.jsx(w,{sx:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:se.color,marginRight:"6px",flexShrink:0}}),r.jsx(w,{sx:{color:"#fff",fontSize:"0.75rem",fontWeight:500},children:se.name})]},se.id)),Ye()]}):r.jsx(X,{sx:{color:"rgba(255,255,255,0.7)",fontSize:"0.75rem",textAlign:"center"},children:"Нет доступных ролей"})]})})})},Fi=({roles:e,hubId:t,memberId:n,onClose:o,anchorEl:i,open:a,username:l})=>{const{notify:c}=en(),[f,d]=s.useState(0),[p]=s.useState(30),g=s.useRef(null),h=s.useRef(null),[v,E]=s.useState(e),[C,D]=s.useState(!0),[I,k]=s.useState(!1),M=s.useRef(null),[T,z]=s.useState(""),[O]=vr({fixedCacheKey:"removeRole"}),B=s.useCallback(()=>{I||!C||(k(!0),d(F=>F+1))},[I,C]);s.useEffect(()=>{const F=()=>{if(!g.current||I||!C)return;const{scrollTop:ee,scrollHeight:ne,clientHeight:pe}=g.current;(ee+pe)/ne*100>=60&&(M.current&&clearTimeout(M.current),M.current=setTimeout(()=>{B()},300))},P=g.current;if(P)return P.addEventListener("scroll",F),()=>{P.removeEventListener("scroll",F),M.current&&clearTimeout(M.current)}},[I,C,B]),s.useEffect(()=>{e&&(E(F=>{if(f===0)return e;const P=e.filter(ee=>!F.some(ne=>ne.id===ee.id));return[...F,...P]}),D(e.length>=p),k(!1))},[e,f,p]),s.useEffect(()=>{const F=P=>{var le;const ee=P.target,ne=(le=g.current)==null?void 0:le.contains(ee),pe=i==null?void 0:i.contains(ee);ne||pe||o()};return a&&document.addEventListener("mousedown",F,!0),()=>{document.removeEventListener("mousedown",F,!0)}},[a,i,o]),s.useEffect(()=>{a||(d(0),E(e),D(!0),k(!1),M.current&&clearTimeout(M.current))},[a,e]);const A=async(F,P)=>{F.preventDefault(),F.stopPropagation();const ee=e.find(ne=>ne.id===P);if(ee)try{await O({hubId:t,memberId:n,roleId:P}).unwrap(),c(`Роль "${ee.name}" удалена у пользователя "${l}"`,"success")}catch{}},Z=()=>C?r.jsx(w,{ref:h,sx:{height:"40px",display:"flex",justifyContent:"center",alignItems:"center",padding:"10px 0"},children:I&&r.jsx(mr,{size:20,thickness:4})}):null,V=v.filter(F=>{const P=T.toLowerCase();return F.name.toLowerCase().includes(P)});return r.jsx(xr,{open:a,anchorEl:i,placement:"right-start",transition:!0,sx:{zIndex:9999,position:"fixed"},onMouseDown:F=>F.stopPropagation(),children:({TransitionProps:F})=>r.jsx(Ct,{...F,timeout:200,children:r.jsxs(ot,{ref:g,sx:{position:"absolute",left:"100%",top:0,width:"240px",maxHeight:"300px",overflowY:"auto",backgroundColor:"rgba(30,30,47,0.95)",border:"2px solid rgba(255,255,255,0.1)",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",zIndex:1e4,p:2,display:"flex",flexDirection:"column",gap:1},onClick:P=>P.stopPropagation(),children:[r.jsx(X,{sx:{color:"rgba(255,255,255,0.7)",fontSize:"0.75rem",mb:1},children:"Все роли пользователя"}),r.jsx(vt,{size:"small",placeholder:"Поиск ролей...",value:T,onChange:P=>z(P.target.value.trim()),sx:{mb:1,"& .MuiOutlinedInput-root":{backgroundColor:"rgba(255,255,255,0.1)","& fieldset":{borderColor:"rgba(255,255,255,0.1)"},"&:hover fieldset":{borderColor:"rgba(255,255,255,0.2)"},"&.Mui-focused fieldset":{borderColor:"rgba(255,255,255,0.3)"}},"& .MuiInputBase-input":{color:"#fff",fontSize:"0.875rem","&::placeholder":{color:"rgba(255,255,255,0.5)",opacity:1}}}}),V.length>0?r.jsxs(r.Fragment,{children:[V.map(P=>r.jsxs(w,{sx:{display:"flex",alignItems:"center",backgroundColor:"rgba(255,255,255,0.1)",borderRadius:"16px",padding:"2px 8px",height:"24px",position:"relative",marginBottom:"2px","&:hover":{backgroundColor:"rgba(255,255,255,0.15)","& .delete-icon":{opacity:1,transform:"translate(0, 0)"}}},children:[r.jsx(w,{sx:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:P.color,marginRight:"6px",flexShrink:0}}),r.jsx(w,{sx:{color:"#fff",fontSize:"0.75rem",fontWeight:500,paddingRight:"4px"},children:P.name}),r.jsx(xe,{size:"small",onClick:ee=>A(ee,P.id),className:"delete-icon",sx:{position:"absolute",top:"-6px",right:"-6px",padding:"2px",color:"rgba(255,255,255,0.7)",opacity:0,transform:"translate(4px, -4px)",transition:"all 0.2s ease",backgroundColor:"rgba(30,30,47,0.95)",border:"1px solid rgba(255,255,255,0.1)",width:"16px",height:"16px","&:hover":{color:"#fff",backgroundColor:"rgba(255,105,180,0.2)",borderColor:"rgba(255,105,180,0.3)"}},children:r.jsx(qt,{sx:{fontSize:"0.75rem"}})})]},P.id)),Z()]}):r.jsx(X,{sx:{color:"rgba(255,255,255,0.7)",fontSize:"0.75rem",textAlign:"center"},children:T?"Роли не найдены":"Нет ролей"})]})})})},Li=({userId:e,hubId:t,anchorPoint:n,onClose:o,className:i})=>{const[a,l]=s.useState(!1),[c,f]=s.useState(!1),d=s.useRef(null),p=s.useRef(null),{data:g}=Sn({userId:e,hubId:t}),h=E=>{E.preventDefault(),E.stopPropagation(),l(!a)},v=E=>{E.preventDefault(),E.stopPropagation(),f(!c)};return r.jsxs(r.Fragment,{children:[r.jsx(Oi,{userId:e,hubId:t,anchorPoint:n,onClose:o,className:i,onAddClick:E=>h(E),addButtonRef:d,isRolesPanelOpen:a,onShowAllRoles:v,allRolesButtonRef:p,isAllRolesPanelOpen:c}),g&&d.current&&r.jsx(Bi,{hubId:t,onClose:()=>l(!1),anchorEl:d.current,open:a,memberId:g.hub_member.id,profile:g}),g&&p.current&&r.jsx(Fi,{roles:g.hub_member.roles||[],hubId:t,memberId:g.hub_member.id,onClose:()=>f(!1),anchorEl:p.current,open:c,username:g.user.login})]})},zi=qe(Yr)(({theme:e})=>({width:40,height:40,position:"relative",background:"linear-gradient(135deg, #8e1450 0%, #1976D2 100%)",fontSize:"1.4rem",fontWeight:700,color:"#fff",transition:"all 0.3s",cursor:"pointer",lineHeight:"40px",textAlign:"center","&:hover":{borderColor:"transparent",transform:"scale(1.05)",cursor:"pointer"}})),Bt=e=>{const{src:t,alt:n,userId:o,hubId:i,disableClick:a,...l}=e,[c,f]=s.useState(null),d=g=>{if(!o||!i||a)return;const h=g.currentTarget.getBoundingClientRect();f({x:h.left+window.scrollX-300,y:h.top+window.scrollY})},p=()=>{f(null)};return r.jsxs(r.Fragment,{children:[r.jsx(zi,{src:t,alt:n,onClick:d,...l,sx:{...l.sx,"& .MuiAvatar-img":{objectFit:"cover"}},children:!t&&n&&n.length>0?r.jsx("span",{style:{lineHeight:1,display:"inline-block",verticalAlign:"middle",position:"relative",top:"3px"},children:n[0].toUpperCase()}):"?"}),o&&i&&c&&yt.createPortal(r.jsx(Li,{userId:o,hubId:i,anchorPoint:c,onClose:p}),document.body)]})},un=(e,t)=>{const n=s.useCallback(t,[t]);s.useEffect(()=>{if(!e)return;let o=!0;return o&&(async()=>{try{await Te.subscribe(e,n)}catch(a){console.error("Failed to setup WebSocket subscription:",a)}})(),()=>{o=!1,Te.unsubscribe(e,n)}},[e,n])},Ni=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}),ur=e=>{const t=new Date(e),n=new Date,o=new Date(n);if(o.setDate(o.getDate()-1),t.toDateString()===n.toDateString())return"Today";if(t.toDateString()===o.toDateString())return"Yesterday";const i=t.getFullYear()===n.getFullYear();return t.toLocaleDateString([],{weekday:"long",day:"numeric",month:"long",...i?{}:{year:"numeric"}})},Pi=(e,t,n=30)=>{const o=new Date(e),i=new Date(t);return Math.abs(o.getTime()-i.getTime())/(1e3*60)<=n},fr=pn().shape({content:hn().min(1,"Message cannot be empty").max(2e3,"Message is too long")}),_i=({activeChannel:e,user:t,hubId:n,userPermissions:o,isOwner:i})=>{const a=Cn(u=>u.auth.token);if(!t)return null;const[l]=s.useState(!1),[c,f]=s.useState([]),[d,p]=s.useState(null),[g,h]=s.useState(null),[v,E]=s.useState(null),[C,D]=s.useState(!1),[I,k]=s.useState(null),[M,T]=s.useState(!0),[z,O]=s.useState(!1),[B,A]=s.useState(new Map),[Z,V]=s.useState(new Set),[F,P]=s.useState(0),[ee,ne]=s.useState(!1),[pe,le]=s.useState(new Set),[de,Ye]=s.useState(null),[ce,$]=s.useState([]),[se,ie]=s.useState(!1),he=s.useRef(null),Q=s.useRef(null),ue=s.useRef(null),ae=s.useRef(!1),De=s.useRef(null),Ee=s.useRef(null),Me=s.useRef(0),[q,Ue]=s.useState(!0),we=s.useRef(null),Ne=s.useRef(new Set),je=s.useRef(new Set),Pe=40,{data:fe=[],isLoading:Ze}=ko((e==null?void 0:e.type)===Ie.TEXT?{channelId:(e==null?void 0:e.id)??0,params:{size:Pe,before:I||void 0}}:{channelId:0,params:{}},{skip:!e||e.type!==Ie.TEXT,refetchOnMountOrArgChange:!0}),[gt]=Io(),[pt]=Eo(),[_e]=Mo(),{notify:Ae}=en(),it=ht(o,"SEND_MESSAGES",i);s.useEffect(()=>()=>{if(e&&t&&t.id&&e.id){const u=`/v1/user/${t.id}/queue/channels/${e.id}/messages`,x=`/v1/topic/channels/${e.id}/messages`;Te.unsubscribe(u,()=>{}),Te.unsubscribe(x,()=>{})}},[e==null?void 0:e.id,t.id]);const Oe=s.useRef(!1),be=s.useRef(null),ge=s.useRef(null),rt=s.useCallback(u=>{!e||!t||(u?(Oe.current||(Te.publish(`/app/v1/channels/${e.id}/typing`,{typing_status:0}),Oe.current=!0,ge.current=setInterval(()=>{Te.publish(`/app/v1/channels/${e.id}/typing`,{typing_status:0})},4e3)),be.current&&clearTimeout(be.current),be.current=setTimeout(()=>{Te.publish(`/app/v1/channels/${e.id}/typing`,{typing_status:1}),Oe.current=!1,be.current=null,ge.current&&(clearInterval(ge.current),ge.current=null)},2e3)):(be.current&&(clearTimeout(be.current),be.current=null),ge.current&&(clearInterval(ge.current),ge.current=null),Oe.current&&(Te.publish(`/app/v1/channels/${e.id}/typing`,{typing_status:1}),Oe.current=!1)))},[e,t]),Be=s.useCallback(async u=>{console.log("Fetching typing users for channel:",u);try{if(!a){console.error("No JWT token found");return}const x=await fetch(`/api/v1/channels/${u}/typing-users`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(x.ok){const b=await x.json();console.log("Received typing users:",b);const m=b.filter(j=>j.id!==t.id);$(m)}else console.error("Failed to fetch typing users:",x.status,x.statusText)}catch(x){console.error("Failed to fetch typing users:",x)}},[t.id,a]);s.useEffect(()=>{let u=null;if(e)return console.log(`Entering channel ${e.id}`),f([]),T(!0),k(null),p(null),E(null),D(!1),O(!1),A(new Map),Ue(!0),ae.current=!1,$([]),be.current&&(clearTimeout(be.current),be.current=null),ge.current&&(clearInterval(ge.current),ge.current=null),Oe.current=!1,Te.publish(`/app/v1/channels/${e.id}/messages/bulk-read-all`,{}),Be(e.id),u=e.id,()=>{u&&(console.log(`Leaving channel ${u}`),Te.unsubscribeFromChannel(u),Oe.current&&(Te.publish(`/app/v1/channels/${u}/typing`,{typing_status:1}),Oe.current=!1),be.current&&(clearTimeout(be.current),be.current=null),ge.current&&(clearInterval(ge.current),ge.current=null),$([]))}},[e==null?void 0:e.id,Be]);const We=s.useCallback(()=>{if(Q.current){const u=Q.current;u.scrollTo({top:u.scrollHeight,behavior:"smooth"}),O(!1),setTimeout(()=>{Q.current&&(Q.current.scrollTop=Q.current.scrollHeight)},300)}},[]),$e=s.useCallback(()=>{const u=new Set;c.forEach(x=>{x.author.id!==t.id&&x.status===2&&u.add(x.id)}),u.size>0&&(le(x=>new Set([...x,...u])),setTimeout(()=>{le(x=>{const b=new Set(x);return u.forEach(m=>b.delete(m)),b})},1500)),We(),e&&(Te.publish(`/app/v1/channels/${e.id}/messages/bulk-read-all`,{}),f(x=>x.map(b=>b.author.id!==(t==null?void 0:t.id)?{...b,status:1}:b))),V(new Set),P(0),ne(!1)},[e,t==null?void 0:t.id,We,c]),Ke=s.useCallback(u=>({...u,status:"status"in u?u.status:0}),[]);s.useEffect(()=>{if(!(!e||e.type!==Ie.TEXT)){if(!fe||fe.length===0){f([]),V(new Set),P(0),ne(!1);return}if(I===null){const u=fe.map(Ke);f(u),Me.current=fe.length;const x=u.filter(m=>m.author.id!==(t==null?void 0:t.id)&&m.status===2);x.length>0?(V(new Set(x.map(m=>m.id))),P(x.length)):(V(new Set),P(0),ne(!1));const b=(m=0)=>{if(m>3){console.warn("Failed to scroll to bottom after 3 attempts");return}setTimeout(()=>{if(Q.current){const j=Q.current,L=j.scrollTop;j.scrollTop=j.scrollHeight,console.log("Scroll attempt",m+1,{scrollHeight:j.scrollHeight,clientHeight:j.clientHeight,scrollTop:j.scrollTop,scrollBefore:L,messagesCount:u.length}),j.scrollTop+j.clientHeight<j.scrollHeight-50&&b(m+1)}},50*(m+1))};b()}}},[e,fe,I,Ke,t==null?void 0:t.id]),s.useEffect(()=>{if(Q.current&&q){const u=Q.current;u.scrollHeight-u.scrollTop-u.clientHeight<100&&requestAnimationFrame(()=>{Q.current&&(Q.current.scrollTop=Q.current.scrollHeight)})}},[c.length,q]),s.useEffect(()=>{if(e&&De.current){De.current.focus();const u=De.current.value.length;De.current.setSelectionRange(u,u)}},[e]),s.useEffect(()=>{if(d&&Ee.current){Ee.current.focus();const u=Ee.current.value.length;Ee.current.setSelectionRange(u,u)}},[d]);const Re=s.useCallback(()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur(),requestAnimationFrame(()=>{De.current&&(De.current.focus(),De.current.setSelectionRange(0,0))})},[]),bt=s.useCallback(async(u,{resetForm:x})=>{if(!(!e||!t||!u.content.trim())){x(),rt(!1);try{const m=Date.now(),j={id:-1,content:u.content,author:t,created_at:new Date().toISOString(),last_modified_at:void 0,attachments:[],status:0,read_by_count:0,channel_id:e.id,reply_to:g||void 0};A(S=>{const re=new Map(S);return re.set(String(m),j),re}),setTimeout(()=>{We()},10),x(),h(null);const L=await gt({channelId:e.id,content:u.content,...g!=null&&g.id?{replyToId:g.id}:{}}).unwrap();A(S=>{const re=new Map(S);return re.delete(String(m)),re});const N={...L,status:0,channel_id:e.id,reply_to:g||void 0};f(S=>[...S,N])}catch(m){console.error("Failed to send message:",m),typeof m=="object"&&m!==null&&"status"in m&&m.status===403&&"data"in m&&typeof m.data=="object"&&m.data!==null&&"type"in m.data&&m.data.type==="ACCESS_DENIED"?Ae("Недостаточно прав для отправки сообщения","error"):(Ae("Ошибка при отправке сообщения","error"),console.error("Failed to send message:",m))}}},[e,t,gt,Re,Ae,rt,g]),Rt=s.useCallback(async(u,{resetForm:x})=>{if(!d||!e)return;const b=u.content.trim();if(!b)return;const m=c.find(L=>L.id===d);if(!m)return;if(b===m.content){p(null),x(),Re();return}const j={...m,content:b,last_modified_at:new Date().toISOString()};f(L=>L.map(N=>N.id===d?j:N)),p(null),x(),Re();try{const L=await pt({channelId:e.id,messageId:d,content:b}).unwrap();f(N=>N.map(S=>S.id===d?Ke(L):S))}catch(L){console.error("Failed to edit message:",L),f(N=>N.map(S=>S.id===d?m:S)),Ae("Ошибка при обновлении сообщения","error")}},[d,e,pt,Re,c,Ae]),xt=s.useCallback(async u=>{if(!e)return;const x=c.find(b=>b.id===u);if(x){f(b=>b.filter(m=>m.id!==u));try{await _e({channelId:e.id,messageId:u}).unwrap()}catch(b){console.error("Ошибка при удалении сообщения",b),f(m=>{if(!m.some(j=>j.id===u)){const j=[...m],L=j.findIndex(N=>new Date(N.created_at)>new Date(x.created_at));return L===-1?[...j,x]:(j.splice(L,0,x),j)}return m}),Ae("Ошибка при удалении сообщения","error")}}},[e,_e,c,Ae]);s.useEffect(()=>{const u=Q.current;if(!u)return;const x=()=>{if(ue.current&&clearTimeout(ue.current),O(u.scrollTop+u.clientHeight<u.scrollHeight-400),u.scrollTop<u.scrollHeight/2&&!ae.current&&M&&fe.length>0)if(fe.length===Pe){ae.current=!0;const L=fe[fe.length-1];L&&k(L.id)}else T(!1);const b=u.querySelectorAll(".message-item");if(!b.length)return;let m=null,j=null;b.forEach(L=>{const N=L.getBoundingClientRect(),S=u.getBoundingClientRect();if(N.top>=S.top&&N.bottom<=S.bottom){if(!j){j=L;const te=L.getAttribute("data-date");te&&(m=ur(te))}const oe=parseInt(L.getAttribute("data-msg-id")||"0",10);if(oe){const te=c.find(H=>H.id===oe);te&&te.author.id!==(t==null?void 0:t.id)&&te.status===2&&(le(H=>{const Y=new Set(H);return Y.add(oe),Y}),setTimeout(()=>{le(H=>{const Y=new Set(H);return Y.delete(oe),Y})},1500))}}}),m&&(E(m),D(!0),ue.current=setTimeout(()=>{D(!1)},1e3))};return u.addEventListener("scroll",x),()=>{u.removeEventListener("scroll",x),ue.current&&clearTimeout(ue.current)}},[fe,M,e==null?void 0:e.id]),s.useEffect(()=>{if(fe&&fe.length>0&&I!==null){const u=Q.current;if(!u)return;const x=u.querySelectorAll(".message-item");let b=null,m=0;for(const S of x){const re=S.getBoundingClientRect(),oe=u.getBoundingClientRect();if(re.bottom>oe.top&&re.top<oe.bottom){b=S,m=re.top-oe.top;break}}const j=b==null?void 0:b.getAttribute("data-msg-id");fe.length<Pe&&T(!1);const L=u.style.scrollBehavior;u.style.scrollBehavior="auto",new Promise(S=>{const re=new MutationObserver(()=>{re.disconnect(),S()});re.observe(u,{childList:!0,subtree:!0}),f(oe=>{const te=new Map(oe.map(H=>[H.id,H]));return fe.forEach(H=>{te.has(H.id)||te.set(H.id,{...H,status:"status"in H?H.status:H.author.id===(t==null?void 0:t.id)?0:2})}),Array.from(te.values()).sort((H,Y)=>new Date(H.created_at).getTime()-new Date(Y.created_at).getTime())})}).then(()=>{setTimeout(()=>{if(j){const S=u.querySelector(`[data-msg-id="${j}"]`);if(S){const re=S.getBoundingClientRect(),oe=u.getBoundingClientRect(),H=re.top-oe.top-m;u.style.overflow="hidden",u.scrollTop+=H,u.offsetHeight,u.style.overflow="auto"}}u.style.scrollBehavior=L,ae.current=!1},0)})}},[fe,I]);const at=s.useMemo(()=>[...c].sort((u,x)=>new Date(u.created_at).getTime()-new Date(x.created_at).getTime()),[c]);s.useEffect(()=>{const u=Q.current;if(!u)return;const x=()=>{const b=u.scrollHeight-u.scrollTop-u.clientHeight,m=b<100;Ue(m),console.log("Scroll position:",{isAtBottom:m,scrollPosition:b,scrollHeight:u.scrollHeight,scrollTop:u.scrollTop,clientHeight:u.clientHeight}),m&&e&&(Te.publish(`/app/v1/channels/${e.id}/messages/bulk-read-all`,{}),f(j=>j.map(L=>L.author.id!==(t==null?void 0:t.id)?{...L,status:1}:L)),V(new Set),P(0),ne(!1))};return u.addEventListener("scroll",x),()=>u.removeEventListener("scroll",x)},[]);const lt=s.useCallback(u=>{if(u.type==="MESSAGE_CREATE"&&u.message){const x=Ke(u.message);if(x.author.id===(t==null?void 0:t.id))return;if(f(b=>b.some(j=>j.id===x.id)?b:[...b,x]),le(b=>{const m=new Set(b);return m.add(x.id),m}),setTimeout(()=>{le(b=>{const m=new Set(b);return m.delete(x.id),m})},1500),x.author.id!==(t==null?void 0:t.id)){const b=Q.current;if(b){const m=b.scrollHeight-b.scrollTop-b.clientHeight,j=m<100;console.log("New message received:",{isAtBottom:j,scrollPosition:m,messageId:x.id,status:x.status}),j?(f(L=>L.map(N=>N.id===x.id?{...N,status:1}:N)),je.current.add(x.id),requestAnimationFrame(()=>{b&&(b.scrollTop=b.scrollHeight)})):(ne(!0),V(L=>{const N=new Set(L);return N.add(x.id),N}),P(L=>{const N=L+1;return setTimeout(()=>{const S=document.querySelector(`[data-msg-id="${x.id}"]`);if(S&&b){const re=S.getBoundingClientRect(),oe=b.getBoundingClientRect();re.top>=oe.top&&re.bottom<=oe.bottom&&(je.current.add(x.id),f(H=>H.map(Y=>Y.id===x.id?{...Y,status:1}:Y)),V(H=>{const Y=new Set(H);return Y.delete(x.id),Y}),P(H=>{const Y=Math.max(0,H-1);return Y===0&&ne(!1),Y}))}},100),N}))}}}else if(u.type==="MESSAGE_UPDATE"&&u.message){const x=Ke(u.message);f(b=>b.some(j=>j.id===x.id)?b.map(j=>j.id===x.id?x:j):b),x.status===1&&(V(b=>{const m=new Set(b);return m.delete(x.id),m}),P(b=>Math.max(0,b-1)))}else if(u.type==="MESSAGE_DELETE"&&u.messageId){const{messageId:x}=u;f(b=>b.some(j=>j.id===x)?b.filter(j=>j.id!==x):b),V(b=>{const m=new Set(b);return m.delete(x),m}),P(b=>Math.max(0,b-1))}else if(u.type==="MESSAGE_READ_STATUS"&&u.message_range){const{from:x,to:b}=u.message_range;f(m=>m.map(j=>{if(j.id>=x&&j.id<=b&&j.author.id===(t==null?void 0:t.id)){const L=j.read_by_count||0;return{...j,read_by_count:L+1}}return j})),console.log(`Обновлены счетчики прочтений для сообщений в диапазоне ${x}-${b}`)}},[q,t==null?void 0:t.id,e,Ke]),ct=s.useCallback(u=>{if(!u||!u.user||!u.user.id||!u.type||u.channelId!==(e==null?void 0:e.id))return;const x=u.user;x.id!==(t==null?void 0:t.id)&&(u.type==="TYPING_STARTED"?$(b=>b.findIndex(L=>L.id===x.id)!==-1?b:[...b,x]):u.type==="TYPING_STOPPED"&&$(b=>b.filter(m=>m.id!==x.id)))},[t==null?void 0:t.id,e==null?void 0:e.id]);un(e&&t?`/v1/user/${t==null?void 0:t.id}/queue/channels/${e.id}/messages`:null,lt),un(e?`/v1/topic/channels/${e.id}/messages`:null,lt),un(e?`/v1/topic/channels/${e.id}/typing`:null,ct),s.useEffect(()=>()=>{console.log("MainChatArea component unmounting"),we.current&&clearTimeout(we.current),ue.current&&clearTimeout(ue.current)},[]),s.useEffect(()=>{if(!e)return;const u=()=>{if(je.current.size>0){const b=Array.from(je.current);Te.publish(`/app/v1/channels/${e.id}/messages/bulk-read`,{message_ids:b}),je.current.clear()}},x=setInterval(u,1e3);return()=>{clearInterval(x),u()}},[e]),s.useEffect(()=>{if(!Q.current||!e)return;const u=new IntersectionObserver(b=>{b.forEach(m=>{const j=parseInt(m.target.getAttribute("data-msg-id")||"0",10);if(j)if(m.isIntersecting){Ne.current.add(j);const L=c.find(N=>N.id===j);L&&L.author.id!==(t==null?void 0:t.id)&&L.status===2&&(je.current.add(j),le(N=>{const S=new Set(N);return S.add(j),S}),setTimeout(()=>{le(N=>{const S=new Set(N);return S.delete(j),S})},1500),f(N=>N.map(S=>S.id===j?{...S,status:1}:S)),V(N=>{const S=new Set(N);return S.delete(j),S}),P(N=>Math.max(0,N-1))),F<=1&&ne(!1)}else Ne.current.delete(j)})},{root:Q.current,threshold:.5});return Q.current.querySelectorAll(".message-item").forEach(b=>u.observe(b)),()=>{u.disconnect(),we.current&&clearTimeout(we.current)}},[c,t==null?void 0:t.id,e]),s.useEffect(()=>{const u=Q.current;if(!u)return;const x=()=>{const b=u.scrollHeight-u.scrollTop-u.clientHeight<100;Ue(b)};return u.addEventListener("scroll",x),()=>u.removeEventListener("scroll",x)},[]),s.useEffect(()=>{q&&e&&(Te.publish(`/app/v1/channels/${e.id}/messages/bulk-read-all`,{}),f(u=>u.map(x=>x.author.id!==(t==null?void 0:t.id)?{...x,status:1}:x)),V(new Set),P(0),ne(!1))},[q,e,t==null?void 0:t.id]);const mt=()=>r.jsx(w,{sx:{flex:1,p:3,display:"flex",flexDirection:"column",gap:2},children:[...Array(5)].map((u,x)=>r.jsxs(w,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[r.jsx(ve,{variant:"circular",width:40,height:40,sx:{bgcolor:"rgba(255,255,255,0.1)"}}),r.jsxs(w,{sx:{flex:1},children:[r.jsx(ve,{variant:"text",width:120,height:24,sx:{bgcolor:"rgba(255,255,255,0.1)",mb:1}}),r.jsx(ve,{variant:"text",width:"80%",height:20,sx:{bgcolor:"rgba(255,255,255,0.1)"}}),r.jsx(ve,{variant:"text",width:"60%",height:20,sx:{bgcolor:"rgba(255,255,255,0.1)"}})]})]},x))}),Dt=()=>r.jsx(w,{ref:Q,className:"messages-container",sx:{flex:1,pt:3,px:3,pb:8,overflowY:"auto",display:"flex",flexDirection:"column",gap:1,position:"relative",contain:"layout","&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"rgba(255,255,255,0.05)",borderRadius:"4px"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.1)",borderRadius:"4px","&:hover":{background:"rgba(255,255,255,0.15)"}}},children:at.length===0&&B.size===0?r.jsxs(w,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"rgba(255,255,255,0.5)",textAlign:"center",gap:2},children:[r.jsx(X,{variant:"h6",children:"Нет сообщений"}),r.jsx(X,{variant:"body2",children:"Начните общение, отправив первое сообщение"})]}):r.jsxs(r.Fragment,{children:[r.jsx(Ct,{in:C,timeout:{enter:300,exit:500},children:r.jsx(w,{sx:{position:"sticky",top:0,zIndex:10,alignSelf:"center",backgroundColor:"rgba(30,30,47,0.85)",backdropFilter:"blur(8px)",borderRadius:"16px",px:2,py:.75,mb:1,boxShadow:"0 2px 8px rgba(0,0,0,0.2)",border:"1px solid rgba(255,255,255,0.1)",transition:"all 0.3s ease"},children:r.jsx(X,{sx:{color:"rgba(255,255,255,0.9)",fontWeight:600,fontSize:"0.9rem"},children:v})})}),(()=>{let u=[],x=null,b=null,m=[],j=null,L=new Set;return[...at,...Array.from(B.values())].forEach(S=>{const oe=new Date(S.created_at).toDateString();j!==oe&&!L.has(oe)&&(m.length>0&&(u.push(...m),m=[]),u.push(r.jsxs(w,{className:"date-separator","data-date":S.created_at,sx:{display:"flex",justifyContent:"center",alignItems:"center",my:2,position:"relative"},children:[r.jsx(w,{sx:{backgroundColor:"rgba(30,30,47,0.85)",backdropFilter:"blur(8px)",borderRadius:"16px",px:2,py:.75,boxShadow:"0 2px 8px rgba(0,0,0,0.2)",border:"1px solid rgba(255,255,255,0.1)",zIndex:2},children:r.jsx(X,{sx:{color:"rgba(255,255,255,0.9)",fontWeight:600,fontSize:"0.9rem"},children:ur(S.created_at)})}),r.jsx(w,{sx:{position:"absolute",height:"1px",width:"100%",backgroundColor:"rgba(255,255,255,0.08)",zIndex:1}})]},`date-${oe}`)),j=oe,L.add(oe));const H=x!==S.author.id||b&&!Pi(b,S.created_at),Y=S.id===-1,Fe=r.jsxs(w,{className:"message-item","data-date":S.created_at,"data-msg-id":S.id.toString(),sx:{display:"flex",gap:2,alignItems:"flex-start",position:"relative",borderRadius:"10px",transition:"background-color 0.3s ease",opacity:Y?.6:1,backgroundColor:de===S.id?"rgba(0, 207, 255, 0.25)":pe.has(S.id)?"rgba(255,105,180,0.2)":Z.has(S.id)?"rgba(25,118,210,0.1)":"transparent","&:hover":{backgroundColor:de===S.id?"rgba(0, 207, 255, 0.3)":pe.has(S.id)?"rgba(255,105,180,0.25)":Z.has(S.id)?"rgba(25,118,210,0.15)":"rgba(255,255,255,0.03)"},"&:hover .message-actions":{opacity:Y?0:1,pointerEvents:Y?"none":"auto"}},children:[r.jsx(w,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",width:40,ml:1,mt:1},children:H?r.jsx("div",{style:{cursor:"pointer"},children:r.jsx(Bt,{src:S.author.avatar||void 0,alt:S.author.login,userId:S.author.id,hubId:n})}):null}),r.jsxs(w,{sx:{flex:1,position:"relative"},children:[r.jsx(w,{sx:{maxWidth:"100%"},children:r.jsxs(w,{sx:{py:"5px",px:"0px",pl:0},children:[H&&r.jsx(X,{sx:{color:"#00CFFF",fontWeight:700,mb:.5,fontSize:"1rem",letterSpacing:.2},children:S.author.login}),d===S.id?r.jsx(wt,{initialValues:{content:S.content},validationSchema:fr,onSubmit:Rt,children:({handleSubmit:Qe,values:Ve})=>r.jsx(St,{children:r.jsxs(w,{sx:{display:"flex",flexDirection:"column",gap:1,background:"rgba(30,30,47,0.9)",borderRadius:"8px",padding:"8px",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 4px 12px rgba(0,0,0,0.2)"},children:[r.jsx(On,{name:"content",component:$n,multiline:!0,fullWidth:!0,size:"small",inputRef:Ee,onKeyDown:ke=>{ke.key==="Enter"&&!ke.shiftKey?(ke.preventDefault(),Qe()):ke.key==="Escape"&&(ke.preventDefault(),p(null))}}),r.jsxs(w,{sx:{display:"flex",gap:1,justifyContent:"flex-end",padding:"4px 8px"},children:[r.jsx(xe,{size:"small",onClick:()=>{p(null)},sx:{color:"#d32f2f","&:hover":{background:"rgba(211,47,47,0.1)"}},children:r.jsx(qt,{fontSize:"small"})}),r.jsx(xe,{size:"small",onClick:()=>Qe(),disabled:!Ve.content,sx:{color:Ve.content?"#1976D2":"rgba(255,255,255,0.3)",transition:"color 0.25s cubic-bezier(.4,0,.2,1)","&:hover":{color:Ve.content?"#1976D2":"rgba(255,255,255,0.3)"}},children:r.jsx(lr,{fontSize:"small"})})]})]})})}):r.jsxs(w,{sx:{display:"flex",flexDirection:"column",position:"relative"},children:[r.jsx(X,{sx:{color:"rgba(255,255,255,0.85)",wordBreak:"break-word",fontSize:"1.01rem",whiteSpace:"pre-wrap",pr:"120px",pl:0,lineHeight:1.4},component:"span",dangerouslySetInnerHTML:{__html:Qr.sanitize(S.content.replace(/\r\n/g,`
`).replace(/\n/g,"<br>"))}}),r.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:.5,position:"absolute",top:0,right:0},children:[S.last_modified_at&&S.last_modified_at!==S.created_at&&r.jsx("span",{style:{color:"#90caf9",fontSize:"0.85em",fontStyle:"italic",fontWeight:500},children:"ред."}),S.author.id===(t==null?void 0:t.id)&&r.jsx(w,{sx:{display:"flex",alignItems:"center",gap:.5,mr:.5},children:r.jsx(Ri,{sx:{fontSize:"1rem",color:S.read_by_count&&S.read_by_count>0?"#FF69B4":"rgba(255,255,255,0.35)"}})}),r.jsx(X,{sx:{color:"rgba(255,255,255,0.35)",fontSize:"0.78rem",lineHeight:1,whiteSpace:"nowrap",display:"flex",alignItems:"center",gap:.5},children:Ni(S.created_at)})]})]})]})}),!Y&&r.jsxs(w,{className:"message-actions",sx:{position:"absolute",top:-38,left:"50%",transform:"translateX(-50%)",display:"flex",gap:1,opacity:0,pointerEvents:"none",transition:"opacity 0.2s",zIndex:10,background:"rgba(20,20,35,0.85)",borderRadius:2,boxShadow:"0 8px 24px 0 rgba(0,0,0,0.3), 0 0 12px 0 rgba(149,128,255,0.2)",px:1.5,py:.5,border:"1px solid rgba(149,128,255,0.25)",backdropFilter:"blur(12px)"},children:[r.jsx(xe,{size:"small",onClick:()=>h(S),sx:{color:"#00FFBA",transition:"all 0.2s ease",padding:"6px",backgroundColor:"rgba(0, 255, 186, 0.12)","&:hover":{color:"#00FFBA",backgroundColor:"rgba(0, 255, 186, 0.25)",transform:"translateY(-2px)",boxShadow:"0 4px 8px rgba(0, 255, 186, 0.3)"}},children:r.jsx(cr,{fontSize:"small"})}),S.author.id===(t==null?void 0:t.id)&&r.jsxs(r.Fragment,{children:[r.jsx(xe,{size:"small",onClick:()=>p(S.id),sx:{color:"#00CFFF",transition:"all 0.2s ease",padding:"6px",backgroundColor:"rgba(0, 207, 255, 0.12)","&:hover":{color:"#00CFFF",backgroundColor:"rgba(0, 207, 255, 0.25)",transform:"translateY(-2px)",boxShadow:"0 4px 8px rgba(0, 207, 255, 0.3)"}},children:r.jsx(Mi,{fontSize:"small"})}),r.jsx(xe,{size:"small",onClick:()=>xt(S.id),sx:{color:"#FF3D71",transition:"all 0.2s ease",padding:"6px",backgroundColor:"rgba(255, 61, 113, 0.12)","&:hover":{color:"#FF3D71",backgroundColor:"rgba(255, 61, 113, 0.25)",transform:"translateY(-2px)",boxShadow:"0 4px 8px rgba(255, 61, 113, 0.3)"}},children:r.jsx(Ei,{fontSize:"small"})})]})]})]})]},Y?`temp-${S.created_at}`:S.id);m.push(Fe),x=S.author.id,b=S.created_at}),m.length>0&&u.push(...m),u})(),r.jsx("div",{ref:he})]})});return r.jsxs(w,{sx:{flex:1,display:"flex",flexDirection:"column",background:"rgba(30,30,47,0.95)",backdropFilter:"blur(10px)",position:"relative"},children:[r.jsx(w,{sx:{height:60,px:3,display:"flex",alignItems:"center",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:r.jsx(X,{variant:"h6",sx:{color:"#fff",fontWeight:700},children:(e==null?void 0:e.name)||"Select a channel"})}),Ze&&!I?mt():Dt(),r.jsx(Ct,{in:z,children:r.jsx(xe,{onClick:$e,sx:{position:"absolute",bottom:g?160:100,right:20,backgroundColor:"rgba(30,30,47,0.95)",backdropFilter:"blur(8px)",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 4px 12px rgba(0,0,0,0.2)","&:hover":{backgroundColor:"rgba(40,40,57,0.95)"},zIndex:1e3,transition:"bottom 0.2s ease-out"},children:r.jsx(dr,{sx:{color:"#fff"}})})}),r.jsx(Ct,{in:F>0,children:r.jsx(w,{sx:{position:"absolute",bottom:g?160:100,left:"50%",transform:"translateX(-50%)",zIndex:1e3,transition:"bottom 0.2s ease-out"},children:r.jsxs(ot,{sx:{backgroundColor:"#FF69B4",color:"#fff",px:2,py:1,borderRadius:"20px",cursor:"pointer",boxShadow:"0 4px 12px rgba(255,105,180,0.2)",display:"flex",alignItems:"center",gap:1,"&:hover":{backgroundColor:"#FF1493"}},onClick:$e,children:[r.jsx(dr,{}),r.jsxs(X,{variant:"body2",sx:{fontWeight:600},children:[F," ",F===1?"новое сообщение":"новых сообщений"]})]})})}),r.jsxs(w,{sx:{p:2,position:"relative"},children:[ce.length>0&&r.jsxs(w,{sx:{position:"absolute",top:-40,left:20,display:"flex",alignItems:"center",backgroundColor:"#002B3D",borderRadius:"24px",padding:"6px 12px",cursor:"pointer",transition:"all 0.2s ease",border:"1px solid #00CFFF",boxShadow:"0 4px 20px rgba(0, 207, 255, 0.3)",zIndex:10,"&:hover":{backgroundColor:"#003D52",transform:"translateY(-2px) scale(1.02)",boxShadow:"0 6px 24px rgba(0, 207, 255, 0.4)"}},onClick:()=>ie(!0),children:[r.jsx(gn,{direction:"row",spacing:-1.2,mr:1,children:ce.slice(0,2).map((u,x)=>r.jsxs(w,{sx:{position:"relative",zIndex:2-x},children:[r.jsx(Bt,{src:u.avatar||void 0,alt:u.login,sx:{width:28,height:28,border:"2px solid #002B3D",boxShadow:"0 2px 8px rgba(0,0,0,0.2)"}}),r.jsx(w,{sx:{position:"absolute",bottom:-2,right:-2,width:10,height:10,borderRadius:"50%",backgroundColor:"#00FF94",border:"2px solid #002B3D"}})]},u.id))}),r.jsx(w,{sx:{display:"flex",gap:"2px",ml:.5},children:[1,2,3].map(u=>r.jsx(w,{sx:{width:"3px",height:"3px",borderRadius:"50%",backgroundColor:"#00CFFF",animation:"bubble 1.4s ease-in-out infinite",animationDelay:`${(u-1)*.2}s`,"@keyframes bubble":{"0%, 60%, 100%":{transform:"scale(1)",opacity:.3},"30%":{transform:"scale(1.4)",opacity:1}}}},u))}),ce.length>2&&r.jsxs(w,{sx:{display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#00CFFF",color:"#002B3D",borderRadius:"12px",padding:"2px 8px",fontSize:"0.75rem",fontWeight:700,ml:.5,minWidth:"28px",height:"24px"},children:["+",ce.length-2]})]}),it?r.jsxs(w,{sx:{display:"flex",flexDirection:"column",gap:1},children:[g&&r.jsxs(ot,{sx:{p:"8px 16px",display:"flex",alignItems:"flex-start",gap:1,background:"rgba(30,30,47,0.95)",border:"1px solid rgba(149,128,255,0.25)",borderRadius:2,position:"relative",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",mb:1,pl:3},children:[r.jsx(w,{sx:{position:"absolute",left:0,top:0,bottom:0,width:"4px",backgroundColor:"#00CFFF",borderTopLeftRadius:2,borderBottomLeftRadius:2}}),r.jsxs(w,{sx:{flex:1,cursor:"pointer"},onClick:()=>{if(g&&g.id){const u=document.querySelector(`[data-msg-id='${g.id}']`);u&&(u.scrollIntoView({behavior:"smooth",block:"center"}),Ye(g.id),le(x=>{const b=new Set(x);return b.add(g.id),b}),setTimeout(()=>{le(x=>{const b=new Set(x);return b.delete(g.id),b}),Ye(null)},3e3))}},children:[r.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[r.jsx(cr,{sx:{color:"#00CFFF",fontSize:"0.9rem"}}),r.jsx(X,{sx:{color:"#00CFFF",fontWeight:600,fontSize:"0.9rem"},children:g.author.login})]}),r.jsx(X,{sx:{color:"rgba(255,255,255,0.7)",fontSize:"0.85rem",maxWidth:"500px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxHeight:"1.5em"},children:(()=>{const u=g.content;return u.length>150?!(u.indexOf(" ")!==-1)&&u.length>100?u.substring(0,100)+"...":u.substring(0,150)+"...":u})()})]}),r.jsx(xe,{size:"small",onClick:()=>h(null),sx:{color:"rgba(255,255,255,0.5)","&:hover":{color:"rgba(255,255,255,0.8)"}},children:r.jsx(qt,{fontSize:"small"})})]}),r.jsx(ot,{sx:{p:"8px 16px",display:"flex",alignItems:"center",gap:1,background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:3,position:"relative",overflow:"hidden"},children:r.jsx(wt,{initialValues:{content:""},validationSchema:fr,onSubmit:bt,children:({handleSubmit:u,values:x,setFieldValue:b})=>r.jsxs(r.Fragment,{children:[r.jsx(St,{style:{width:"100%"},children:r.jsx(On,{name:"content",component:$n,placeholder:"Type a message...",multiline:!0,maxRows:4,size:"small",disabled:!e||l,inputRef:De,sx:{"& .MuiOutlinedInput-root":{"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"transparent"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"transparent"},"& .MuiOutlinedInput-notchedOutline":{borderColor:"transparent"}}},onKeyDown:m=>{m.key==="Enter"&&!m.shiftKey&&(m.preventDefault(),u(),rt(!1))},onChange:m=>{const j=m.target.value;b("content",j),j.trim().length>0?rt(!0):rt(!1)}})}),r.jsxs(gn,{direction:"row",spacing:1,alignItems:"center",children:[r.jsx(xe,{size:"small",sx:{color:"#FF69B4"},children:r.jsx(ki,{})}),r.jsx(xe,{size:"small",sx:{color:"#1E90FF"},children:r.jsx(Ii,{})}),r.jsx(xe,{size:"small",sx:{color:x.content?"#1976D2":"rgba(255,255,255,0.3)",transition:"color 0.25s cubic-bezier(.4,0,.2,1)","&:hover":{color:x.content?"#1976D2":"rgba(255,255,255,0.3)"}},onClick:()=>u(),disabled:l||!x.content,children:r.jsx(lr,{})})]})]})})})]}):r.jsx(ot,{sx:{p:"12px 16px",display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:3},children:r.jsx(X,{sx:{color:"rgba(255,255,255,0.5)",fontSize:"0.9rem"},children:"Недостаточно прав для отправки сообщений"})})]}),r.jsx(lo,{open:se,onClose:()=>ie(!1),title:"Пользователи, которые печатают",children:r.jsxs(Kr,{sx:{pt:0,maxHeight:"400px",overflowY:"auto","&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"rgba(255,255,255,0.05)",borderRadius:"4px"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.1)",borderRadius:"4px","&:hover":{background:"rgba(255,255,255,0.15)"}}},children:[ce.map(u=>r.jsxs(Bn,{children:[r.jsx(po,{children:r.jsx(Bt,{src:u.avatar||void 0,alt:u.login,sx:{width:40,height:40}})}),r.jsx(Fn,{primary:r.jsx(X,{sx:{color:"rgba(255,255,255,0.9)"},children:u.login}),secondary:r.jsxs(w,{component:"span",sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[r.jsx(w,{component:"span",sx:{display:"flex",gap:"2px"},children:[1,2,3].map(x=>r.jsx(w,{component:"span",sx:{display:"inline-block",width:"4px",height:"4px",borderRadius:"50%",backgroundColor:"#00CFFF",animation:"bubble 1.4s ease-in-out infinite",animationDelay:`${(x-1)*.2}s`,"@keyframes bubble":{"0%, 60%, 100%":{transform:"scale(1)",opacity:.3},"30%":{transform:"scale(1.4)",opacity:1}}}},x))}),r.jsx("span",{style:{color:"rgba(255,255,255,0.5)",fontSize:"0.75rem"},children:"печатает..."})]})})]},u.id)),ce.length===0&&r.jsx(Bn,{children:r.jsx(Fn,{primary:r.jsx(X,{sx:{color:"rgba(255,255,255,0.9)"},children:"Никто не печатает"}),secondary:r.jsx(X,{sx:{color:"rgba(255,255,255,0.5)",fontSize:"0.875rem"},children:"В данный момент никто не набирает сообщение"})})})]})})]})},$i=({hubId:e,presenceUpdates:t=[]})=>{const{data:n=[],isLoading:o}=yr({hubId:e}),i=Cn(l=>l.user.currentUser),a=Ce.useMemo(()=>{const l=new Map;return n.forEach(d=>{var p;d.user_id&&d.user?l.set(d.user_id,d):(p=d.user)!=null&&p.id&&l.set(d.user.id,{...d,user_id:d.user.id})}),(Array.isArray(t)?t:[]).forEach(d=>{var h;const p=d.user_id||((h=d.user)==null?void 0:h.id);if(!p)return;const g=l.get(p);g?l.set(p,{...g,...d,online:d.online??g.online}):l.set(p,{...d,user_id:p})}),i&&!l.has(i.id)&&l.set(i.id,{id:Date.now(),user_id:i.id,hub_id:e,joined_at:new Date().toISOString(),is_owner:!1,user:{id:i.id,login:i.login,avatar:i.avatar,online:!0},roles:[]}),Array.from(l.values()).sort((d,p)=>{var C,D,I,k,M,T;const g=i&&d.user_id===i.id,h=i&&p.user_id===i.id;if(g&&!h)return-1;if(!g&&h)return 1;const v=d.online||((C=d.user)==null?void 0:C.online)||((D=d.user)==null?void 0:D.presence)==="ONLINE",E=p.online||((I=p.user)==null?void 0:I.online)||((k=p.user)==null?void 0:k.presence)==="ONLINE";return v&&!E?-1:!v&&E?1:(((M=d.user)==null?void 0:M.login)||"").localeCompare(((T=p.user)==null?void 0:T.login)||"")})},[n,t,i,e]);return o?r.jsx(w,{sx:{width:240,p:2,background:"rgba(30,30,47,0.95)",borderLeft:"1px solid rgba(255,255,255,0.1)",backdropFilter:"blur(10px)"},children:[...Array(5)].map((l,c)=>r.jsxs(w,{sx:{display:"flex",alignItems:"center",mb:2},children:[r.jsx(ve,{variant:"circular",width:40,height:40,sx:{bgcolor:"rgba(255,255,255,0.1)",mr:2}}),r.jsxs(w,{sx:{flex:1},children:[r.jsx(ve,{variant:"text",width:"60%",height:20,sx:{bgcolor:"rgba(255,255,255,0.1)",mb:.5}}),r.jsx(ve,{variant:"text",width:"40%",height:16,sx:{bgcolor:"rgba(255,255,255,0.1)"}})]})]},c))}):r.jsxs(w,{sx:{width:240,p:2,background:"rgba(30,30,47,0.95)",borderLeft:"1px solid rgba(255,255,255,0.1)",backdropFilter:"blur(10px)"},children:[r.jsxs(X,{variant:"subtitle2",sx:{color:"#B0B0B0",fontWeight:600,textTransform:"uppercase",letterSpacing:1,mb:2},children:["Участники (",a.length,")"]}),a.map(l=>{if(!l.user)return null;const c=i&&l.user_id===i.id;return r.jsxs(ot,{sx:{p:1,mb:1,display:"flex",alignItems:"center",background:c?"rgba(0,207,255,0.1)":"rgba(30,30,47,0.5)",border:`1px solid ${c?"rgba(0,207,255,0.3)":"rgba(255,255,255,0.05)"}`,"&:hover":{background:c?"rgba(0,207,255,0.15)":"rgba(30,30,47,0.7)",borderColor:c?"rgba(0,207,255,0.4)":"rgba(255,255,255,0.1)"},transition:"all 0.2s ease",position:"relative"},children:[r.jsxs(w,{sx:{position:"relative",mr:1},children:[r.jsx(Bt,{src:l.user.avatar,alt:l.user.login,userId:l.user.id,hubId:e,sx:{width:32,height:32,background:"linear-gradient(135deg, #C2185B 0%, #1976D2 100%)"}}),l.user.presence&&r.jsx(w,{sx:{position:"absolute",bottom:-2,right:-2,width:14,height:14,bgcolor:l.user.presence==="ONLINE"?"#4CAF50":"#6B5B95",border:"3px solid #1E1E2F",borderRadius:"50%"}})]}),r.jsxs(w,{sx:{flex:1},children:[r.jsx(X,{sx:{color:"#fff",fontWeight:500},children:l.user.login}),r.jsx(X,{sx:{color:"#B0B0B0",fontSize:"0.8rem"},children:l.user.presence==="ONLINE"?"В сети":"Не в сети"})]})]},l.id||l.user_id||l.user.id)})]})},gr={dark:{background:"#0A0A1A",backgroundVariant:"#1E1E2F",backgroundPaper:"rgba(30,30,47,0.95)",backgroundGradient:"linear-gradient(135deg, #1E1E2F 60%, #1E1E2F 100%)",backgroundMain:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",backgroundOverlay:"rgba(30,30,47,0.6)",backgroundTransparent:"rgba(30,30,47,0.85)",backgroundHover:"rgba(255,255,255,0.05)",backgroundHoverAlt:"rgba(255,255,255,0.1)",backgroundSelected:"rgba(255,255,255,0.15)",backgroundOpacity:"rgba(255,255,255,0.08)",channelBackground:"rgba(37,37,54,0.95)",channelBackgroundHover:"rgba(45,45,62,0.95)",tooltip:"rgba(30,30,47,0.85)",messageBubble:"rgba(20,20,35,0.85)"},light:{background:"#f5f5f5",backgroundVariant:"#ffffff",backgroundPaper:"rgba(255,255,255,0.95)",backgroundGradient:"linear-gradient(135deg, #ffffff 60%, #f5f5f5 100%)",backgroundMain:"linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%)",backgroundOverlay:"rgba(255,255,255,0.9)",backgroundTransparent:"rgba(255,255,255,0.85)",backgroundHover:"rgba(0,0,0,0.04)",backgroundHoverAlt:"rgba(0,0,0,0.08)",backgroundSelected:"rgba(0,0,0,0.12)",backgroundOpacity:"rgba(0,0,0,0.06)",channelBackground:"rgba(245,245,245,0.95)",channelBackgroundHover:"rgba(235,235,235,0.95)",tooltip:"rgba(97,97,97,0.92)",messageBubble:"rgba(245,245,245,0.85)"}},He=(e,t)=>e.palette.mode==="dark"?gr.dark[t]:gr.light[t],tt=(e,t,n)=>e.palette.mode==="dark"?st("#FFFFFF",n):st("#000000",n),Hi=(e,t="main")=>{const n=e.palette.mode==="dark",o={main:"linear-gradient(90deg, #FF69B4 0%, #1E90FF 100%)",hover:"linear-gradient(90deg, #FF1493 0%, #00BFFF 100%)",cyber:"linear-gradient(45deg, #FF69B4 0%, #1E90FF 50%, #FF69B4 100%)"};return!n&&t==="main"?"linear-gradient(90deg, #E91E63 0%, #2196F3 100%)":o[t]},fn=(e,t=.12)=>e.palette.mode==="dark"?st("#FF69B4",t):st("#E91E63",t),pr=()=>r.jsxs(w,{sx:{p:2},children:[r.jsx(ve,{variant:"rectangular",width:220,height:40,sx:{borderRadius:1,mb:1}}),r.jsx(ve,{variant:"rectangular",width:220,height:40,sx:{borderRadius:1,mb:1}}),r.jsx(ve,{variant:"rectangular",width:220,height:40,sx:{borderRadius:1,mb:1}})]});qe(tn)(({theme:e})=>({borderRadius:8,marginBottom:8,background:He(e,"channelBackground"),border:`1px solid ${tt(e,e.palette.mode==="dark"?"white":"black",.05)}`,"&:hover":{background:He(e,"channelBackgroundHover"),transform:"translateX(5px)",borderColor:st(e.palette.primary.main,.3),"& .channel-icon":{color:"#FF69B4"},"& .settings-button":{opacity:1,color:"#B0B0B0","&:hover":{color:"#FF69B4"}}},transition:"all 0.3s ease-in-out"}));qe(tn)(({theme:e})=>({borderRadius:8,marginBottom:8,background:He(e,"channelBackground"),border:`1px solid ${tt(e,e.palette.mode==="dark"?"white":"black",.05)}`,"&:hover":{background:He(e,"channelBackgroundHover"),transform:"translateX(5px)",borderColor:st(e.palette.secondary.main,.3),"& .channel-icon":{color:"#1E90FF"},"& .settings-button":{opacity:1,color:"#B0B0B0","&:hover":{color:"#1E90FF"}}},transition:"all 0.3s ease-in-out"}));qe(w)(({theme:e})=>({background:He(e,"messageBubble"),borderRadius:"12px 12px 12px 0",padding:"12px 16px",maxWidth:"70%",position:"relative","&::before":{content:'""',position:"absolute",left:"-8px",bottom:0,width:"16px",height:"16px",background:He(e,"messageBubble"),clipPath:"polygon(100% 0, 0 100%, 100% 100%)"},transition:"all 0.3s ease-in-out"}));qe(w)(({theme:e})=>({background:fn(e,.1),borderRadius:16,padding:"4px 12px",border:`1px solid ${fn(e,.3)}`,transition:"all 0.3s ease-in-out",cursor:"pointer","&:hover":{background:fn(e,.2),transform:"scale(1.05)"}}));qe(w)(({theme:e})=>({cursor:"pointer",padding:"8px 16px",borderRadius:8,transition:"all 0.3s ease-in-out","&:hover":{background:"rgba(255,255,255,0.05)"}}));qe(X)(({theme:e})=>({fontSize:14,fontWeight:500,color:"rgba(255,255,255,0.7)",transition:"color 0.3s ease-in-out"}));const Ui=["💬 Общение","🎮 Гейминг","🎨 Творчество","🎵 Музыка","📚 Учеба"],Wi=["💬 основной","🔊 войс-рум","📢 анонсы","🎮 геймчат","🤝 знакомства"],Vi=["🌟 Новый вайб","💫 Свежий нейм","🔥 Топ название","✨ Крутая идея","🎯 Точное попадание"],Gi=["💬 Чил-чат","🎮 Игровая","🎵 Музыкалка","📸 Медиа","💡 Идеи"],Vt=e=>e[Math.floor(Math.random()*e.length)],ea=()=>{var Fe,Qe,Ve,ke;const e=br(),t=Jr(),{hubId:n,channelId:o}=Zr(),{setUpdateHubData:i}=Ln(),[a,l]=s.useState(!1),{data:c=[],isLoading:f}=zn({}),{data:d,isLoading:p,error:g}=eo(Number(n),{skip:!n}),[h,v]=Ce.useState(null),[E,C]=s.useState([]),[D,I]=s.useState(""),[k,M]=s.useState(""),[T,z]=s.useState(Ie.TEXT),[O,B]=s.useState(null),[A,Z]=s.useState(!1),[V,F]=s.useState(!1),[P,ee]=s.useState(!1),[ne,pe]=s.useState(!1),[le,de]=s.useState(null),[Ye,ce]=s.useState(!1),[$,se]=s.useState(null),[ie,he]=s.useState(!1),[Q,ue]=s.useState(!1),[ae,De]=s.useState(null),[Ee,Me]=s.useState(!1),[q,Ue]=s.useState(null),we=Cn(y=>y.user.currentUser),[Ne,je]=s.useState(!1),[Pe,fe]=s.useState(null),[Ze,gt]=s.useState([]),[pt,_e]=s.useState([]),[Ae,it]=s.useState([]),{setHubMembers:Oe}=Ln(),be=s.useRef(!1),ge=s.useRef([]);s.useRef(null),s.useRef(null);const rt=Uo(Un(An,{activationConstraint:{distance:8}}),Un(Dn,{coordinateGetter:ci})),{data:Be,isLoading:We}=mo(Number(n)),{refetch:$e}=zn({}),[Ke]=xo(),[Re]=yo(),[bt]=vo(),[Rt]=So(),[xt]=Co(),[at]=jo(),lt=Ce.useCallback(async()=>{try{await $e()}catch(y){console.error("Error updating hub data:",y),window.notify&&window.notify("Failed to refresh hub data. Please try again.","error")}},[$e]);s.useEffect(()=>{if(n){const y=c.find(R=>R.id===Number(n));v(y||null)}},[c,n]),s.useEffect(()=>{n!==Pe&&(Ue(null),fe(n||null),n&&$e())},[n,Pe,$e]),Ce.useEffect(()=>{i(lt)},[i,lt]),s.useEffect(()=>{(async()=>{if(h!=null&&h.id&&Be){const R=Be.channels.map(_=>({..._,type:_.type===0?Ie.VOICE:Ie.TEXT,categoryId:_.category_id})),U=Be.categories.map(_=>({..._,channels:R.filter(W=>W.category_id===_.id)}));C(U)}})()},[h,Be]),s.useEffect(()=>{},[d]),s.useEffect(()=>{if(d!=null&&d.roles){const y=d.roles.map(W=>W.permissions);gt(y);const R=to(y),_=no(R).map(W=>{const K=ro.find(G=>G.bit===W);return K?K.key:null}).filter(W=>W!==null);_e(_)}},[d]);const{data:ct=[]}=yr(h!=null&&h.id?{hubId:h.id}:void 0,{skip:!(h!=null&&h.id)});s.useEffect(()=>{if(ct){const y=Array.isArray(ct)?ct:[];it(y),Oe(y)}},[ct,Oe]);const mt=async y=>{if(!(!y.trim()||!(h!=null&&h.id))){Z(!0);try{const R=await Ke({hubId:Number(h.id),name:y.trim()}).unwrap();C([...E,{id:R.id,name:R.name,channels:[]}]),I(""),ee(!1)}catch{window.notify&&window.notify("Ошибка при создании категории","error")}finally{Z(!1)}}},Dt=async(y,R)=>{const U=y||k,_=R||T,W=le||O;if(!U.trim()||!W||!(h!=null&&h.id)){console.error("Missing required data:",{channelName:U.trim(),categoryId:W,currentHubId:h==null?void 0:h.id}),window.notify&&window.notify("Не удалось создать канал. Проверьте, что выбрана категория.","error");return}F(!0);try{const K=await Rt({hubId:Number(h.id),categoryId:Number(W),data:{name:U.trim(),type:_,categoryId:Number(W)}}).unwrap();C(G=>G.map(me=>me.id===W?{...me,channels:[...me.channels,K]}:me)),M(""),pe(!1)}catch{window.notify&&window.notify("Ошибка при создании канала","error")}finally{F(!1)}},u=async()=>{if(ge.current.length===0){be.current=!1;return}const y=ge.current[0];try{await y(),ge.current=ge.current.slice(1),ge.current.length>0?setTimeout(u,100):be.current=!1}catch(R){console.error("Error processing update:",R),ge.current=[],be.current=!1}},x=y=>{ge.current.push(y),be.current||(be.current=!0,u())},b=y=>{const{active:R,over:U}=y;!U||R.id===U.id||C(_=>{const W=_.findIndex(me=>me.id===R.id),K=_.findIndex(me=>me.id===U.id);if(W===K)return _;const G=Jt(_,W,K);if(h!=null&&h.id){const me=K+1;x(async()=>{try{await Re({hubId:Number(h.id),categoryId:Number(R.id),data:{position:me}}).unwrap()}catch(dt){throw window.notify&&window.notify("Ошибка при обновлении позиции категории","error"),C(_),dt}})}return G})},m=async(y,R)=>{var me;const{active:U,over:_}=y;if(!_||U.id===_.id)return;const W=R.channels.findIndex(Ge=>Ge.id===U.id),K=R.channels.findIndex(Ge=>Ge.id===_.id);if(W===K)return;const G=E.map(Ge=>{if(Ge.id!==R.id)return Ge;const dt=Jt(Ge.channels,W,K);return{...Ge,channels:dt.map((Xr,qr)=>({...Xr,position:qr+1}))}});C(G);try{const Ge=((me=G.find(dt=>dt.id===R.id))==null?void 0:me.channels)||[];await Promise.all(Ge.map(dt=>xt({channelId:dt.id,data:{category_id:R.id,position:dt.position}}).unwrap()))}catch{C(E),window.notify&&window.notify("Ошибка при обновлении позиции канала","error")}},j=y=>{se(y.id),ce(!0)},L=async()=>{if(!(!$||!(h!=null&&h.id))){he(!0);try{await bt({hubId:Number(h.id),categoryId:Number($)}).unwrap(),C(y=>y.filter(R=>R.id!==$)),ce(!1)}catch{window.notify&&window.notify("Ошибка при удалении категории","error")}finally{he(!1)}}},N=y=>{De(y.id),ue(!0)},S=async()=>{if(!ae)return;const y=E.flatMap(R=>R.channels).find(R=>R.id===ae);if(y){Me(!0);try{await at({channelId:y.id}).unwrap(),C(R=>R.map(U=>({...U,channels:U.channels.filter(_=>_.id!==ae)}))),ue(!1)}catch{window.notify&&window.notify("Ошибка при удалении канала","error")}finally{Me(!1)}}},re=y=>{console.log("handleAddChannel called with categoryId:",y),de(y),pe(!0)},oe=()=>r.jsx(w,{sx:{width:240,background:He(t,"backgroundPaper"),borderRight:`1px solid ${tt(t,t.palette.mode==="dark"?"white":"black",.1)}`,display:"flex",flexDirection:"column",backdropFilter:"blur(10px)",height:"100%"},children:r.jsxs(w,{sx:{p:2},children:[r.jsx(ve,{variant:"text",width:120,height:24,sx:{bgcolor:tt(t,t.palette.mode==="dark"?"white":"black",.1),mb:2}}),r.jsx(pr,{}),r.jsx(ve,{variant:"text",width:120,height:24,sx:{bgcolor:"rgba(255,255,255,0.1)",mb:2,mt:3}}),r.jsx(pr,{})]})}),te=()=>r.jsxs(w,{sx:{width:240,background:He(t,"backgroundOverlay"),borderLeft:`1px solid ${tt(t,t.palette.mode==="dark"?"white":"black",.1)}`,p:2},children:[r.jsx(ve,{variant:"text",width:120,height:24,sx:{bgcolor:tt(t,t.palette.mode==="dark"?"white":"black",.1),mb:2}}),[1,2,3,4,5].map(y=>r.jsxs(w,{sx:{display:"flex",alignItems:"center",mb:2},children:[r.jsx(ve,{variant:"circular",width:32,height:32,sx:{bgcolor:tt(t,t.palette.mode==="dark"?"white":"black",.1),mr:1}}),r.jsx(ve,{variant:"text",width:100,height:20,sx:{bgcolor:tt(t,t.palette.mode==="dark"?"white":"black",.1)}})]},y))]}),H=pn().shape({name:hn().required("Обязательное поле").max(30,"Максимум 30 символов").test("max-length","Максимум 30 символов",y=>!y||y.length<=30),type:oo().required("Обязательное поле").oneOf([Ie.VOICE,Ie.TEXT],"Неверный тип канала")}),Y=pn().shape({name:hn().required("Обязательное поле").max(30,"Максимум 30 символов").test("max-length","Максимум 30 символов",y=>!y||y.length<=30)});return f||p?r.jsx(w,{sx:{display:"flex",height:"100vh",alignItems:"center",justifyContent:"center",background:He(t,"backgroundMain"),position:"relative","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,background:`radial-gradient(circle at 50% 50%, ${st(t.palette.primary.main,.1)} 0%, transparent 70%)`,zIndex:0}},children:r.jsx(X,{variant:"h6",sx:{color:t.palette.text.secondary},children:"Загрузка хаба..."})}):!h&&!f?r.jsx(w,{sx:{display:"flex",height:"100vh",alignItems:"center",justifyContent:"center",background:He(t,"backgroundMain"),position:"relative","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,background:`radial-gradient(circle at 50% 50%, ${st(t.palette.primary.main,.1)} 0%, transparent 70%)`,zIndex:0}},children:r.jsx(X,{variant:"h6",sx:{color:t.palette.text.secondary},children:"Хаб не найден"})}):r.jsxs(r.Fragment,{children:[r.jsxs(w,{sx:{display:"flex",height:"100vh",flexDirection:"column",background:He(t,"backgroundMain"),position:"relative","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,background:`radial-gradient(circle at 50% 50%, ${st(t.palette.primary.main,.1)} 0%, transparent 70%)`,zIndex:0}},children:[r.jsxs(w,{sx:{height:64,px:4,display:"flex",alignItems:"center",background:He(t,"backgroundPaper"),borderBottom:`1px solid ${tt(t,t.palette.mode==="dark"?"white":"black",.1)}`,boxShadow:`0 2px 8px 0 ${tt(t,"black",.15)}`,backdropFilter:"blur(10px)"},children:[r.jsx(X,{variant:"h5",sx:{fontWeight:700,background:Hi(t,"main"),WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",letterSpacing:1},children:Ne||f?r.jsx(ve,{variant:"text",width:200,height:40,sx:{bgcolor:"rgba(255,255,255,0.1)"}}):((Fe=c.find(y=>y.id===Number(n)))==null?void 0:Fe.name)||"Hub"}),r.jsx(w,{sx:{flex:1}}),r.jsxs(gn,{direction:"row",spacing:1,children:[r.jsx(Gt,{title:"Search",children:r.jsx(xe,{sx:{color:t.palette.secondary.main},onClick:()=>l(!0),children:r.jsx(io,{})})}),r.jsx(Gt,{title:"Notifications",children:r.jsx(xe,{sx:{color:t.palette.primary.main},children:r.jsx(ho,{})})}),((d==null?void 0:d.is_owner)||so(Ze,["MANAGE_ROLES","MANAGE_INVITES","MANAGE_HUB"]))&&r.jsx(Gt,{title:"Settings",children:r.jsx(xe,{sx:{color:t.palette.primary.main},onClick:()=>e(`/hub/${n}/settings`),children:r.jsx(jn,{})})})]})]}),r.jsxs(w,{sx:{flex:1,display:"flex",overflow:"hidden"},children:[Ne||We?oe():r.jsx(w,{sx:{width:240,background:He(t,"backgroundPaper"),borderRight:"1px solid rgba(255,255,255,0.1)",display:"flex",flexDirection:"column",backdropFilter:"blur(10px)",height:"100%","& .simplebar-scrollbar":{"&:before":{backgroundColor:"rgba(194,24,91,0.4)",width:"4px",left:"0",right:"auto",opacity:0,transition:"opacity 0.2s ease"},"&.simplebar-visible:before":{opacity:1}},"&:hover .simplebar-scrollbar":{"&:before":{opacity:1}},"& .simplebar-track.simplebar-vertical":{width:"4px",right:"0",top:"0",bottom:"0",background:"transparent"},"& .simplebar-track.simplebar-horizontal":{display:"none"}},children:r.jsxs(w,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[r.jsx(w,{sx:{p:"16px 0"},children:r.jsxs(w,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,px:2},children:[r.jsx(X,{variant:"subtitle2",sx:{color:"rgba(255,255,255,0.7)",textTransform:"uppercase",letterSpacing:1,fontWeight:700},children:"Категории"}),((d==null?void 0:d.is_owner)||ht(Ze,"MANAGE_CATEGORIES"))&&r.jsx(xe,{size:"small",sx:{color:"#1976D2","&:hover":{background:"rgba(25,118,210,0.1)"}},onClick:()=>{(d!=null&&d.is_owner||ht(Ze,"MANAGE_CATEGORIES"))&&ee(!0)},children:r.jsx(wn,{fontSize:"small"})})]})}),r.jsx(ao,{style:{height:"calc(100vh - 180px)",width:"100%",flex:1,minHeight:0},className:"custom-scrollbar",scrollbarMinSize:40,autoHide:!0,children:r.jsx(ji,{categories:E,activeChannel:q,setActiveChannel:Ue,openChannelSettings:N,sensors:rt,handleDragEnd:b,handleChannelDragEnd:m,openCategorySettings:j,setActiveCategoryId:B,setCreateChannelOpen:y=>{y?re(O||""):pe(!1)},userPermissions:Ze,isOwner:(d==null?void 0:d.is_owner)||!1,hubId:n||""})})]})}),q&&we?r.jsx(_i,{activeChannel:q,user:we,hubId:Number(n),userPermissions:Ze,isOwner:(d==null?void 0:d.is_owner)||!1}):r.jsx(w,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",color:"rgba(255,255,255,0.5)"},children:r.jsx(X,{variant:"h5",children:"Select a channel to start chatting"})}),Ne?te():c.find(y=>y.id===Number(n))&&r.jsx($i,{hubId:Number(n),presenceUpdates:Ae})]})]}),r.jsx(co,{open:a,onClose:()=>l(!1)}),r.jsx($t,{open:P,onClose:()=>ee(!1),title:"Создать категорию",children:r.jsx(wt,{initialValues:{name:""},validationSchema:Y,onSubmit:async(y,{resetForm:R})=>{await mt(y.name.trim()),R(),ee(!1)},children:({values:y,errors:R,touched:U,handleChange:_,handleBlur:W,resetForm:K})=>r.jsxs(St,{children:[r.jsx(vt,{name:"name",label:"Название категории",placeholder:Vt(Ui),autoFocus:!0,margin:"dense",fullWidth:!0,value:y.name,onChange:G=>{G.target.value.length<=30&&_(G)},onBlur:G=>{const me=G.target.value.trim();me!==G.target.value&&(G.target.value=me,_(G)),W(G)},error:U.name&&!!R.name,helperText:r.jsxs(X,{component:"span",sx:{display:"flex",justifyContent:"space-between",width:"100%"},children:[r.jsx("span",{style:{color:"#ff4444"},children:U.name&&R.name}),r.jsxs("span",{style:{color:y.name.length>30?"#ff4444":"rgba(255,255,255,0.5)"},children:[y.name.length,"/30"]})]}),sx:{mb:3,"& .MuiInputBase-input":{color:"#fff","&::placeholder":{color:"#B0B0B0",opacity:1}},"& .MuiInputLabel-root":{color:"#B0B0B0"},"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.4)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#fff"},"& .MuiFormHelperText-root":{color:"rgba(255,255,255,0.5)"}}}),r.jsxs(w,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[r.jsx(et,{onClick:()=>{K(),ee(!1)},sx:{color:"rgba(255,255,255,0.7)"},children:"Отмена"}),r.jsx(et,{type:"submit",variant:"contained",disabled:A||!y.name.trim(),sx:{background:ut.neon,color:"#fff","&:hover":{background:ut.hover,boxShadow:"0 4px 15px rgba(255,105,180,0.4)"},"&:disabled":{background:"rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.3)"}},children:"Создать"})]})]})})}),r.jsx($t,{open:Ye,onClose:()=>ce(!1),title:"Настройки категории",children:r.jsx(wt,{initialValues:{name:((Qe=E.find(y=>y.id===$))==null?void 0:Qe.name)||""},enableReinitialize:!0,validationSchema:Y,onSubmit:async y=>{if(!$||!(h!=null&&h.id))return;const R=y.name.trim();if(!R)return;const U=E.find(_=>_.id===$);if(U&&U.name.trim()===R){ce(!1);return}he(!0);try{await Re({hubId:Number(h.id),categoryId:Number($),data:{name:R}}).unwrap(),C(_=>_.map(W=>W.id===$?{...W,name:R}:W)),ce(!1)}catch{window.notify&&window.notify("Ошибка при обновлении категории","error")}finally{he(!1)}},children:({values:y,errors:R,touched:U,handleChange:_,handleBlur:W})=>r.jsxs(St,{children:[r.jsx(vt,{name:"name",label:"Название категории",placeholder:Vt(Vi),autoFocus:!0,margin:"dense",fullWidth:!0,value:y.name,onChange:K=>{K.target.value.length<=30&&_(K)},onBlur:K=>{const G=K.target.value.trim();G!==K.target.value&&(K.target.value=G,_(K)),W(K)},error:U.name&&!!R.name,helperText:r.jsxs(X,{component:"span",sx:{display:"flex",justifyContent:"space-between",width:"100%"},children:[r.jsx("span",{style:{color:"#ff4444"},children:U.name&&R.name}),r.jsxs("span",{style:{color:y.name.length>30?"#ff4444":"rgba(255,255,255,0.5)"},children:[y.name.length,"/30"]})]}),sx:{mb:3,"& .MuiInputBase-input":{color:"#fff","&::placeholder":{color:"#B0B0B0",opacity:1}},"& .MuiInputLabel-root":{color:"#B0B0B0"},"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.4)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#fff"},"& .MuiFormHelperText-root":{color:"rgba(255,255,255,0.5)"}}}),r.jsx(et,{variant:"outlined",color:"error",fullWidth:!0,sx:{mb:2,mt:1,fontWeight:700},onClick:L,children:"Удалить категорию"}),r.jsxs(w,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[r.jsx(et,{onClick:()=>ce(!1),sx:{color:"#B0B0B0"},children:"Отмена"}),r.jsx(et,{type:"submit",variant:"contained",disabled:ie,sx:{background:ut.neon,color:"#fff","&:hover":{background:ut.hover,boxShadow:"0 4px 15px rgba(255,105,180,0.4)"},"&:disabled":{background:"rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.3)"}},children:"Сохранить"})]})]})})}),r.jsx($t,{open:Q,onClose:()=>ue(!1),title:"Настройки канала",children:r.jsx(wt,{initialValues:{name:((Ve=E.flatMap(y=>y.channels).find(y=>y.id===ae))==null?void 0:Ve.name)||"",type:((ke=E.flatMap(y=>y.channels).find(y=>y.id===ae))==null?void 0:ke.type)||Ie.TEXT},enableReinitialize:!0,validationSchema:H,onSubmit:async y=>{if(!ae)return;const R=y.name.trim();if(!R)return;const U=E.flatMap(W=>W.channels).find(W=>W.id===ae);if(!U)return;if(!(U.name.trim()!==R||U.type!==y.type)){ue(!1);return}Me(!0);try{await xt({channelId:U.id,data:{name:R,type:y.type}}).unwrap(),C(W=>W.map(K=>({...K,channels:K.channels.map(G=>G.id===ae?{...G,name:R,type:y.type}:G)}))),ue(!1)}catch{window.notify&&window.notify("Ошибка при обновлении канала","error")}finally{Me(!1)}},children:({values:y,errors:R,touched:U,handleChange:_,handleBlur:W})=>r.jsxs(St,{children:[r.jsx(vt,{name:"name",label:"Название канала",placeholder:Vt(Gi),autoFocus:!0,margin:"dense",fullWidth:!0,value:y.name,onChange:K=>{K.target.value.length<=30&&_(K)},onBlur:K=>{const G=K.target.value.trim();G!==K.target.value&&(K.target.value=G,_(K)),W(K)},error:U.name&&!!R.name,helperText:r.jsxs(X,{component:"span",sx:{display:"flex",justifyContent:"space-between",width:"100%"},children:[r.jsx("span",{style:{color:"#ff4444"},children:U.name&&R.name}),r.jsxs("span",{style:{color:y.name.length>30?"#ff4444":"rgba(255,255,255,0.5)"},children:[y.name.length,"/30"]})]}),sx:{mb:3,"& .MuiInputBase-input":{color:"#fff","&::placeholder":{color:"#B0B0B0",opacity:1}},"& .MuiInputLabel-root":{color:"#B0B0B0"},"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.4)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#fff"},"& .MuiFormHelperText-root":{color:"rgba(255,255,255,0.5)"}}}),r.jsxs(Nn,{fullWidth:!0,sx:{mb:3},children:[r.jsx(Pn,{id:"channel-type-edit-label",sx:{color:"#B0B0B0"},children:"Тип канала"}),r.jsxs(_n,{name:"type",labelId:"channel-type-edit-label",value:y.type,label:"Тип канала",onChange:_,onBlur:W,error:U.type&&!!R.type,sx:{color:"#fff",".MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.4)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#fff"}},children:[r.jsx(Ht,{value:Ie.TEXT,children:r.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1},children:[r.jsx(wr,{fontSize:"small"}),"Текстовый"]})}),r.jsx(Ht,{value:Ie.VOICE,children:r.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1},children:[r.jsx(Sr,{fontSize:"small"}),"Голосовой"]})})]}),U.type&&R.type&&r.jsx(X,{sx:{color:"#ff4444",fontSize:"0.75rem",mt:1,ml:2},children:R.type})]}),r.jsx(et,{variant:"outlined",color:"error",fullWidth:!0,sx:{mb:2,fontWeight:700},onClick:S,children:"Удалить канал"}),r.jsxs(w,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[r.jsx(et,{onClick:()=>ue(!1),sx:{color:"#B0B0B0"},children:"Отмена"}),r.jsx(et,{type:"submit",variant:"contained",disabled:Ee,sx:{background:ut.neon,color:"#fff","&:hover":{background:ut.hover,boxShadow:"0 4px 15px rgba(255,105,180,0.4)"},"&:disabled":{background:"rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.3)"}},children:"Сохранить"})]})]})})}),r.jsx($t,{open:ne,onClose:()=>{pe(!1),de(null)},title:"Создать канал",children:r.jsx(wt,{initialValues:{name:"",type:Ie.TEXT},validationSchema:H,onSubmit:async(y,{resetForm:R})=>{console.log("Form submitted with:",{values:y,createChannelCategoryId:le}),await Dt(y.name,y.type),R(),pe(!1),de(null)},children:({values:y,errors:R,touched:U,handleChange:_,handleBlur:W,resetForm:K})=>r.jsxs(St,{children:[r.jsx(vt,{name:"name",label:"Название канала",placeholder:Vt(Wi),autoFocus:!0,margin:"dense",fullWidth:!0,value:y.name,onChange:G=>{G.target.value.length<=30&&_(G)},onBlur:G=>{const me=G.target.value.trim();me!==G.target.value&&(G.target.value=me,_(G)),W(G)},error:U.name&&!!R.name,helperText:r.jsxs(X,{component:"span",sx:{display:"flex",justifyContent:"space-between",width:"100%"},children:[r.jsx("span",{style:{color:"#ff4444"},children:U.name&&R.name}),r.jsxs("span",{style:{color:y.name.length>30?"#ff4444":"rgba(255,255,255,0.5)"},children:[y.name.length,"/30"]})]}),sx:{mb:3,"& .MuiInputBase-input":{color:"#fff","&::placeholder":{color:"#B0B0B0",opacity:1}},"& .MuiInputLabel-root":{color:"#B0B0B0"},"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.4)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#fff"},"& .MuiFormHelperText-root":{color:"rgba(255,255,255,0.5)"}}}),r.jsxs(Nn,{fullWidth:!0,sx:{mb:3},children:[r.jsx(Pn,{id:"channel-type-label",sx:{color:"#B0B0B0"},children:"Тип канала"}),r.jsxs(_n,{name:"type",labelId:"channel-type-label",value:y.type,label:"Тип канала",onChange:G=>{_(G),z(G.target.value)},onBlur:W,error:U.type&&!!R.type,sx:{color:"#fff",".MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.4)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#fff"}},children:[r.jsx(Ht,{value:Ie.TEXT,children:"Текстовый"}),r.jsx(Ht,{value:Ie.VOICE,children:"Голосовой"})]}),U.type&&R.type&&r.jsx(X,{sx:{color:"#ff4444",fontSize:"0.75rem",mt:1,ml:2},children:R.type})]}),r.jsxs(w,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[r.jsx(et,{onClick:()=>{K(),pe(!1),de(null)},sx:{color:"#B0B0B0"},children:"Отмена"}),r.jsx(et,{type:"submit",variant:"contained",disabled:V,sx:{background:ut.neon,color:"#fff","&:hover":{background:ut.hover,boxShadow:"0 4px 15px rgba(255,105,180,0.4)"},"&:disabled":{background:"rgba(255,255,255,0.1)",color:"rgba(255,255,255,0.3)"}},children:"Создать"})]})]})})})]})};export{ea as default};
